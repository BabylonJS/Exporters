var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(){function t(e,t,n,a){if(void 0===n&&(n=!0),void 0===a&&(a={}),this.register=null,this.tick=!1,this._engine=null,this._scene=null,this._before=null,this._after=null,this._started=!1,this._initialized=!1,this._properties=null,this._manager=null,this.owned=null,null==e)throw new Error("Null owner scene obejct specified.");if(null==t)throw new Error("Null host scene obejct specified.");this.tick=n,this.owned=e,this._started=!1,this._manager=null,this._initialized=!1,this._properties=a,this._engine=t.getEngine(),this._scene=t;var r=this;r.register=function(){r.registerInstance(r)},r._before=function(){r.updateInstance(r)},r._after=function(){r.afterInstance(r)}}return t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"engine",{get:function(){return this._engine},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"manager",{get:function(){return null==this._manager&&(this._manager=e.SceneManager.GetInstance()),this._manager},enumerable:!0,configurable:!0}),t.prototype.setProperty=function(e,t){null!=this._properties&&(this._properties[e]=t)},t.prototype.getProperty=function(e,t){void 0===t&&(t=null);var n=null;return null!=this._properties&&(n=this._properties[e]),null==n&&(n=t),null!=n?n:null},t.prototype.getClassname=function(){var e=/function (.{1,})\(/,t=e.exec(this.constructor.toString());return t&&t.length>1?t[1]:""},t.prototype.getMetadata=function(){return this.manager.findSceneMetadata(this.owned)},t.prototype.getComponent=function(e){var t=this.manager.findSceneComponent(e,this.owned);return null!=t?t:null},t.prototype.getComponents=function(e){var t=this.manager.findSceneComponents(e,this.owned);return null!=t?t:null},t.prototype.getLensFlareSystem=function(e){return this.manager.findSceneLensFlareSystem(e,this.owned)},t.prototype.getLensFlareSystems=function(){return this.manager.findSceneLensFlareSystems(this.owned)},t.prototype.init=function(){null!=this.owned.metadata},t.prototype.registerInstance=function(e){e.ready&&e.manager.onready(function(){e.ready()}),e.scene.registerBeforeRender(e._before),e.scene.registerAfterRender(e._after)},t.prototype.updateInstance=function(e){null!=e&&null!=e.owned&&(e._started?null!=e._before&&e._started&&e.tick&&(e.update(),e.updateIntersectionList&&e.updateIntersectionList()):(e.init(),e.start(),e._started=!0))},t.prototype.afterInstance=function(e){null!=e&&null!=e.owned&&null!=e._after&&e._started&&e.tick&&e.after()},t.DestroyInstance=function(e){e.tick=!1,e.scene.unregisterBeforeRender(e._before),e.scene.unregisterAfterRender(e._after);try{e.destroy()}catch(t){}e.disposeSceneComponent&&e.disposeSceneComponent(),null!=e._prefab&&(e._prefab.dispose(),e._prefab=null),e.owned=null,e._started=!1,e._before=null,e._after=null,e._properties=null,e._engine=null,e._scene=null,e._manager=null,e.register=null,e.dispose=null},t}();e.SceneComponent=t;var n=function(t){function n(e,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={});var i=t.call(this,e,n,a,r)||this;return i._camera=null,i._orthoSize=0,i._orthoUpdate=!1,i._camera=e,i}return __extends(n,t),Object.defineProperty(n.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),n.prototype.setupOrthographicCamera=function(t,n){null!=this.camera&&this._camera.mode===e.Camera.ORTHOGRAPHIC_CAMERA&&(this._orthoSize=t,this.updateOrthographicSize(),this._orthoUpdate===!1&&(this._orthoUpdate=n,this._orthoUpdate===!0&&window.addEventListener("resize",this.updateOrthographicSize)))},n.prototype.updateOrthographicSize=function(){if(null!=this.camera&&0!==this._orthoSize){var e=this.scene.getEngine().getRenderingCanvasClientRect(),t=e.width/e.height,n=this._orthoSize,a=n*t;this._camera.orthoTop=n,this._camera.orthoBottom=-n,this._camera.orthoLeft=-a,this._camera.orthoRight=a}},n.prototype.disposeSceneComponent=function(){this._orthoUpdate===!0&&(window.removeEventListener("resize",this.updateOrthographicSize),this._orthoUpdate=!1,this._orthoSize=0),this._camera=null},n}(e.SceneComponent);e.CameraComponent=n;var a=function(e){function t(t,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={});var i=e.call(this,t,n,a,r)||this;return i._light=null,i._light=t,i}return __extends(t,e),Object.defineProperty(t.prototype,"light",{get:function(){return this._light},enumerable:!0,configurable:!0}),t.prototype.disposeSceneComponent=function(){this._light=null},t}(e.SceneComponent);e.LightComponent=a;var r=function(t){function n(n,a,r,i){void 0===r&&(r=!0),void 0===i&&(i={});var o=t.call(this,n,a,r,i)||this;return o.onIntersectionEnter=null,o.onIntersectionStay=null,o.onIntersectionExit=null,o.intersectionPrecision=e.IntersectionPrecision.AABB,o._intersections=[],o._intersecting=!1,o._intersector=null,o._mesh=null,o._mesh=n,o._intersecting=!1,o}return __extends(n,t),Object.defineProperty(n.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),n.prototype.getChildMesh=function(t,n,a,r){return void 0===n&&(n=e.SearchType.ExactMatch),void 0===a&&(a=!0),void 0===r&&(r=null),this.manager.findSceneChildMesh(t,this._mesh,n,a,r)},n.prototype.getCollisionMesh=function(e,t){return void 0===e&&(e=!0),void 0===t&&(t=null),this.manager.findSceneCollisionMesh(this._mesh,e,t)},n.prototype.getSocketMesh=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n=null),this.manager.findSceneSocketMesh(e,this._mesh,t,n)},n.prototype.getSocketMeshes=function(e,t){return void 0===e&&(e=!0),void 0===t&&(t=null),this.manager.findSceneSocketMeshes(this._mesh,e,t)},n.prototype.getParticleSystem=function(e){return this.manager.findSceneParticleSystem(e,this._mesh)},n.prototype.getParticleSystems=function(){return this.manager.findSceneParticleSystems(this._mesh)},n.prototype.onCollisionEvent=function(e){if(null!=this._mesh.metadata&&this._mesh.metadata.api&&(this._mesh.metadata.collisionEvent=e),null!=this._mesh.physicsImpostor){var t=this._mesh.physicsImpostor;null==t.onCollideEvent&&(t.onCollideEvent=this.updatePhysicsCollisionEvent)}},n.prototype.getCollisionEventHandler=function(){var e=null;return null!=this._mesh.metadata&&this._mesh.metadata.api&&null!=this._mesh.metadata.collisionEvent&&(e=this._mesh.metadata.collisionEvent),e},n.prototype.updatePhysicsCollisionEvent=function(e,t){if(null!=e.object&&null!=t.object){var n=e.object;if(null!=n&&null!=n.metadata&&null!=n.metadata.collisionEvent){var a=t.object;if(null!=a){var r="Untagged";null!=a.metadata&&null!=a.metadata.tagName&&""!==a.metadata.tagName&&(r=a.metadata.tagName),n.metadata.collisionEvent(a,r)}}}},n.prototype.addIntersectionMesh=function(e){if(null!=e){var t=this.manager.findSceneCollisionMesh(e);null!=t&&this._intersections.push({mesh:t,intersecting:!1})}},n.prototype.addIntersectionMeshes=function(e){var t=this;null!=e&&e.forEach(function(e){if(null!=e){var n=t.manager.findSceneCollisionMesh(e);null!=n&&t._intersections.push({mesh:n,intersecting:!1})}})},n.prototype.removeIntersectionMesh=function(e){if(null!=e&&null!=this._intersections&&this._intersections.length>0){var t=this._intersections.length,n=-1,a=0;for(a=0;a<t;a++){var r=this._intersections[a];if(null!=r.mesh&&r.mesh===e){n=a;break}}n>=0&&this._intersections.splice(n,1)}},n.prototype.getIntersectionList=function(){return this._intersections},n.prototype.resetIntersectionList=function(){this._intersections=[]},n.prototype.updateIntersectionList=function(){var t=this;null==this._intersector&&(this._intersector=this.getCollisionMesh()),null!=this._intersector&&null!=this._intersections&&this._intersections.length>0&&this._intersections.forEach(function(n){null!=n.mesh&&(t._intersecting=t._intersector.intersectsMesh(n.mesh,t.intersectionPrecision===e.IntersectionPrecision.OBB),t._intersecting?n.intersecting?null!=t.onIntersectionStay&&t.onIntersectionStay(n.mesh):null!=t.onIntersectionEnter&&t.onIntersectionEnter(n.mesh):n.intersecting&&null!=t.onIntersectionExit&&t.onIntersectionExit(n.mesh),n.intersecting=t._intersecting)})},n.prototype.disposeSceneComponent=function(){if(this.resetIntersectionList(),null!=this._mesh){if(null!=this._mesh.skeleton&&null!=this._mesh.skeleton.bones&&this._mesh.skeleton.bones.length>0&&this._mesh.skeleton.bones.forEach(function(e){null!=e&&null!=e.metadata&&(e.metadata=null)}),null!=this._mesh.physicsImpostor){var e=this._mesh.physicsImpostor;null!=e.onCollideEvent&&(e.onCollideEvent=null)}null!=this._mesh.metadata&&this._mesh.metadata.api&&(this._mesh.metadata.collisionEvent=null)}this._intersector=null,this._mesh=null},n}(e.SceneComponent);e.MeshComponent=r;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.start=function(){var e=this;if(e.setupOrthographicCamera){var t=this.getProperty("orthoSize",5),n=this.getProperty("resizeCameras",!0);e.setupOrthographicCamera(t,n)}},t}(e.CameraComponent);e.OrthoController=i;var o=function(){function t(){this.currentVelocity=0}return t.prototype.SmoothDamp=function(t,n,a,r,i){void 0===i&&(i=Number.MAX_VALUE),a=Math.max(1e-4,a);var o=2/a,s=o*r,l=1/(1+s+.48*s*s+.235*s*s*s),u=t-n,c=n,p=i*a;u=e.Scalar.Clamp(u,-p,p),n=t-u;var d=(this.currentVelocity+o*u)*r;this.currentVelocity=(this.currentVelocity-o*d)*l;var m=n+(u+d)*l;return c-t>0==m>c&&(m=c,this.currentVelocity=(m-c)/r),m},t.prototype.SmoothDampAngle=function(t,n,a,r,i){return void 0===i&&(i=Number.MAX_VALUE),n=t+e.Scalar.DeltaAngle(t,n),this.SmoothDamp(t,n,a,i,r)},t}();e.SmoothTool=o;var s=function(){function t(t){this._owned=null,this.slerpIdentity=null,this._owned=t,this.slerpIdentity=e.Quaternion.Identity()}return t.prototype.rotate=function(t,n,a,r){void 0===r&&(r=e.RotateOrder.ZXY);var i=null;return null!=this._owned&&(null==this._owned.rotationQuaternion&&(this._owned.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this._owned.rotation.y,this._owned.rotation.x,this._owned.rotation.z)),i=r===e.RotateOrder.XYZ?this._owned.addRotation(t,0,0).addRotation(0,n,0).addRotation(0,0,a):r===e.RotateOrder.XZY?this._owned.addRotation(t,0,0).addRotation(0,0,a).addRotation(0,n,0):r===e.RotateOrder.ZXY?this._owned.addRotation(0,0,a).addRotation(t,0,0).addRotation(0,n,0):r===e.RotateOrder.ZYX?this._owned.addRotation(0,0,a).addRotation(0,n,0).addRotation(t,0,0):r===e.RotateOrder.YZX?this._owned.addRotation(0,n,0).addRotation(0,0,a).addRotation(t,0,0):this._owned.addRotation(t,n,a)),i},t.prototype.lookAtPosition=function(t,n,a,r,i,o){void 0===n&&(n=0);var s=null;return null!=this._owned&&(null==this._owned.rotationQuaternion&&(this._owned.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this._owned.rotation.y,this._owned.rotation.x,this._owned.rotation.z)),null!=this.slerpIdentity&&n>0&&this.slerpIdentity.copyFrom(this._owned.rotationQuaternion),s=this._owned.lookAt(t,a,r,i,o),null!=this.slerpIdentity&&n>0&&e.Quaternion.SlerpToRef(this.slerpIdentity,this._owned.rotationQuaternion,n,this._owned.rotationQuaternion)),s},t.prototype.dispose=function(){this._owned=null,this.slerpIdentity=null},t}();e.MeshRotator=s;var l=function(){function e(e){this._metadata=null,this._metadata=e}return Object.defineProperty(e.prototype,"type",{get:function(){return this._metadata.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"prefab",{get:function(){return this._metadata.prefab},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._metadata.state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectId",{get:function(){return this._metadata.objectId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectName",{get:function(){return this._metadata.objectName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tagName",{get:function(){return this._metadata.tagName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layerIndex",{get:function(){return this._metadata.layerIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layerName",{get:function(){return this._metadata.layerName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"areaIndex",{get:function(){return this._metadata.areaIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"navAgent",{get:function(){return this._metadata.navAgent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"meshLink",{get:function(){return this._metadata.meshLink},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"meshObstacle",{get:function(){return this._metadata.meshObstacle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"socketList",{get:function(){return this._metadata.socketList},enumerable:!0,configurable:!0}),e.prototype.setProperty=function(e,t){null!=this._metadata.properties&&(this._metadata.properties[e]=t)},e.prototype.getProperty=function(e,t){void 0===t&&(t=null);var n=null;return null!=this._metadata.properties&&(n=this._metadata.properties[e]),null==n&&(n=t),null!=n?n:null},e}();e.ObjectMetadata=l;var u=function(){function e(){}return e}();e.MachineState=u;var c=function(){function e(){}return e}();e.TransitionCheck=c;var p;!function(e){e[e.YXZ=0]="YXZ",e[e.YZX=1]="YZX",e[e.XYZ=2]="XYZ",e[e.XZY=3]="XZY",e[e.ZXY=4]="ZXY",e[e.ZYX=5]="ZYX"}(p=e.RotateOrder||(e.RotateOrder={}));var d;!function(e){e[e.Clip=0]="Clip",e[e.Tree=1]="Tree"}(d=e.MotionType||(e.MotionType={}));var m;!function(e){e[e.Float=1]="Float",e[e.Int=3]="Int",e[e.Bool=4]="Bool",e[e.Trigger=9]="Trigger"}(m=e.AnimatorParameterType||(e.AnimatorParameterType={}));var h;!function(e){e[e.NoScale=1]="NoScale",e[e.Deg2Rad=.0174532924]="Deg2Rad",e[e.Rad2Deg=57.29578]="Rad2Deg",e[e.DiagonalSpeed=.7071]="DiagonalSpeed",e[e.MinimumTimeout=.25]="MinimumTimeout"}(h=e.Constants||(e.Constants={}));var g;!function(e){e[e.ExactMatch=0]="ExactMatch",e[e.StartsWith=1]="StartsWith",e[e.EndsWith=2]="EndsWith",e[e.IndexOf=3]="IndexOf"}(g=e.SearchType||(e.SearchType={}));var f;!function(e){e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four"}(f=e.PlayerNumber||(e.PlayerNumber={}));var y;!function(e){e[e.None=-1]="None",e[e.Generic=0]="Generic",e[e.Xbox360=1]="Xbox360"}(y=e.GamepadType||(e.GamepadType={}));var S;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(S=e.JoystickButton||(e.JoystickButton={}));var _;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(_=e.Xbox360Trigger||(e.Xbox360Trigger={}));var v;!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(v=e.UserInputPointer||(e.UserInputPointer={}));var M;!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.ClientX=2]="ClientX",e[e.ClientY=3]="ClientY",e[e.MouseX=4]="MouseX",e[e.MouseY=5]="MouseY",e[e.Wheel=6]="Wheel"}(M=e.UserInputAxis||(e.UserInputAxis={}));var b;!function(e){e[e.BackSpace=8]="BackSpace",e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.Pause=19]="Pause",e[e.Break=19]="Break",e[e.CapsLock=20]="CapsLock",e[e.Escape=27]="Escape",e[e.SpaceBar=32]="SpaceBar",e[e.PageUp=33]="PageUp",e[e.PageDown=34]="PageDown",e[e.End=35]="End",e[e.Home=36]="Home",e[e.LeftArrow=37]="LeftArrow",e[e.UpArrow=38]="UpArrow",e[e.RightArrow=39]="RightArrow",e[e.DownArrow=40]="DownArrow",e[e.Insert=45]="Insert",e[e.Delete=46]="Delete",e[e.Num0=48]="Num0",e[e.Num1=49]="Num1",e[e.Num2=50]="Num2",e[e.Num3=51]="Num3",e[e.Num4=52]="Num4",e[e.Num5=53]="Num5",e[e.Num6=54]="Num6",e[e.Num7=55]="Num7",e[e.Num8=56]="Num8",e[e.Num9=57]="Num9",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.LeftWindowKey=91]="LeftWindowKey",e[e.RightWindowKey=92]="RightWindowKey",e[e.SelectKey=93]="SelectKey",e[e.Numpad0=96]="Numpad0",e[e.Numpad1=97]="Numpad1",e[e.Numpad2=98]="Numpad2",e[e.Numpad3=99]="Numpad3",e[e.Numpad4=100]="Numpad4",e[e.Numpad5=101]="Numpad5",e[e.Numpad6=102]="Numpad6",e[e.Numpad7=103]="Numpad7",e[e.Numpad8=104]="Numpad8",e[e.Numpad9=105]="Numpad9",e[e.Multiply=106]="Multiply",e[e.Add=107]="Add",e[e.Subtract=109]="Subtract",e[e.DecimalPoint=110]="DecimalPoint",e[e.Divide=111]="Divide",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NumLock=144]="NumLock",e[e.ScrollLock=145]="ScrollLock",e[e.SemiColon=186]="SemiColon",e[e.EqualSign=187]="EqualSign",e[e.Comma=188]="Comma",e[e.Dash=189]="Dash",e[e.Period=190]="Period",e[e.ForwardSlash=191]="ForwardSlash",e[e.GraveAccent=192]="GraveAccent",e[e.OpenBracket=219]="OpenBracket",e[e.BackSlash=220]="BackSlash",e[e.CloseBraket=221]="CloseBraket",e[e.SingleQuote=222]="SingleQuote"}(b=e.UserInputKey||(e.UserInputKey={}));var T;!function(e){e[e.DirectVelocity=0]="DirectVelocity",e[e.AppliedForces=1]="AppliedForces"}(T=e.MovementType||(e.MovementType={}));var x;!function(e){e[e.Top=0]="Top",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Bottom=3]="Bottom"}(x=e.CollisionContact||(e.CollisionContact={}));var w;!function(e){e[e.AABB=0]="AABB",e[e.OBB=1]="OBB"}(w=e.IntersectionPrecision||(e.IntersectionPrecision={}));var k;!function(e){e[e.If=1]="If",e[e.IfNot=2]="IfNot",e[e.Greater=3]="Greater",e[e.Less=4]="Less",e[e.Equals=6]="Equals",e[e.NotEqual=7]="NotEqual"}(k=e.ConditionMode||(e.ConditionMode={}));var P;!function(e){e[e.None=0]="None",e[e.Source=1]="Source",e[e.Destination=2]="Destination",e[e.SourceThenDestination=3]="SourceThenDestination",e[e.DestinationThenSource=4]="DestinationThenSource"}(P=e.InterruptionSource||(e.InterruptionSource={}));var I;!function(e){e[e.Simple1D=0]="Simple1D",e[e.SimpleDirectional2D=1]="SimpleDirectional2D",e[e.FreeformDirectional2D=2]="FreeformDirectional2D",e[e.FreeformCartesian2D=3]="FreeformCartesian2D",e[e.Direct=4]="Direct",e[e.Clip=5]="Clip"}(I=e.BlendTreeType||(e.BlendTreeType={}));var C;!function(e){e[e.Lower=0]="Lower",e[e.Upper=1]="Upper"}(C=e.BlendTreePosition||(e.BlendTreePosition={}));var A=function(){function e(){}return e.JoystickRightHandleColor="yellow",e.JoystickLeftSensibility=1,e.JoystickRightSensibility=1,e.JoystickDeadStickValue=.1,e.GamepadDeadStickValue=.25,e.GamepadLStickXInverted=!1,e.GamepadLStickYInverted=!1,e.GamepadRStickXInverted=!1,e.GamepadRStickYInverted=!1,e.GamepadLStickSensibility=1,e.GamepadRStickSensibility=1,e.PointerAngularSensibility=1,e.PointerWheelDeadZone=.1,e}();e.UserInputOptions=A}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,n){if(this._ie=!1,this._url="",this._time=0,this._timing=!1,this._filename=null,this._render=null,this._running=!1,this._input=!1,this._scene=null,this._navmesh=null,this._navigation=null,this._loadQueueIndex=0,this._loadQueueCount=0,this._loadQueueScenes=null,this._localReadyState=null,this._localSceneReady=!1,this._advancedTexture=null,this._sunlightDirection=null,this._sunlightIdentifier=null,this._environmentTextureName=null,this._playerOneCamera=null,this._playerOneElement=null,this._playerTwoCamera=null,this._playerTwoElement=null,this._playerThreeCamera=null,this._playerThreeElement=null,this._playerFourCamera=null,this._playerFourElement=null,this._onready=[],null==n)throw new Error("Null host scene obejct specified.");if(this._ie=!!document.all,this._url=t,this._time=0,this._timing=!1,this._filename=null,this._scene=n,this._input=!1,this._onready=[],this._navmesh=null,this._navigation=null,this._loadQueueIndex=0,this._loadQueueCount=0,this._loadQueueScenes=null,this._localSceneReady=!1,this._localReadyState={state:"localReadyState"},this._sunlightDirection=e.Vector3.Zero(),this._sunlightIdentifier=null,this._advancedTexture=null,this._playerOneCamera=null,this._playerOneElement=null,this._playerTwoCamera=null,this._playerTwoElement=null,this._playerThreeCamera=null,this._playerThreeElement=null,this._playerFourCamera=null,this._playerFourElement=null,this._environmentTextureName=null,e.SceneManager.me=this,e.SceneManager.engine=this._scene.getEngine(),e.SceneManager.prefabs={},e.SceneManager.orphans=null,e.SceneManager.stereoCameras=!0,e.SceneManager.multiPlayerView=!1,e.SceneManager.multiPlayerCount=1,e.SceneManager.rightHanded=this._scene.useRightHandedSystem,e.SceneManager.showRenderStats=!1,e.SceneManager.sceneRenderStats=0,e.SceneManager.staticVertexLimit=!1,e.SceneManager.showDebugSockets=!1,e.SceneManager.colliderVisibility=.25,e.SceneManager.socketColliderSize=.125,e.SceneManager.engine.webGLVersion<2&&e.Tools.Warn("Babylon.js performance monitor detected webgl version 1."),this.addLoadingState(this._localReadyState),null!=this._scene.metadata&&null!=this._scene.metadata.properties){if(this._scene.metadata.properties.sceneFilename&&null!=this._scene.metadata.properties.sceneFilename&&(this._filename=this._scene.metadata.properties.sceneFilename),this._scene.metadata.properties.sunlightIndentifier&&null!=this._scene.metadata.properties.sunlightIndentifier&&(this._sunlightIdentifier=this._scene.metadata.properties.sunlightIndentifier),this._scene.metadata.properties.sunlightDirection&&null!=this._scene.metadata.properties.sunlightDirection){var a=this._scene.metadata.properties.sunlightDirection;null!=a&&a.length>=3&&(this._sunlightDirection=new e.Vector3(a[0],a[1],a[2]))}this._scene.metadata.properties.environmentTextureName&&null!=this._scene.metadata.properties.environmentTextureName&&(this._environmentTextureName=this._scene.metadata.properties.environmentTextureName),this._scene.metadata.properties.colliderVisibility&&null!=this._scene.metadata.properties.colliderVisibility&&(e.SceneManager.colliderVisibility=this._scene.metadata.properties.colliderVisibility),this._scene.metadata.properties.socketColliderSize&&null!=this._scene.metadata.properties.socketColliderSize&&(e.SceneManager.socketColliderSize=this._scene.metadata.properties.socketColliderSize),this._scene.metadata.properties.sceneRenderStats&&null!=this._scene.metadata.properties.sceneRenderStats&&(e.SceneManager.sceneRenderStats=this._scene.metadata.properties.sceneRenderStats),this._scene.metadata.properties.hasOwnProperty("showRenderStats")&&(e.SceneManager.showRenderStats=this._scene.metadata.properties.showRenderStats),this._scene.metadata.properties.hasOwnProperty("showDebugSockets")&&(e.SceneManager.showDebugSockets=this._scene.metadata.properties.showDebugSockets),this._scene.metadata.properties.hasOwnProperty("staticVertexLimit")&&(e.SceneManager.staticVertexLimit=this._scene.metadata.properties.staticVertexLimit);var r=(this._scene.metadata.properties.physicsEngine?this._scene.metadata.properties.physicsEngine:"cannon",!!this._scene.metadata.properties.enablePhysics&&this._scene.metadata.properties.enablePhysics);if(r===!0){var i=new e.CannonJSPlugin((!1),10);this._scene.enablePhysics(this._scene.gravity,i)}this._scene.metadata.properties.hasOwnProperty("graphicUserInterface")&&this._scene.metadata.properties.graphicUserInterface===!0&&(this._advancedTexture=e.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"))}var o=[];e.SceneManager.parseSceneCameras(this._scene.cameras,this._scene,o),e.SceneManager.parseSceneLights(this._scene.lights,this._scene,o),e.SceneManager.parseSceneMeshes(this._scene.meshes,this._scene,o),o.length>0&&(o.sort(function(e,t){return e.order<t.order?-1:e.order>t.order?1:0}),o.forEach(function(e){e.instance.register()})),"undefined"!=typeof Stats&&e.SceneManager.showRenderStats===!0&&null==e.SceneManager.renderStatsInstance&&(e.SceneManager.renderStatsInstance=new Stats,e.SceneManager.renderStatsInstance.showPanel(e.SceneManager.sceneRenderStats),document.body.appendChild(e.SceneManager.renderStatsInstance.dom));var s=this;this._render=function(){null!=s&&s._running===!0&&(e.SceneManager.showRenderStats===!0&&null!=e.SceneManager.renderStatsInstance&&e.SceneManager.renderStatsInstance.begin(),s._timing&&(s._time+=s.deltaTime,s._time>=e.SceneManager.max&&(s._time=0)),s._input&&e.SceneManager.updateUserInput(),null!=s._scene&&s._scene.render(),e.SceneManager.showRenderStats===!0&&null!=e.SceneManager.renderStatsInstance&&e.SceneManager.renderStatsInstance.end())},this._scene.onDispose=function(){null!=s&&s.dispose()}}return t.GetInstance=function(){return e.SceneManager.me?e.SceneManager.me:null},t.GetStatistics=function(){return e.SceneManager.showRenderStats===!0&&null!=e.SceneManager.renderStatsInstance?e.SceneManager.renderStatsInstance:null},t.IsMobile=function(){var e=!1;if(null!=navigator&&null!=navigator.userAgent){var t=navigator.userAgent;(t.match(/Android/i)||t.match(/webOS/i)||t.match(/iPhone/i)||t.match(/iPad/i)||t.match(/iPod/i)||t.match(/BlackBerry/i)||t.match(/Windows Phone/i))&&(e=!0)}return e},t.IsWindows=function(){return"undefined"!=typeof Windows&&"undefined"!=typeof Windows.UI&&"undefined"!=typeof Windows.System&&"undefined"!=typeof Windows.Foundation},t.IsXboxOne=function(){var t=!1;if(e.SceneManager.IsWindows()&&"undefined"!=typeof Windows.System.Profile&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo.versionInfo&&"undefined"!=typeof Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily){var n=Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily;n.match(/Xbox/i)&&(t=!0)}return t},t.IsXboxLive=function(){return e.SceneManager.IsWindows()&&"undefined"!=typeof Microsoft&&"undefined"!=typeof Microsoft.Xbox&&"undefined"!=typeof Microsoft.Xbox.Services},t.IsWebAssembly=function(){return"undefined"!=typeof WebAssembly},t.IsStereoCameras=function(){return e.SceneManager.stereoCameras},t.IsMultiPlayerView=function(){return e.SceneManager.multiPlayerView},t.GetMultiPlayerCount=function(){return e.SceneManager.multiPlayerCount},t.RegisterLoader=function(t){e.SceneManager.loader=t},t.OnWindowLoad=function(e){null!=e&&(window.onload=e)},t.ExecuteWhenReady=function(t){null!=t&&e.SceneManager.readies.push(t)},t.CreateManagerSession=function(t,n){var a=n;return null!=a.manager&&(a.manager.dispose(),a.manager=null),a.manager=new e.SceneManager(t,n),null!=a.manager&&a.manager._executeWhenReady(),a.manager},t.CreateGenericPromise=function(e){return window.createGenericPromise?window.createGenericPromise(e):null},t.ResolveGenericPromise=function(e){return window.resolveGenericPromise?window.resolveGenericPromise(e):null},t.GetQueryStringParam=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),a=n.exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null},t.GetWebGLVersionString=function(){var t="WebGL - Unknown";if(null!=e.SceneManager.engine){var n=e.SceneManager.engine;if(null!=n){var a=n.getGlInfo();null!=a&&(t=a.version+" - "+a.renderer)}}return t},t.GetWebGLVersionNumber=function(){var t=0;if(null!=e.SceneManager.engine){var n=e.SceneManager.engine;null!=n&&(t=n.webGLVersion)}return t},t.GetHtmlMarkup=function(t){var n=null;if(null!=t&&""!==t){var a=t.toLowerCase();n=null!=e.SceneManager.MarkupStore[a]?e.SceneManager.MarkupStore[a]:null}return n},t.CreateScene=function(t){var n=new e.Scene(t);return e.SceneManager.parseSceneMetadata("/",n),n},t.Alert=function(t,n){void 0===n&&(n="Babylon.js");var a=null;return e.SceneManager.IsWindows()?a=new Windows.UI.Popups.MessageDialog(t,n).showAsync():window.alert(t),a},Object.defineProperty(t,"StaticIndex",{get:function(){return 30},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PrefabIndex",{get:function(){return 31},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ie",{get:function(){return this._ie},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"running",{get:function(){return this._running},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deltaTime",{get:function(){return null!=e.SceneManager.engine?e.SceneManager.engine.getDeltaTime()/1e3:0},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.dispose=function(){e.SceneManager.me=null,e.SceneManager.engine=null,e.SceneManager.prefabs=null,e.SceneManager.orphans=null,e.SceneManager.stereoCameras=!0,e.SceneManager.rightHanded=!0,null!=e.SceneManager.orphans&&(e.SceneManager.orphans.dispose(),e.SceneManager.orphans=null),this.disableUserInput(),this._time=0,this._render=null,this._navmesh=null,this._timing=!1,this._onready=null,this._navigation=null,this._playerOneCamera=null,null!=this._playerTwoCamera&&(this._playerTwoCamera.dispose(),this._playerTwoCamera=null),null!=this._playerThreeCamera&&(this._playerThreeCamera.dispose(),this._playerThreeCamera=null),null!=this._playerFourCamera&&(this._playerFourCamera.dispose(),this._playerFourCamera=null),null!=this._playerOneElement&&(this._playerOneElement.dispose(),this._playerOneElement=null),null!=this._playerTwoElement&&(this._playerTwoElement.dispose(),this._playerTwoElement=null),null!=this._playerThreeElement&&(this._playerThreeElement.dispose(),this._playerThreeElement=null),null!=this._playerFourElement&&(this._playerFourElement.dispose(),this._playerFourElement=null),null!=this._advancedTexture&&(this._advancedTexture.dispose(),this._advancedTexture=null);var t=this._scene;t.manager&&(t.manager=null),t=null,this._scene=null},t.prototype.alert=function(t,n){return void 0===n&&(n="Babylon.js"),e.SceneManager.Alert(t,n)},t.prototype.once=function(e){var t=this;if(null!=e){var n=!1,a=null;a=function(){t._scene.unregisterBeforeRender(a),a=null,n===!1&&(n=!0,e())},this._scene.registerBeforeRender(a)}},t.prototype.delay=function(e,t){var n=this,a=null;return a=window.requestTimeout(function(){null!=a&&n.cancelDelay(a),null!=e&&e()},t)},t.prototype.cancelDelay=function(e){window.clearRequestTimeout(e)},t.prototype.repeat=function(e,t){return window.requestInterval(e,t)},t.prototype.cancelRepeat=function(e){window.clearRequestInterval(e)},t.prototype.enableTime=function(){this._time=0,this._timing=!0},t.prototype.disableTime=function(){this._time=0,this._timing=!1},t.prototype.loadLevel=function(t,n){if(void 0===n&&(n=null),null==e.SceneManager.loader)throw new Error("No scene loader function registered.");var a=null!=n&&""!==n?n:this.getScenePath();this.stop(),this._scene.dispose(),e.SceneManager.loader(a,t)},t.prototype.importMeshes=function(t,n,a,r){void 0===n&&(n=null),void 0===a&&(a=null),void 0===r&&(r=null),e.SceneLoader.ImportMesh("",this.getScenePath(),t,this._scene,function(e,t,a){null!=n&&n()},a,r)},t.prototype.safeDestroy=function(t,n,a){void 0===n&&(n=5),void 0===a&&(a=!1),a===!0&&t.setEnabled(!1),e.SceneManager.DestroyComponents(t),n>0?this.delay(function(){e.SceneManager.DisposeOwner(t)},n):e.SceneManager.DisposeOwner(t)},t.prototype.getMainCamera=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=null;switch(t){case e.PlayerNumber.One:n=this._playerOneCamera;break;case e.PlayerNumber.Two:n=this._playerTwoCamera;break;case e.PlayerNumber.Three:n=this._playerThreeCamera;break;case e.PlayerNumber.Four:n=this._playerFourCamera}return n},t.prototype.getSceneName=function(){return null!=this._filename&&""!==this._filename?this._filename:"Unknown.babylon";
},t.prototype.getScenePath=function(){return null!=this._url&&""!==this._url?this._url:"/"},t.prototype.getSunlight=function(){return null!=this._sunlightIdentifier&&""!==this._sunlightIdentifier?this._scene.getLightByID(this._sunlightIdentifier):null},t.prototype.getSunlightDirection=function(){return this._sunlightDirection},t.prototype.getAdvancedTexture=function(){return this._advancedTexture},t.prototype.getEnvironmentTextureName=function(){return this._environmentTextureName},t.prototype.showFullscreen=function(t){void 0===t&&(t=null);var n=null!=t?t:document.documentElement;e.Tools.RequestFullscreen(n),n.focus()},t.prototype.exitFullscreen=function(){e.Tools.ExitFullscreen()},t.prototype.addLoadingState=function(e){this._scene._addPendingData(e)},t.prototype.removeLoadingState=function(e){this._scene._removePendingData(e)},t.prototype.onready=function(e){null!=e&&(this._localSceneReady===!0?e():this._onready.push(e))},t.prototype._executeWhenReady=function(){null!=this._scene.metadata&&null!=this._scene.metadata.imports?(this._loadQueueIndex=0,this._loadQueueScenes=this._scene.metadata.imports,this._loadQueueScenes.length>0?(this._loadQueueCount=this._loadQueueScenes.length,this._loadQueueImports()):this._executeLocalReady()):this._executeLocalReady()},t.prototype._executeLocalReady=function(){var t=this;if(null!=e.SceneManager.readies&&e.SceneManager.readies.length>0&&e.SceneManager.readies.forEach(function(e){e(t._scene,t)}),e.SceneManager.readies=[],null!=this._onready&&this._onready.length>0&&(this._onready.forEach(function(e){e()}),this._onready=null),this._localSceneReady=!0,null!=this._scene.metadata&&null!=this._scene.metadata.properties&&(this._scene.metadata.properties.timeManagement===!0&&this.enableTime(),this._scene.metadata.properties.enableUserInput===!0)){var n=this._scene.metadata.properties.userInput,a=n.joystickInputValue;0!==a&&this._scene.metadata.properties.virtualJoystickAttached===!0&&(a=0,e.Tools.Warn("Virtual joystick camera attached, disabled manual joystick input.")),this.enableUserInput({preventDefault:this._scene.metadata.properties.preventDefault,useCapture:this._scene.metadata.properties.useCapture,enableVirtualJoystick:1===a||2===a&&e.SceneManager.IsMobile(),disableRightStick:n.disableRightStick});var r=n.joystickRightColorText;null!=r&&""!==r&&(e.UserInputOptions.JoystickRightHandleColor=r),e.UserInputOptions.JoystickLeftSensibility=n.joystickLeftLevel,e.UserInputOptions.JoystickRightSensibility=n.joystickRightLevel,e.UserInputOptions.JoystickDeadStickValue=n.joystickDeadStick,e.UserInputOptions.GamepadDeadStickValue=n.padDeadStick,e.UserInputOptions.GamepadLStickXInverted=n.padLStickXInvert,e.UserInputOptions.GamepadLStickYInverted=n.padLStickYInvert,e.UserInputOptions.GamepadRStickXInverted=n.padRStickXInvert,e.UserInputOptions.GamepadRStickYInverted=n.padRStickYInvert,e.UserInputOptions.GamepadLStickSensibility=n.padLStickLevel,e.UserInputOptions.GamepadRStickSensibility=n.padRStickLevel,e.UserInputOptions.PointerAngularSensibility=n.mouseAngularLevel,e.UserInputOptions.PointerWheelDeadZone=n.wheelDeadZone}null!=this._localReadyState&&(this.removeLoadingState(this._localReadyState),this._localReadyState=null)},t.prototype._loadQueueImports=function(){var t=this,n=this._loadQueueIndex+1;if(n>this._loadQueueCount)this._loadQueueIndex=0,this._loadQueueCount=0,this._loadQueueScenes=null,this._executeLocalReady();else{var a=this._loadQueueScenes[this._loadQueueIndex];e.Tools.Log("Importing scene meshes: "+a),this._loadQueueIndex++,this.importMeshes(a,function(){t._loadQueueImports()},null,function(n,a,r){e.Tools.Warn(a),t._loadQueueImports()})}},t.prototype.start=function(){this._running=!0,this._scene.getEngine().runRenderLoop(this._render)},t.prototype.stop=function(){this._running=!1,this._scene.getEngine().stopRenderLoop(this._render)},t.prototype.toggle=function(){this._running?(this.pauseAudio(),this.stop()):(this.resumeAudio(),this.start())},t.prototype.stepFrame=function(){this._running?this.toggle():this._render()},t.prototype.pauseAudio=function(){this._scene.audioEnabled===!0&&(this._scene.audioEnabled=!1)},t.prototype.resumeAudio=function(){this._scene.audioEnabled===!1&&(this._scene.audioEnabled=!0)},t.prototype.popupDebug=function(e){void 0===e&&(e=0),this._scene.debugLayer&&(this._scene.debugLayer.hide(),this._scene.debugLayer.show({popup:!0,initialTab:e,parentElement:null}))},t.prototype.toggleDebug=function(t,n,a){if(void 0===t&&(t=!1),void 0===n&&(n=0),void 0===a&&(a=null),this._scene.debugLayer)if(e.SceneManager.debugLayerVisible===!0){if(e.SceneManager.debugLayerVisible=!1,null!=e.SceneManager.renderStatsInstance&&null!=e.SceneManager.renderStatsInstance.dom){var r=e.SceneManager.renderStatsInstance.dom;r.style.visibility="visible"}this._scene.debugLayer.hide()}else{if(e.SceneManager.debugLayerVisible=!0,null!=e.SceneManager.renderStatsInstance&&null!=e.SceneManager.renderStatsInstance.dom){var r=e.SceneManager.renderStatsInstance.dom;r.style.visibility="hidden"}this._scene.debugLayer.show({popup:t,initialTab:n,parentElement:a})}},t.prototype.setMultiPlayerViewLayout=function(t){var n=!1,a=e.Scalar.Clamp(t,1,4);if(e.SceneManager.IsMultiPlayerView()){var r=[];null!=this._playerOneCamera&&null!=this._playerTwoCamera&&null!=this._playerThreeCamera&&null!=this._playerFourCamera?1===a?(this._playerOneCamera.viewport=new e.Viewport(0,0,1,1),this._playerTwoCamera.viewport=new e.Viewport(0,0,0,0),this._playerTwoCamera.setEnabled(!1),this._playerThreeCamera.viewport=new e.Viewport(0,0,0,0),this._playerThreeCamera.setEnabled(!1),this._playerFourCamera.viewport=new e.Viewport(0,0,0,0),this._playerFourCamera.setEnabled(!1),r.push(this._playerOneCamera)):2===a?(e.SceneManager.stereoCameras===!0?(this._playerOneCamera.viewport=new e.Viewport(0,0,.5,1),this._playerTwoCamera.viewport=new e.Viewport(.5,0,.5,1)):(this._playerOneCamera.viewport=new e.Viewport(0,.5,1,.5),this._playerTwoCamera.viewport=new e.Viewport(0,0,1,.5)),this._playerTwoCamera.setEnabled(!0),this._playerThreeCamera.viewport=new e.Viewport(0,0,0,0),this._playerThreeCamera.setEnabled(!1),this._playerFourCamera.viewport=new e.Viewport(0,0,0,0),this._playerFourCamera.setEnabled(!1),r.push(this._playerOneCamera),r.push(this._playerTwoCamera)):3===a?(this._playerOneCamera.viewport=new e.Viewport(0,0,.5,1),this._playerTwoCamera.viewport=new e.Viewport(.5,.5,.5,.5),this._playerTwoCamera.setEnabled(!0),this._playerThreeCamera.viewport=new e.Viewport(.5,0,.5,.5),this._playerThreeCamera.setEnabled(!0),this._playerFourCamera.viewport=new e.Viewport(0,0,0,0),this._playerFourCamera.setEnabled(!1),r.push(this._playerOneCamera),r.push(this._playerTwoCamera),r.push(this._playerThreeCamera)):4===a&&(this._playerOneCamera.viewport=new e.Viewport(0,.5,.5,.5),this._playerTwoCamera.viewport=new e.Viewport(0,0,.5,.5),this._playerTwoCamera.setEnabled(!0),this._playerThreeCamera.viewport=new e.Viewport(.5,.5,.5,.5),this._playerThreeCamera.setEnabled(!0),this._playerFourCamera.viewport=new e.Viewport(.5,0,.5,.5),this._playerFourCamera.setEnabled(!0),r.push(this._playerOneCamera),r.push(this._playerTwoCamera),r.push(this._playerThreeCamera),r.push(this._playerFourCamera)):e.Tools.Warn("Babylon.js camera rig failed to initialize multi player cameras"),r.length>0?(e.SceneManager.multiPlayerCount=a,this._scene.activeCameras=r,n=!0):e.Tools.Warn("Babylon.js camera rig failed to initialize multi player views")}else e.Tools.Warn("Babylon.js camera rig multi player view option not enabled");return n},t.prototype.getMultiPlayerViewElement=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=null;if(e.SceneManager.IsMultiPlayerView())switch(t){case e.PlayerNumber.One:n=this._playerOneElement;break;case e.PlayerNumber.Two:n=this._playerTwoElement;break;case e.PlayerNumber.Three:n=this._playerThreeElement;break;case e.PlayerNumber.Four:n=this._playerFourElement}return n},t.prototype.rayCast=function(e,t,n){return this._scene.pickWithRay(e,t,n)},t.prototype.multiRayCast=function(e,t){return this._scene.multiPickWithRay(e,t)},t.prototype.getMaterialInstance=function(e,t){void 0===t&&(t=null);var n=this._scene.getMaterialByName(e);return null==n&&null!=t&&(n=t(e)),null!=n?n:null},t.prototype.hasPrefabMesh=function(t){var n="Prefab."+t;return null!=e.SceneManager.prefabs[n]},t.prototype.getPrefabMesh=function(t){var n=null,a="Prefab."+t;return this.hasPrefabMesh(t)&&(n=e.SceneManager.prefabs[a]),n},t.prototype.instantiatePrefab=function(t,n,a,r,i,o){var s=this;void 0===a&&(a=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null);var l=null;if(null!=this._scene){var u="Prefab."+t;if(this.hasPrefabMesh(t)){var c=this.getPrefabMesh(t);if(null!=c)if(l=c.clone(n,o,!1,!1),null!=l){l.name=e.Utilities.ReplaceAll(l.name,"Prefab.",""),l.parent!==o&&(l.parent=o),null!=a&&(l.position=a),null!=r&&(l.rotation=r),null!=i&&(l.scaling=i);var p=[l],d=l.getChildMeshes(!1);null!=d&&d.length>0&&d.forEach(function(t){t.name=e.Utilities.ReplaceAll(t.name,"Prefab.",""),p.push(t)}),p.forEach(function(e){if(e.setEnabled(!0),null!=e.source){var t=e;if(null==e.skeleton&&null!=e.source.skeleton){var n=e.source.skeleton.name+".Skeleton",a=n+"."+e.source.skeleton.id;e.skeleton=e.source.skeleton.clone(n,a)}if((null==t._LODLevels||t._LODLevels.length<=0)&&null!=t.source&&null!=t.source._LODLevels&&t.source._LODLevels.length>0){var r=t.source._LODLevels,i=r.length,o=0,s=[];for(o=0;o<i;o++){var l=r[o],u=l.mesh,c=null!=u?u.clone(u.name.replace("Prefab.",""),e,!1,!1):null;s.push({distance:l.distance,mesh:c})}null!=s&&s.length>0&&s.forEach(function(t){e.addLODLevel(t.distance,t.mesh)})}}});var m=[];p.forEach(function(t){if(null!=t.metadata&&t.metadata.tagName&&null!=t.metadata.tagName&&"[INSTANCE]"===t.metadata.tagName)if(t.metadata.properties&&null!=t.metadata.properties&&t.metadata.properties.prefabSource&&null!=t.metadata.properties.prefabSource&&""!==t.metadata.properties.prefabSource){var n=t.metadata.properties.prefabSource,a=t.metadata.properties.prefabOffset,r=t.metadata.properties.prefabPosition,i=s._scene.getMeshByID(n);if(null!=i){var o=t.name,l=i.createInstance(o);null!=l?(l.parent=t.parent,null!=i.metadata&&(l.metadata=e.SceneManager.CloneMetadata(i.metadata)),a===!0&&null!=r&&r.length>=3&&(l.position=new e.Vector3(r[0],r[1],r[2])),m.push(l),s.safeDestroy(t)):e.Tools.Warn("===> Failed to create instance: "+o)}else e.Tools.Warn("===> Failed to locate prefab source: "+n)}else e.Tools.Warn("===> Failed to parse prefab metadata: "+t.name);else m.push(t)}),null!=m&&m.length>0&&e.SceneManager.parseMeshMetadata(m,this._scene)}else e.Tools.Warn("Failed to create prefab of: "+u);else e.Tools.Warn("Failed to lookup prefab map: "+u)}else e.Tools.Warn("Unable to locate prefab master: "+u)}return l},t.prototype.tween=function(t,n,a,r,i,o,s,l,u,c,p){void 0===o&&(o=30),void 0===s&&(s=null),void 0===l&&(l=1),void 0===u&&(u=null),void 0===c&&(c=e.Animation.ANIMATIONLOOPMODE_RELATIVE),void 0===p&&(p=!1);var d="Tween_"+this.time.toString();return e.Animation.CreateAndStartAnimation(d,t,n,o,i,a,r,c,s,u)},t.prototype.tweenKeys=function(t,n,a,r,i,o,s,l,u,c,p){void 0===i&&(i=30),void 0===o&&(o=null),void 0===s&&(s=1),void 0===l&&(l=null),void 0===u&&(u=e.Animation.ANIMATIONTYPE_VECTOR3),void 0===c&&(c=e.Animation.ANIMATIONLOOPMODE_RELATIVE),void 0===p&&(p=!1);var d=null!=i&&i>0?i:30,m="Tween_"+this.time.toString(),h=new e.Animation(m,n,d,u,c,p);return null!=o&&h.setEasingFunction(o),h.setKeys(a),this._scene.beginDirectAnimation(t,[h],0,r,c==e.Animation.ANIMATIONLOOPMODE_RELATIVE,s,l)},t.prototype.tweenFloat=function(t,n,a,r,i,o,s,l,u,c,p){void 0===o&&(o=30),void 0===s&&(s=null),void 0===l&&(l=1),void 0===u&&(u=null),void 0===c&&(c=e.Animation.ANIMATIONLOOPMODE_RELATIVE),void 0===p&&(p=!1);var d=null!=o&&o>0?o:30,m=[{frame:0,value:a},{frame:i,value:r}],h="Tween_"+this.time.toString(),g=e.Animation.ANIMATIONTYPE_FLOAT,f=new e.Animation(h,n,d,g,c,p);return null!=s&&f.setEasingFunction(s),f.setKeys(m),this._scene.beginDirectAnimation(t,[f],0,i,c==e.Animation.ANIMATIONLOOPMODE_RELATIVE,l,u)},t.prototype.playAnimationClip=function(e,t,n,a,r,i,o){void 0===n&&(n=0),void 0===a&&(a=1),void 0===r&&(r=!0),void 0===i&&(i=null),void 0===o&&(o=null);var s=null,l=-1,u=-1,c=0,p=!1,d=!1,m=null,h=this.findSceneAnimationClip(e,t);if(null!=h&&(d=!0,m=o,l===-1&&(l=h.start,u=h.stop,c=h.behavior,p=h.behavior<2)),r){var g=t.getChildMeshes(!1);if(null!=g&&g.length>0)for(var f=0;f<g.length;f++){var y=g[f],S=null,_=this.findSceneAnimationClip(e,y);if(null!=_&&(d===!1&&(d=!0,S=o),l===-1&&(l=_.start,u=_.stop,c=_.behavior,p=_.behavior<2),l>=0&&u>=0)){this.setAnimationProperties(y,c,n);var v=null;null!=i?this._scene.beginDirectAnimation(y,i,l,u,p,a,S):this._scene.beginAnimation(y,l,u,p,a,S),null!=v&&(null==s&&(s=[]),s.push(v))}}}if(l>=0&&u>=0){this.setAnimationProperties(t,c,n);var M=null;null!=i?this._scene.beginDirectAnimation(t,i,l,u,p,a,m):this._scene.beginAnimation(t,l,u,p,a,m),null!=M&&(null==s&&(s=[]),s.push(M))}return s},t.prototype.getAnimationClips=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!1);var a=this.findSceneAnimationClips(e);if(null==a&&t===!0){var r=e.getChildMeshes(n);if(null!=r&&r.length>0)for(var i=0;i<r.length;i++){var o=r[i];if(a=this.findSceneAnimationClips(o),null!=a)break}}return a},t.prototype.getAnimationTargets=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!1);var a=null;if(null!=e.metadata&&null!=e.metadata.animationClips&&e.metadata.animationClips.length>0&&(null==a&&(a=[]),a.push(e)),t===!0){var r=e.getChildMeshes(n);if(null!=r&&r.length>0)for(var i=0;i<r.length;i++){var o=r[i];null!=o&&null!=o.metadata&&null!=o.metadata.animationClips&&o.metadata.animationClips.length>0&&(null==a&&(a=[]),a.push(o))}}return a},t.prototype.setAnimationProperties=function(t,n,a){if(null!=t&&(null!=t.animations&&t.animations.length>0&&e.SceneManager.SetAnimationLooping(t,n),t instanceof e.AbstractMesh)){var r=t;null!=r.skeleton&&e.SceneManager.SetSkeletonProperties(r.skeleton,n,a)}},t.prototype.applyForce=function(e,t,n){null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&null!=t&&e.physicsImpostor.applyForce(t,n)},t.prototype.applyImpulse=function(e,t,n){null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&null!=t&&e.physicsImpostor.applyImpulse(t,n)},t.prototype.applyFriction=function(e,t){null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&null!=e.physicsImpostor.physicsBody.material&&e.physicsImpostor.physicsBody.material.friction!==t&&(e.physicsImpostor.physicsBody.material.friction=t)},t.prototype.getFrictionLevel=function(e){var t=0;return null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&null!=e.physicsImpostor.physicsBody.material&&(t=e.physicsImpostor.physicsBody.material.friction),t},t.prototype.getLinearVelocity=function(e){var t=null;return null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&(t=e.physicsImpostor.getLinearVelocity()),t},t.prototype.setLinearVelocity=function(e,t){null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&null!=t&&e.physicsImpostor.setLinearVelocity(t)},t.prototype.getAngularVelocity=function(e){var t=null;return null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&(t=e.physicsImpostor.getAngularVelocity()),t},t.prototype.setAngularVelocity=function(e,t){null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&null!=t&&e.physicsImpostor.setAngularVelocity(t)},t.prototype.checkCollisionContact=function(e,t,n,a){void 0===a&&(a=.5);var r=!1;return null!=e&&null!=e.physicsImpostor&&null!=e.physicsImpostor.physicsBody&&(r=!0),r},t.prototype.moveWithCollisions=function(t,n,a){void 0===a&&(a=0),null!=t&&(0!=a&&t.rotate(e.Axis.Y,a),null!=n&&t.moveWithCollisions(n))},t.prototype.moveWithTranslation=function(t,n,a){void 0===a&&(a=0),null!=t&&(0!=a&&t.rotate(e.Axis.Y,a),null!=n&&t.position.addInPlace(n))},t.prototype.addSceneComponent=function(t,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={});var i=null;if(null==n)throw new Error("Null owner scene obejct specified.");if(null==t||""===t)throw new Error("Null scene obejct klass specified.");if(null==n.metadata||!n.metadata.api){var o={api:!0,type:"Babylon",prefab:!1,state:{},objectName:"Scene Component",objectId:"0",tagName:"Untagged",layerIndex:0,layerName:"Default",areaIndex:-1,navAgent:null,meshLink:null,meshObstacle:null,socketList:[],animationClips:[],animationEvents:[],collisionEvent:null,components:[],properties:{}};n.metadata=o}if(null!=n.metadata&&n.metadata.api){var o=n.metadata;if(null==o.components&&(o.components=[]),null!=o.components){var s=e.Tools.Instantiate(t);if(null!=s)if(i=new s(n,this._scene,a,r),null!=i){var l={order:1e3,name:"EditorScriptComponent",klass:t,update:a,properties:r,instance:i,tag:{}};o.components.push(l),i.register()}else e.Tools.Error("Failed to create component instance");else e.Tools.Error("Failed to create component class")}else e.Tools.Error("Failed to parse metadata components")}else e.Tools.Error("Null owner object metadata");return i},t.prototype.findSceneComponent=function(e,t){var n=null;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=t.metadata&&t.metadata.api){var a=t.metadata;if(null!=a.components&&a.components.length>0)for(var r=0;r<a.components.length;r++){var i=a.components[r];if(null!=i.instance&&i.klass===e){n=i.instance;break}}}return null!=n?n:null},t.prototype.findSceneComponents=function(e,t){var n=null;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=t.metadata&&t.metadata.api){var a=t.metadata;if(null!=a.components&&a.components.length>0)for(var r=0;r<a.components.length;r++){var i=a.components[r];null!=i.instance&&i.klass===e&&n.push(i.instance)}}return null!=n?n:null},t.prototype.findSceneMetadata=function(t){var n=null;if(null!=t.metadata&&t.metadata.api){var a=t.metadata;n=new e.ObjectMetadata(a)}return n},t.prototype.findSceneChildMesh=function(t,n,a,r,i){void 0===a&&(a=e.SearchType.StartsWith),void 0===r&&(r=!0),void 0===i&&(i=null);var o=(null!=a?a:e.SearchType.StartsWith,n.getChildMeshes(r,i));return e.SceneManager.FindMesh(t,o,a)},t.prototype.findSceneCollisionMesh=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=null);var a=null,r=e.getChildMeshes(t,n);if(null!=r&&r.length>0)for(var i=0;i<r.length;i++){var o=r[i];if("Collider"===o.name||o.name.indexOf("_Collider")>=0||o.name.indexOf(":Collider")>=0){a=o;break}}return null==a&&(a=e),a},t.prototype.findSceneSkeleton=function(e){var t=null,n=null!=this._scene.skeletons?this._scene.skeletons.length:0;if(n>0){var a=0;for(a=0;a<n;a++){var r=this._scene.skeletons[a],i=""+r.id;if(i===e){t=r;break}}}return t},t.prototype.findSceneSocketMesh=function(t,n,a,r){void 0===a&&(a=!0),void 0===r&&(r=null);var i=e.SceneManager.LocateOwnerSocketMesh(t,n);if(null==i){var o=n.getChildMeshes(a,r);if(null!=o&&o.length>0)for(var s=0;s<o.length;s++){var l=o[s];if(i=e.SceneManager.LocateOwnerSocketMesh(t,l),null!=i)break}}return i},t.prototype.findSceneSocketMeshes=function(t,n,a){void 0===n&&(n=!0),void 0===a&&(a=null);var r=e.SceneManager.LocateOwnerSocketMeshes(t);if(null==r){var i=t.getChildMeshes(n,a);if(null!=i&&i.length>0)for(var o=0;o<i.length;o++){var s=i[o];if(r=e.SceneManager.LocateOwnerSocketMeshes(s),null!=r)break}}return r},t.prototype.findSceneAnimationClip=function(e,t){var n=null;if(null!=t&&null!=t.metadata&&t.metadata.api){var a=t.metadata;if(null!=a.animationClips&&a.animationClips.length>0)if(null!=e&&""!==e){var r=0;for(r=0;r<a.animationClips.length;r++)if(a.animationClips[r].name===e){n=a.animationClips[r];break}}else n=a.animationClips[0]}return n},t.prototype.findSceneAnimationClips=function(e){var t=null;if(null!=e&&null!=e.metadata&&e.metadata.api){var n=e.metadata;null!=n.animationClips&&n.animationClips.length>0&&(t=n.animationClips)}return t},t.prototype.findSceneParticleSystem=function(e,t){var n=null;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=this._scene.particleSystems&&this._scene.particleSystems.length>0)for(var a=this._scene.particleSystems.length,r=0;r<a;r++){var i=this._scene.particleSystems[r];if(i.emitter===t&&i.name===e){n=i;break}}return n},t.prototype.findSceneParticleSystems=function(e){var t=[];if(null==e)throw new Error("Null owner scene obejct specified.");return null!=this._scene.particleSystems&&this._scene.particleSystems.length>0&&this._scene.particleSystems.forEach(function(n){n.emitter===e&&t.push(n)}),t},t.prototype.findSceneLensFlareSystem=function(e,t){var n=null;if(null==t)throw new Error("Null owner scene obejct specified.");if(null!=this._scene.lensFlareSystems&&this._scene.lensFlareSystems.length>0)for(var a=this._scene.lensFlareSystems.length,r=0;r<a;r++){var i=this._scene.lensFlareSystems[r];if(i.getEmitter()===t&&i.name===e){n=i;break}}return n},t.prototype.findSceneLensFlareSystems=function(e){var t=[];if(null==e)throw new Error("Null owner scene obejct specified.");return null!=this._scene.lensFlareSystems&&this._scene.lensFlareSystems.length>0&&this._scene.lensFlareSystems.forEach(function(n){n.getEmitter()===e&&t.push(n)}),t},t.prototype.resetUserInput=function(){e.SceneManager.keymap={},e.SceneManager.wheel=0,e.SceneManager.clientx=0,e.SceneManager.clienty=0,e.SceneManager.mousex=0,e.SceneManager.mousey=0,e.SceneManager.vertical=0,e.SceneManager.horizontal=0,e.SceneManager.mousex2=0,e.SceneManager.mousey2=0,e.SceneManager.vertical2=0,e.SceneManager.horizontal2=0,e.SceneManager.mousex3=0,e.SceneManager.mousey3=0,e.SceneManager.vertical3=0,e.SceneManager.horizontal3=0,e.SceneManager.mousex4=0,e.SceneManager.mousey4=0,e.SceneManager.vertical4=0,e.SceneManager.horizontal4=0,e.SceneManager.x_wheel=0,e.SceneManager.x_mousex=0,e.SceneManager.x_mousey=0,e.SceneManager.x_vertical=0,e.SceneManager.x_horizontal=0,e.SceneManager.k_mousex=0,e.SceneManager.k_mousey=0,e.SceneManager.k_vertical=0,e.SceneManager.k_horizontal=0,e.SceneManager.j_mousex=0,e.SceneManager.j_mousey=0,e.SceneManager.j_vertical=0,e.SceneManager.j_horizontal=0,e.SceneManager.g_mousex1=0,e.SceneManager.g_mousey1=0,e.SceneManager.g_vertical1=0,e.SceneManager.g_horizontal1=0,e.SceneManager.g_mousex2=0,e.SceneManager.g_mousey2=0,e.SceneManager.g_vertical2=0,e.SceneManager.g_horizontal2=0,e.SceneManager.g_mousex3=0,e.SceneManager.g_mousey3=0,e.SceneManager.g_vertical3=0,e.SceneManager.g_horizontal3=0,e.SceneManager.g_mousex4=0,e.SceneManager.g_mousey4=0,e.SceneManager.g_vertical4=0,e.SceneManager.g_horizontal4=0,e.SceneManager.preventDefault=!1,e.SceneManager.mouseButtonUp=[],e.SceneManager.mouseButtonDown=[],e.SceneManager.mouseButtonPress=[],e.SceneManager.keyButtonUp=[],e.SceneManager.keyButtonDown=[],e.SceneManager.keyButtonPress=[],e.SceneManager.gamepad1ButtonUp=[],e.SceneManager.gamepad1ButtonDown=[],e.SceneManager.gamepad1ButtonPress=[],e.SceneManager.gamepad1DpadUp=[],e.SceneManager.gamepad1DpadDown=[],e.SceneManager.gamepad1DpadPress=[],e.SceneManager.gamepad1LeftTrigger=[],e.SceneManager.gamepad1RightTrigger=[],e.SceneManager.gamepad2ButtonUp=[],e.SceneManager.gamepad2ButtonDown=[],e.SceneManager.gamepad2ButtonPress=[],e.SceneManager.gamepad2DpadUp=[],e.SceneManager.gamepad2DpadDown=[],e.SceneManager.gamepad2DpadPress=[],e.SceneManager.gamepad2LeftTrigger=[],e.SceneManager.gamepad2RightTrigger=[],e.SceneManager.gamepad3ButtonUp=[],e.SceneManager.gamepad3ButtonDown=[],e.SceneManager.gamepad3ButtonPress=[],e.SceneManager.gamepad3DpadUp=[],e.SceneManager.gamepad3DpadDown=[],e.SceneManager.gamepad3DpadPress=[],e.SceneManager.gamepad3LeftTrigger=[],e.SceneManager.gamepad3RightTrigger=[],e.SceneManager.gamepad4ButtonUp=[],e.SceneManager.gamepad4ButtonDown=[],e.SceneManager.gamepad4ButtonPress=[],e.SceneManager.gamepad4DpadUp=[],e.SceneManager.gamepad4DpadDown=[],e.SceneManager.gamepad4DpadPress=[],e.SceneManager.gamepad4LeftTrigger=[],e.SceneManager.gamepad4RightTrigger=[]},t.prototype.enableUserInput=function(t){void 0===t&&(t=null);var n=!(null==t||!t.preventDefault)&&t.preventDefault,a=!(null==t||!t.useCapture)&&t.useCapture,r=!(null==t||!t.enableVirtualJoystick)&&t.enableVirtualJoystick,i=!(null==t||!t.disableRightStick)&&t.disableRightStick;this._input||(this.resetUserInput(),document.documentElement.tabIndex=1,document.documentElement.addEventListener("keyup",e.SceneManager.inputKeyUpHandler,a),document.documentElement.addEventListener("keydown",e.SceneManager.inputKeyDownHandler,a),document.documentElement.addEventListener("pointerup",e.SceneManager.inputPointerUpHandler,a),document.documentElement.addEventListener("pointerdown",e.SceneManager.inputPointerDownHandler,a),document.documentElement.addEventListener("pointermove",e.SceneManager.inputPointerMoveHandler,a),document.documentElement.addEventListener("onwheel"in document?"wheel":"mousewheel",e.SceneManager.inputPointerWheelHandler,a),e.SceneManager.preventDefault=n,null==e.SceneManager.GamepadManager&&(e.SceneManager.GamepadManager=new e.GamepadManager,e.SceneManager.GamepadManager.onGamepadConnectedObservable.add(e.SceneManager.inputManagerGamepadConnected),e.SceneManager.GamepadManager.onGamepadDisconnectedObservable.add(e.SceneManager.inputManagerGamepadDisconnected)),e.SceneManager.virtualJoystick===!1&&(e.SceneManager.virtualJoystick=r,e.SceneManager.virtualJoystick===!0&&(null==e.SceneManager.leftJoystick&&(e.SceneManager.leftJoystick=new e.VirtualJoystick((!0)),e.SceneManager.leftJoystick.setJoystickSensibility(5*e.UserInputOptions.JoystickLeftSensibility)),i===!1&&null==e.SceneManager.rightJoystick&&(e.SceneManager.rightJoystick=new e.VirtualJoystick((!1)),e.SceneManager.rightJoystick.reverseUpDown=!0,e.SceneManager.rightJoystick.setJoystickSensibility(5*e.UserInputOptions.JoystickRightSensibility),e.SceneManager.rightJoystick.setJoystickColor(e.UserInputOptions.JoystickRightHandleColor)))),this._input=!0,document.documentElement.focus())},t.prototype.disableUserInput=function(t){void 0===t&&(t=!1),this._input&&(document.documentElement.removeEventListener("keyup",e.SceneManager.inputKeyUpHandler,t),document.documentElement.removeEventListener("keydown",e.SceneManager.inputKeyDownHandler,t),document.documentElement.removeEventListener("pointerup",e.SceneManager.inputPointerUpHandler,t),document.documentElement.removeEventListener("pointerdown",e.SceneManager.inputPointerDownHandler,t),document.documentElement.removeEventListener("pointermove",e.SceneManager.inputPointerMoveHandler,t),document.documentElement.removeEventListener("onwheel"in document?"wheel":"mousewheel",e.SceneManager.inputPointerWheelHandler,t),e.SceneManager.preventDefault=!1,this.resetUserInput(),this._input=!1)},t.prototype.getUserInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var a=0;if(this._input)switch(t){case e.UserInputAxis.Vertical:case e.UserInputAxis.Horizontal:a=n===e.PlayerNumber.Four?t===e.UserInputAxis.Horizontal?e.SceneManager.horizontal4:e.SceneManager.vertical4:n===e.PlayerNumber.Three?t===e.UserInputAxis.Horizontal?e.SceneManager.horizontal3:e.SceneManager.vertical3:n===e.PlayerNumber.Two?t===e.UserInputAxis.Horizontal?e.SceneManager.horizontal2:e.SceneManager.vertical2:t===e.UserInputAxis.Horizontal?e.SceneManager.horizontal:e.SceneManager.vertical;break;case e.UserInputAxis.MouseX:case e.UserInputAxis.MouseY:a=n===e.PlayerNumber.Four?t===e.UserInputAxis.MouseX?e.SceneManager.mousex4:e.SceneManager.mousey4:n===e.PlayerNumber.Three?t===e.UserInputAxis.MouseX?e.SceneManager.mousex3:e.SceneManager.mousey3:n===e.PlayerNumber.Two?t===e.UserInputAxis.MouseX?e.SceneManager.mousex2:e.SceneManager.mousey2:t===e.UserInputAxis.MouseX?e.SceneManager.mousex:e.SceneManager.mousey;break;case e.UserInputAxis.ClientX:case e.UserInputAxis.ClientY:n===e.PlayerNumber.One&&(a=t===e.UserInputAxis.ClientX?e.SceneManager.clientx:e.SceneManager.clienty);break;case e.UserInputAxis.Wheel:n===e.PlayerNumber.One&&(a=e.SceneManager.wheel)}return a},t.prototype.onKeyboardUp=function(t){this._input&&e.SceneManager.keyButtonUp.push(t)},t.prototype.onKeyboardDown=function(t){this._input&&e.SceneManager.keyButtonDown.push(t)},t.prototype.onKeyboardPress=function(t,n){this._input&&e.SceneManager.keyButtonPress.push({index:t,action:n})},t.prototype.getKeyboardInput=function(t){var n=!1;if(this._input){var a="k:"+t.toString();null!=e.SceneManager.keymap[a]&&(n=e.SceneManager.keymap[a])}return n},t.prototype.onPointerUp=function(t){this._input&&e.SceneManager.mouseButtonUp.push(t)},t.prototype.onPointerDown=function(t){this._input&&e.SceneManager.mouseButtonDown.push(t)},t.prototype.onPointerPress=function(t,n){this._input&&e.SceneManager.mouseButtonPress.push({index:t,action:n})},t.prototype.getPointerInput=function(t){var n=!1;if(this._input){var a="p:"+t.toString();null!=e.SceneManager.keymap[a]&&(n=e.SceneManager.keymap[a])}return n},t.prototype.getLeftJoystick=function(){return this._input?e.SceneManager.leftJoystick:null},t.prototype.getRightJoystick=function(){return this._input?e.SceneManager.rightJoystick:null},t.prototype.getJoystickPress=function(t){var n=!1;return this._input&&(t===e.JoystickButton.Left&&null!=e.SceneManager.leftJoystick&&e.SceneManager.leftJoystick.pressed===!0?n=!0:t===e.JoystickButton.Right&&null!=e.SceneManager.rightJoystick&&e.SceneManager.rightJoystick.pressed===!0&&(n=!0)),n},t.prototype.disposeVirtualJoysticks=function(){this._input&&(null!=e.SceneManager.leftJoystick&&(e.SceneManager.leftJoystick.releaseCanvas(),e.SceneManager.leftJoystick=null),null!=e.SceneManager.rightJoystick&&(e.SceneManager.rightJoystick.releaseCanvas(),e.SceneManager.rightJoystick=null),e.SceneManager.virtualJoystick=!1)},t.prototype.onGamepadButtonUp=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),this._input)switch(n){case e.PlayerNumber.One:e.SceneManager.gamepad1ButtonUp.push(t);break;case e.PlayerNumber.Two:e.SceneManager.gamepad2ButtonUp.push(t);break;case e.PlayerNumber.Three:e.SceneManager.gamepad3ButtonUp.push(t);break;case e.PlayerNumber.Four:e.SceneManager.gamepad4ButtonUp.push(t)}},t.prototype.onGamepadButtonDown=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),this._input)switch(n){case e.PlayerNumber.One:e.SceneManager.gamepad1ButtonDown.push(t);break;case e.PlayerNumber.Two:e.SceneManager.gamepad2ButtonDown.push(t);break;case e.PlayerNumber.Three:e.SceneManager.gamepad3ButtonDown.push(t);break;case e.PlayerNumber.Four:e.SceneManager.gamepad4ButtonDown.push(t)}},t.prototype.onGamepadButtonPress=function(t,n,a){if(void 0===a&&(a=e.PlayerNumber.One),this._input)switch(a){case e.PlayerNumber.One:e.SceneManager.gamepad1ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Two:e.SceneManager.gamepad2ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Three:e.SceneManager.gamepad3ButtonPress.push({index:t,action:n});break;case e.PlayerNumber.Four:e.SceneManager.gamepad4ButtonPress.push({index:t,action:n})}},t.prototype.getGamepadButtonInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var a=!1;if(this._input){var r=null;switch(n){case e.PlayerNumber.One:r="b1:"+t.toString();break;case e.PlayerNumber.Two:r="b2:"+t.toString();break;case e.PlayerNumber.Three:r="b3:"+t.toString();break;case e.PlayerNumber.Four:r="b4:"+t.toString()}null!=r&&null!=e.SceneManager.keymap[r]&&(a=e.SceneManager.keymap[r])}return a},t.prototype.onGamepadDirectionUp=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),this._input)switch(n){case e.PlayerNumber.One:e.SceneManager.gamepad1DpadUp.push(t);break;case e.PlayerNumber.Two:e.SceneManager.gamepad2DpadUp.push(t);break;case e.PlayerNumber.Three:e.SceneManager.gamepad3DpadUp.push(t);break;case e.PlayerNumber.Four:e.SceneManager.gamepad4DpadUp.push(t)}},t.prototype.onGamepadDirectionDown=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),this._input)switch(n){case e.PlayerNumber.One:e.SceneManager.gamepad1DpadDown.push(t);break;case e.PlayerNumber.Two:e.SceneManager.gamepad2DpadDown.push(t);break;case e.PlayerNumber.Three:e.SceneManager.gamepad3DpadDown.push(t);break;case e.PlayerNumber.Four:e.SceneManager.gamepad4DpadDown.push(t)}},t.prototype.onGamepadDirectionPress=function(t,n,a){
if(void 0===a&&(a=e.PlayerNumber.One),this._input)switch(a){case e.PlayerNumber.One:e.SceneManager.gamepad1DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Two:e.SceneManager.gamepad2DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Three:e.SceneManager.gamepad3DpadPress.push({index:t,action:n});break;case e.PlayerNumber.Four:e.SceneManager.gamepad4DpadPress.push({index:t,action:n})}},t.prototype.getGamepadDirectionInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var a=!1;if(this._input){var r=null;switch(n){case e.PlayerNumber.One:r="d1:"+t.toString();break;case e.PlayerNumber.Two:r="d2:"+t.toString();break;case e.PlayerNumber.Three:r="d3:"+t.toString();break;case e.PlayerNumber.Four:r="d4:"+t.toString()}null!=r&&null!=e.SceneManager.keymap[r]&&(a=e.SceneManager.keymap[r])}return a},t.prototype.onGamepadTriggerLeft=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),this._input)switch(n){case e.PlayerNumber.One:e.SceneManager.gamepad1LeftTrigger.push(t);break;case e.PlayerNumber.Two:e.SceneManager.gamepad2LeftTrigger.push(t);break;case e.PlayerNumber.Three:e.SceneManager.gamepad3LeftTrigger.push(t);break;case e.PlayerNumber.Four:e.SceneManager.gamepad4LeftTrigger.push(t)}},t.prototype.onGamepadTriggerRight=function(t,n){if(void 0===n&&(n=e.PlayerNumber.One),this._input)switch(n){case e.PlayerNumber.One:e.SceneManager.gamepad1RightTrigger.push(t);break;case e.PlayerNumber.Two:e.SceneManager.gamepad2RightTrigger.push(t);break;case e.PlayerNumber.Three:e.SceneManager.gamepad3RightTrigger.push(t);break;case e.PlayerNumber.Four:e.SceneManager.gamepad4RightTrigger.push(t)}},t.prototype.getGamepadTriggerInput=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var a=0;if(this._input){var r=null;switch(n){case e.PlayerNumber.One:r="t1:"+t.toString();break;case e.PlayerNumber.Two:r="t2:"+t.toString();break;case e.PlayerNumber.Three:r="t3:"+t.toString();break;case e.PlayerNumber.Four:r="t4:"+t.toString()}null!=r&&null!=e.SceneManager.keymap[r]&&(a=e.SceneManager.keymap[r])}return a},t.prototype.getGamepad=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=null;if(this._input)switch(t){case e.PlayerNumber.One:n=e.SceneManager.gamepad1;break;case e.PlayerNumber.Two:n=e.SceneManager.gamepad2;break;case e.PlayerNumber.Three:n=e.SceneManager.gamepad3;break;case e.PlayerNumber.Four:n=e.SceneManager.gamepad4}return n},t.prototype.getGamepadType=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=e.GamepadType.None;if(this._input)switch(t){case e.PlayerNumber.One:n=e.SceneManager.gamepad1Type;break;case e.PlayerNumber.Two:n=e.SceneManager.gamepad2Type;break;case e.PlayerNumber.Three:n=e.SceneManager.gamepad3Type;break;case e.PlayerNumber.Four:n=e.SceneManager.gamepad4Type}return n},t.prototype.updateCameraUserInput=function(t,n,a,r){if(void 0===r&&(r=e.PlayerNumber.One),null!=t){var i=this.getUserInput(e.UserInputAxis.Horizontal,r),o=this.getUserInput(e.UserInputAxis.Vertical,r),s=this.getUserInput(e.UserInputAxis.MouseX,r),l=this.getUserInput(e.UserInputAxis.MouseY,r);this.updateCameraPosition(t,i,o,n),this.updateCameraRotation(t,s,l,a)}},t.prototype.updateCameraPosition=function(t,n,a,r){if(null!=t){var i=t._computeLocalCameraSpeed()*r,o=e.Matrix.RotationYawPitchRoll(t.rotation.y,t.rotation.x,0),s=e.Vector3.TransformCoordinates(new e.Vector3(n*i,0,a*i),o);t.cameraDirection=t.cameraDirection.add(s)}},t.prototype.updateCameraRotation=function(t,n,a,r){null!=t&&(t.cameraRotation=t.cameraRotation.add(new e.Vector2(a*r,n*r)))},t.prototype.getNavigationTool=function(){return null==this._navigation&&(this._navigation=new Navigation),this._navigation},t.prototype.getNavigationZone=function(){return"scene"},t.prototype.findNavigationPath=function(e,t){if(null==this._navigation||null==this._navmesh||null==e||null==t)return null;var n=this.getNavigationZone(),a=this._navigation.getGroup(n,e);return this._navigation.findPath(e,t,n,a)},t.prototype.hasNavigationMesh=function(){return null!=this._navmesh},t.prototype.getNavigationMesh=function(){return this._navmesh},t.prototype.buildNavigationMesh=function(t){if(null!=t){this._navmesh=t;var n=this.getNavigationTool(),a=n.buildNodes(this._navmesh);null!=a?n.setZoneData(this.getNavigationZone(),a):e.Tools.Warn("Failed to set scene navigation zone")}},t.prototype.getNavigationPoint=function(t,n,a){var r=this;if(void 0===n&&(n=2),void 0===a&&(a=Number.MAX_VALUE),null==this._navmesh||null==t)return null;var i=(new e.Vector3(t.x,t.y+n,t.z),new e.Ray(t,new e.Vector3(0,(-1),0),a)),o=this._scene.pickWithRay(i,function(e){return e===r._navmesh});return o.hit&&o.pickedPoint?o.pickedPoint:null},t.prototype.moveNavigationAgent=function(t,n,a,r,i){if(n&&n.length>0){for(var o=0,s=[{frame:0,value:t.position}],l=0;l<n.length;l++)o+=e.Vector3.Distance(s[l].value,n[l]),s.push({frame:o,value:n[l]});var u=new e.Animation("Move","position",3,e.Animation.ANIMATIONTYPE_VECTOR3,e.Animation.ANIMATIONLOOPMODE_RELATIVE);u.setKeys(s),t.animations.push(u),this._scene.beginAnimation(t,0,o,r,a,i)}},t.prototype.getNavigationAgents=function(){return this._scene.getMeshesByTags("[NAVAGENT]")},t.prototype.getNavigationAgentInfo=function(t){return new e.NavigationAgent(t)},t.prototype.getNavigationAreaTable=function(){return null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties&&null!=this._navmesh.metadata.properties.table?this._navmesh.metadata.properties.table:[]},t.prototype.getNavigationAreaIndexes=function(){return null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties&&null!=this._navmesh.metadata.properties.areas?this._navmesh.metadata.properties.areas:[]},t.prototype.getNavigationAreaName=function(e){var t="";if(null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties&&null!=this._navmesh.metadata.properties.table){var n=this._navmesh.metadata.properties.table;if(null!=n)for(var a=0;a<n.length;a++)if(n[a].index===e){t=n[a].area;break}}return t},t.prototype.getNavigationAreaCost=function(e){var t=-1;if(null!=this._navmesh.metadata&&null!=this._navmesh.metadata.properties){var n=this._navmesh.metadata.properties.table;if(null!=n)for(var a=0;a<n.length;a++)if(n[a].index===e){t=n[a].cost;break}}return t},t.inputKeyDownHandler=function(t){var n="k:"+t.keyCode.toString(),a=!1;switch(null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,t.keyCode){case 39:case 68:e.SceneManager.k_horizontal=1;break;case 37:case 65:e.SceneManager.k_horizontal=-1;break;case 38:case 87:e.SceneManager.k_vertical=1;break;case 40:case 83:e.SceneManager.k_vertical=-1}return null!=e.SceneManager.keyButtonDown&&e.SceneManager.keyButtonDown.length>0&&e.SceneManager.keyButtonDown.forEach(function(e){e(t.keyCode)}),a||null!=e.SceneManager.keyButtonPress&&e.SceneManager.keyButtonPress.length>0&&e.SceneManager.keyButtonPress.forEach(function(e){e.index===t.keyCode&&e.action()}),e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputKeyUpHandler=function(t){var n="k:"+t.keyCode.toString();switch(e.SceneManager.keymap[n]=!1,t.keyCode){case 39:case 37:case 68:case 65:e.SceneManager.k_horizontal=0;break;case 38:case 40:case 87:case 83:e.SceneManager.k_vertical=0}return null!=e.SceneManager.keyButtonUp&&e.SceneManager.keyButtonUp.length>0&&e.SceneManager.keyButtonUp.forEach(function(e){e(t.keyCode)}),e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerWheelHandler=function(t){var n=t.deltaY?-t.deltaY:t.wheelDelta/40;return e.SceneManager.x_wheel=Math.abs(n)>e.UserInputOptions.PointerWheelDeadZone?0+n:0,e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerDownHandler=function(t){0===t.button&&(e.SceneManager.previousPosition={x:t.clientX,y:t.clientY});var n="p:"+t.button.toString(),a=!1;return null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.mouseButtonDown&&e.SceneManager.mouseButtonDown.length>0&&e.SceneManager.mouseButtonDown.forEach(function(e){e(t.button)}),a||null!=e.SceneManager.mouseButtonPress&&e.SceneManager.mouseButtonPress.length>0&&e.SceneManager.mouseButtonPress.forEach(function(e){e.index===t.button&&e.action()}),e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerUpHandler=function(t){0===t.button&&null!=e.SceneManager.previousPosition&&(e.SceneManager.previousPosition=null,e.SceneManager.k_mousex=0,e.SceneManager.k_mousey=0);var n="p:"+t.button.toString();return e.SceneManager.keymap[n]=!1,null!=e.SceneManager.mouseButtonUp&&e.SceneManager.mouseButtonUp.length>0&&e.SceneManager.mouseButtonUp.forEach(function(e){e(t.button)}),e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputPointerMoveHandler=function(t){if(e.SceneManager.virtualJoystick===!1&&null!=e.SceneManager.previousPosition){e.SceneManager.clientx=t.clientX,e.SceneManager.clienty=t.clientY;var n=t.clientX-e.SceneManager.previousPosition.x,a=t.clientY-e.SceneManager.previousPosition.y;e.SceneManager.previousPosition={x:t.clientX,y:t.clientY};var r=n*(e.UserInputOptions.PointerAngularSensibility/10),i=a*(e.UserInputOptions.PointerAngularSensibility/10);0!=r&&(e.SceneManager.k_mousex=r),0!=i&&(e.SceneManager.rightHanded?e.SceneManager.k_mousey=-i:e.SceneManager.k_mousey=i)}return e.SceneManager.preventDefault&&t.preventDefault(),!0},t.inputVirtualJoysticks=function(){if(null!=e.SceneManager.leftJoystick){var t=e.SceneManager.leftJoystick.deltaPosition;e.SceneManager.leftJoystick.pressed||(t=t.scale(.9));var n=t.x,a=t.y;t.x=Math.abs(n)>e.UserInputOptions.JoystickDeadStickValue?0+n:0,t.y=Math.abs(a)>e.UserInputOptions.JoystickDeadStickValue?0+a:0,e.SceneManager.j_horizontal=t.x,e.SceneManager.j_vertical=t.y}if(null!=e.SceneManager.rightJoystick){var r=e.SceneManager.rightJoystick.deltaPosition;e.SceneManager.rightJoystick.pressed||(r=r.scale(.9));var i=r.x,o=r.y;r.x=Math.abs(i)>e.UserInputOptions.JoystickDeadStickValue?0+i:0,r.y=Math.abs(o)>e.UserInputOptions.JoystickDeadStickValue?0+o:0,e.SceneManager.j_mousex=r.x,e.SceneManager.j_mousey=r.y}},t.inputOneButtonDownHandler=function(t){if(null!=e.SceneManager.gamepad1){var n="b1:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad1ButtonDown&&e.SceneManager.gamepad1ButtonDown.length>0&&e.SceneManager.gamepad1ButtonDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad1ButtonPress&&e.SceneManager.gamepad1ButtonPress.length>0&&e.SceneManager.gamepad1ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneButtonUpHandler=function(t){if(null!=e.SceneManager.gamepad1){var n="b1:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad1ButtonUp&&e.SceneManager.gamepad1ButtonUp.length>0&&e.SceneManager.gamepad1ButtonUp.forEach(function(e){e(t)})}},t.inputOneXboxDPadDownHandler=function(t){if(null!=e.SceneManager.gamepad1){var n="d1:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad1DpadDown&&e.SceneManager.gamepad1DpadDown.length>0&&e.SceneManager.gamepad1DpadDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad1DpadPress&&e.SceneManager.gamepad1DpadPress.length>0&&e.SceneManager.gamepad1DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputOneXboxDPadUpHandler=function(t){if(null!=e.SceneManager.gamepad1){var n="d1:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad1DpadUp&&e.SceneManager.gamepad1DpadUp.length>0&&e.SceneManager.gamepad1DpadUp.forEach(function(e){e(t)})}},t.inputOneXboxLeftTriggerHandler=function(t){null!=e.SceneManager.gamepad1&&(e.SceneManager.keymap["t1:0"]=t,null!=e.SceneManager.gamepad1LeftTrigger&&e.SceneManager.gamepad1LeftTrigger.length>0&&e.SceneManager.gamepad1LeftTrigger.forEach(function(e){e(t)}))},t.inputOneXboxRightTriggerHandler=function(t){null!=e.SceneManager.gamepad1&&(e.SceneManager.keymap["t1:1"]=t,null!=e.SceneManager.gamepad1RightTrigger&&e.SceneManager.gamepad1RightTrigger.length>0&&e.SceneManager.gamepad1RightTrigger.forEach(function(e){e(t)}))},t.inputOneLeftStickHandler=function(t){if(null!=e.SceneManager.gamepad1){var n=t,a=n.x*e.UserInputOptions.GamepadLStickSensibility,r=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_horizontal1=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.SceneManager.g_vertical1=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputOneRightStickHandler=function(t){if(null!=e.SceneManager.gamepad1){var n=t,a=n.x*e.UserInputOptions.GamepadRStickSensibility,r=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_mousex1=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.SceneManager.g_mousey1=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputTwoButtonDownHandler=function(t){if(null!=e.SceneManager.gamepad2){var n="b2:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad2ButtonDown&&e.SceneManager.gamepad2ButtonDown.length>0&&e.SceneManager.gamepad2ButtonDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad2ButtonPress&&e.SceneManager.gamepad2ButtonPress.length>0&&e.SceneManager.gamepad2ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoButtonUpHandler=function(t){if(null!=e.SceneManager.gamepad2){var n="b2:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad2ButtonUp&&e.SceneManager.gamepad2ButtonUp.length>0&&e.SceneManager.gamepad2ButtonUp.forEach(function(e){e(t)})}},t.inputTwoXboxDPadDownHandler=function(t){if(null!=e.SceneManager.gamepad2){var n="d2:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad2DpadDown&&e.SceneManager.gamepad2DpadDown.length>0&&e.SceneManager.gamepad2DpadDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad2DpadPress&&e.SceneManager.gamepad2DpadPress.length>0&&e.SceneManager.gamepad2DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputTwoXboxDPadUpHandler=function(t){if(null!=e.SceneManager.gamepad2){var n="d2:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad2DpadUp&&e.SceneManager.gamepad2DpadUp.length>0&&e.SceneManager.gamepad2DpadUp.forEach(function(e){e(t)})}},t.inputTwoXboxLeftTriggerHandler=function(t){null!=e.SceneManager.gamepad2&&(e.SceneManager.keymap["t2:0"]=t,null!=e.SceneManager.gamepad2LeftTrigger&&e.SceneManager.gamepad2LeftTrigger.length>0&&e.SceneManager.gamepad2LeftTrigger.forEach(function(e){e(t)}))},t.inputTwoXboxRightTriggerHandler=function(t){null!=e.SceneManager.gamepad2&&(e.SceneManager.keymap["t2:1"]=t,null!=e.SceneManager.gamepad2RightTrigger&&e.SceneManager.gamepad2RightTrigger.length>0&&e.SceneManager.gamepad2RightTrigger.forEach(function(e){e(t)}))},t.inputTwoLeftStickHandler=function(t){if(null!=e.SceneManager.gamepad2){var n=t,a=n.x*e.UserInputOptions.GamepadLStickSensibility,r=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_horizontal2=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.SceneManager.g_vertical2=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputTwoRightStickHandler=function(t){if(null!=e.SceneManager.gamepad2){var n=t,a=n.x*e.UserInputOptions.GamepadRStickSensibility,r=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_mousex2=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.SceneManager.g_mousey2=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputThreeButtonDownHandler=function(t){if(null!=e.SceneManager.gamepad3){var n="b3:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad3ButtonDown&&e.SceneManager.gamepad3ButtonDown.length>0&&e.SceneManager.gamepad3ButtonDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad3ButtonPress&&e.SceneManager.gamepad3ButtonPress.length>0&&e.SceneManager.gamepad3ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeButtonUpHandler=function(t){if(null!=e.SceneManager.gamepad3){var n="b3:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad3ButtonUp&&e.SceneManager.gamepad3ButtonUp.length>0&&e.SceneManager.gamepad3ButtonUp.forEach(function(e){e(t)})}},t.inputThreeXboxDPadDownHandler=function(t){if(null!=e.SceneManager.gamepad3){var n="d3:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad3DpadDown&&e.SceneManager.gamepad3DpadDown.length>0&&e.SceneManager.gamepad3DpadDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad3DpadPress&&e.SceneManager.gamepad3DpadPress.length>0&&e.SceneManager.gamepad3DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputThreeXboxDPadUpHandler=function(t){if(null!=e.SceneManager.gamepad3){var n="d3:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad3DpadUp&&e.SceneManager.gamepad3DpadUp.length>0&&e.SceneManager.gamepad3DpadUp.forEach(function(e){e(t)})}},t.inputThreeXboxLeftTriggerHandler=function(t){null!=e.SceneManager.gamepad3&&(e.SceneManager.keymap["t3:0"]=t,null!=e.SceneManager.gamepad3LeftTrigger&&e.SceneManager.gamepad3LeftTrigger.length>0&&e.SceneManager.gamepad3LeftTrigger.forEach(function(e){e(t)}))},t.inputThreeXboxRightTriggerHandler=function(t){null!=e.SceneManager.gamepad3&&(e.SceneManager.keymap["t3:1"]=t,null!=e.SceneManager.gamepad3RightTrigger&&e.SceneManager.gamepad3RightTrigger.length>0&&e.SceneManager.gamepad3RightTrigger.forEach(function(e){e(t)}))},t.inputThreeLeftStickHandler=function(t){if(null!=e.SceneManager.gamepad3){var n=t,a=n.x*e.UserInputOptions.GamepadLStickSensibility,r=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_horizontal3=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.SceneManager.g_vertical3=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputThreeRightStickHandler=function(t){if(null!=e.SceneManager.gamepad3){var n=t,a=n.x*e.UserInputOptions.GamepadRStickSensibility,r=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_mousex3=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.SceneManager.g_mousey3=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputFourButtonDownHandler=function(t){if(null!=e.SceneManager.gamepad4){var n="b4:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad4ButtonDown&&e.SceneManager.gamepad4ButtonDown.length>0&&e.SceneManager.gamepad4ButtonDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad4ButtonPress&&e.SceneManager.gamepad4ButtonPress.length>0&&e.SceneManager.gamepad4ButtonPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourButtonUpHandler=function(t){if(null!=e.SceneManager.gamepad4){var n="b4:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad4ButtonUp&&e.SceneManager.gamepad4ButtonUp.length>0&&e.SceneManager.gamepad4ButtonUp.forEach(function(e){e(t)})}},t.inputFourXboxDPadDownHandler=function(t){if(null!=e.SceneManager.gamepad4){var n="d4:"+t.toString(),a=!1;null!=e.SceneManager.keymap[n]&&(a=e.SceneManager.keymap[n]),e.SceneManager.keymap[n]=!0,null!=e.SceneManager.gamepad4DpadDown&&e.SceneManager.gamepad4DpadDown.length>0&&e.SceneManager.gamepad4DpadDown.forEach(function(e){e(t)}),a||null!=e.SceneManager.gamepad4DpadPress&&e.SceneManager.gamepad4DpadPress.length>0&&e.SceneManager.gamepad4DpadPress.forEach(function(e){e.index===t&&e.action()})}},t.inputFourXboxDPadUpHandler=function(t){if(null!=e.SceneManager.gamepad4){var n="d4:"+t.toString();e.SceneManager.keymap[n]=!1,null!=e.SceneManager.gamepad4DpadUp&&e.SceneManager.gamepad4DpadUp.length>0&&e.SceneManager.gamepad4DpadUp.forEach(function(e){e(t)})}},t.inputFourXboxLeftTriggerHandler=function(t){null!=e.SceneManager.gamepad4&&(e.SceneManager.keymap["t4:0"]=t,null!=e.SceneManager.gamepad4LeftTrigger&&e.SceneManager.gamepad4LeftTrigger.length>0&&e.SceneManager.gamepad4LeftTrigger.forEach(function(e){e(t)}))},t.inputFourXboxRightTriggerHandler=function(t){null!=e.SceneManager.gamepad4&&(e.SceneManager.keymap["t4:1"]=t,null!=e.SceneManager.gamepad4RightTrigger&&e.SceneManager.gamepad4RightTrigger.length>0&&e.SceneManager.gamepad4RightTrigger.forEach(function(e){e(t)}))},t.inputFourLeftStickHandler=function(t){if(null!=e.SceneManager.gamepad4){var n=t,a=n.x*e.UserInputOptions.GamepadLStickSensibility,r=n.y*e.UserInputOptions.GamepadLStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_horizontal4=e.UserInputOptions.GamepadLStickXInverted?-n.x:n.x,e.SceneManager.g_vertical4=e.UserInputOptions.GamepadLStickYInverted?n.y:-n.y}},t.inputFourRightStickHandler=function(t){if(null!=e.SceneManager.gamepad4){var n=t,a=n.x*e.UserInputOptions.GamepadRStickSensibility,r=n.y*e.UserInputOptions.GamepadRStickSensibility;n.x=Math.abs(a)>e.UserInputOptions.GamepadDeadStickValue?0+a:0,n.y=Math.abs(r)>e.UserInputOptions.GamepadDeadStickValue?0+r:0,e.SceneManager.g_mousex4=e.UserInputOptions.GamepadRStickXInverted?-n.x:n.x,e.SceneManager.g_mousey4=e.UserInputOptions.GamepadRStickYInverted?-n.y:n.y}},t.inputManagerGamepadConnected=function(t,n){if(null==e.SceneManager.gamepad1&&0===t.index)if(e.SceneManager.gamepad1=t,e.Tools.Log("Gamepad One Connected: "+e.SceneManager.gamepad1.id),e.SceneManager.gamepad1.id.search("Xbox 360")!==-1||e.SceneManager.gamepad1.id.search("Xbox One")!==-1||e.SceneManager.gamepad1.id.search("xinput")!==-1){e.SceneManager.gamepad1Type=e.GamepadType.Xbox360;var a=e.SceneManager.gamepad1;a.onbuttonup(e.SceneManager.inputOneButtonUpHandler),a.onbuttondown(e.SceneManager.inputOneButtonDownHandler),a.onleftstickchanged(e.SceneManager.inputOneLeftStickHandler),a.onrightstickchanged(e.SceneManager.inputOneRightStickHandler),a.ondpadup(e.SceneManager.inputOneXboxDPadUpHandler),a.ondpaddown(e.SceneManager.inputOneXboxDPadDownHandler),a.onlefttriggerchanged(e.SceneManager.inputOneXboxLeftTriggerHandler),a.onrighttriggerchanged(e.SceneManager.inputOneXboxRightTriggerHandler)}else{e.SceneManager.gamepad1Type=e.GamepadType.Generic;var r=e.SceneManager.gamepad1;r.onbuttonup(e.SceneManager.inputOneButtonUpHandler),r.onbuttondown(e.SceneManager.inputOneButtonDownHandler),r.onleftstickchanged(e.SceneManager.inputOneLeftStickHandler),r.onrightstickchanged(e.SceneManager.inputOneRightStickHandler)}if(null==e.SceneManager.gamepad2&&1===t.index)if(e.SceneManager.gamepad2=t,e.Tools.Log("Gamepad Two Connected: "+e.SceneManager.gamepad2.id),e.SceneManager.gamepad2.id.search("Xbox 360")!==-1||e.SceneManager.gamepad2.id.search("Xbox One")!==-1||e.SceneManager.gamepad2.id.search("xinput")!==-1){e.SceneManager.gamepad2Type=e.GamepadType.Xbox360;var i=e.SceneManager.gamepad2;i.onbuttonup(e.SceneManager.inputTwoButtonUpHandler),i.onbuttondown(e.SceneManager.inputTwoButtonDownHandler),i.onleftstickchanged(e.SceneManager.inputTwoLeftStickHandler),i.onrightstickchanged(e.SceneManager.inputTwoRightStickHandler),i.ondpadup(e.SceneManager.inputTwoXboxDPadUpHandler),i.ondpaddown(e.SceneManager.inputTwoXboxDPadDownHandler),i.onlefttriggerchanged(e.SceneManager.inputTwoXboxLeftTriggerHandler),i.onrighttriggerchanged(e.SceneManager.inputTwoXboxRightTriggerHandler)}else{e.SceneManager.gamepad2Type=e.GamepadType.Generic;var o=e.SceneManager.gamepad2;o.onbuttonup(e.SceneManager.inputTwoButtonUpHandler),o.onbuttondown(e.SceneManager.inputTwoButtonDownHandler),o.onleftstickchanged(e.SceneManager.inputTwoLeftStickHandler),o.onrightstickchanged(e.SceneManager.inputTwoRightStickHandler)}if(null==e.SceneManager.gamepad3&&2===t.index)if(e.SceneManager.gamepad3=t,e.Tools.Log("Gamepad Three Connected: "+e.SceneManager.gamepad3.id),e.SceneManager.gamepad3.id.search("Xbox 360")!==-1||e.SceneManager.gamepad3.id.search("Xbox One")!==-1||e.SceneManager.gamepad3.id.search("xinput")!==-1){e.SceneManager.gamepad3Type=e.GamepadType.Xbox360;var s=e.SceneManager.gamepad3;s.onbuttonup(e.SceneManager.inputThreeButtonUpHandler),s.onbuttondown(e.SceneManager.inputThreeButtonDownHandler),s.onleftstickchanged(e.SceneManager.inputThreeLeftStickHandler),s.onrightstickchanged(e.SceneManager.inputThreeRightStickHandler),s.ondpadup(e.SceneManager.inputThreeXboxDPadUpHandler),s.ondpaddown(e.SceneManager.inputThreeXboxDPadDownHandler),s.onlefttriggerchanged(e.SceneManager.inputThreeXboxLeftTriggerHandler),s.onrighttriggerchanged(e.SceneManager.inputThreeXboxRightTriggerHandler)}else{e.SceneManager.gamepad3Type=e.GamepadType.Generic;var l=e.SceneManager.gamepad3;l.onbuttonup(e.SceneManager.inputThreeButtonUpHandler),l.onbuttondown(e.SceneManager.inputThreeButtonDownHandler),l.onleftstickchanged(e.SceneManager.inputThreeLeftStickHandler),l.onrightstickchanged(e.SceneManager.inputThreeRightStickHandler)}if(null==e.SceneManager.gamepad4&&3===t.index)if(e.SceneManager.gamepad4=t,e.Tools.Log("Gamepad Four Connected: "+e.SceneManager.gamepad4.id),e.SceneManager.gamepad4.id.search("Xbox 360")!==-1||e.SceneManager.gamepad4.id.search("Xbox One")!==-1||e.SceneManager.gamepad4.id.search("xinput")!==-1){e.SceneManager.gamepad4Type=e.GamepadType.Xbox360;var u=e.SceneManager.gamepad4;u.onbuttonup(e.SceneManager.inputFourButtonUpHandler),u.onbuttondown(e.SceneManager.inputFourButtonDownHandler),u.onleftstickchanged(e.SceneManager.inputFourLeftStickHandler),u.onrightstickchanged(e.SceneManager.inputFourRightStickHandler),u.ondpadup(e.SceneManager.inputFourXboxDPadUpHandler),u.ondpaddown(e.SceneManager.inputFourXboxDPadDownHandler),u.onlefttriggerchanged(e.SceneManager.inputFourXboxLeftTriggerHandler),u.onrighttriggerchanged(e.SceneManager.inputFourXboxRightTriggerHandler)}else{e.SceneManager.gamepad4Type=e.GamepadType.Generic;var c=e.SceneManager.gamepad4;c.onbuttonup(e.SceneManager.inputFourButtonUpHandler),c.onbuttondown(e.SceneManager.inputFourButtonDownHandler),c.onleftstickchanged(e.SceneManager.inputFourLeftStickHandler),c.onrightstickchanged(e.SceneManager.inputFourRightStickHandler)}null!=e.SceneManager.GamepadConnected&&e.SceneManager.GamepadConnected(t,n)},t.inputManagerGamepadDisconnected=function(t,n){null!=e.SceneManager.GamepadDisconnected&&e.SceneManager.GamepadDisconnected(t,n)},t.updateUserInput=function(){e.SceneManager.inputVirtualJoysticks(),e.SceneManager.x_horizontal=0,e.SceneManager.x_vertical=0,e.SceneManager.x_mousex=0,e.SceneManager.x_mousey=0,0!==e.SceneManager.j_horizontal?e.SceneManager.x_horizontal=e.SceneManager.j_horizontal:0!==e.SceneManager.k_horizontal?e.SceneManager.x_horizontal=e.SceneManager.k_horizontal:0!==e.SceneManager.g_horizontal1&&(e.SceneManager.x_horizontal=e.SceneManager.g_horizontal1),0!==e.SceneManager.j_vertical?e.SceneManager.x_vertical=e.SceneManager.j_vertical:0!==e.SceneManager.k_vertical?e.SceneManager.x_vertical=e.SceneManager.k_vertical:0!==e.SceneManager.g_vertical1&&(e.SceneManager.x_vertical=e.SceneManager.g_vertical1),0!==e.SceneManager.j_mousex?e.SceneManager.x_mousex=e.SceneManager.j_mousex:0!==e.SceneManager.k_mousex?e.SceneManager.x_mousex=e.SceneManager.k_mousex:0!==e.SceneManager.g_mousex1&&(e.SceneManager.x_mousex=e.SceneManager.g_mousex1),0!==e.SceneManager.j_mousey?e.SceneManager.x_mousey=e.SceneManager.j_mousey:0!==e.SceneManager.k_mousey?e.SceneManager.x_mousey=e.SceneManager.k_mousey:0!==e.SceneManager.g_mousey1&&(e.SceneManager.x_mousey=e.SceneManager.g_mousey1),e.SceneManager.horizontal=e.SceneManager.x_horizontal,e.SceneManager.vertical=e.SceneManager.x_vertical,e.SceneManager.mousex=e.SceneManager.x_mousex,e.SceneManager.mousey=e.SceneManager.x_mousey,e.SceneManager.wheel=e.SceneManager.x_wheel,e.SceneManager.horizontal2=e.SceneManager.g_horizontal2,e.SceneManager.vertical2=e.SceneManager.g_vertical2,e.SceneManager.mousex2=e.SceneManager.g_mousex2,e.SceneManager.mousey2=e.SceneManager.g_mousey2,e.SceneManager.horizontal3=e.SceneManager.g_horizontal3,e.SceneManager.vertical3=e.SceneManager.g_vertical3,e.SceneManager.mousex3=e.SceneManager.g_mousex3,e.SceneManager.mousey3=e.SceneManager.g_mousey3,e.SceneManager.horizontal4=e.SceneManager.g_horizontal4,e.SceneManager.vertical4=e.SceneManager.g_vertical4,e.SceneManager.mousex4=e.SceneManager.g_mousex4,e.SceneManager.mousey4=e.SceneManager.g_mousey4,e.SceneManager.x_mousey=0},t.parseSceneMetadata=function(t,n){window.parsing=!0;var a=n;null==a.manager?(e.SceneManager.CreateManagerSession(t,n),null==a.manager&&e.Tools.Warn("Failed to create a new manager session for current scene.")):e.Tools.Warn("Current scene has already been parsed."),window.parsing=!1},t.parseMeshMetadata=function(t,n){window.parsing=!0;var a=n;if(null!=a.manager){var r=(a.manager,[]);e.SceneManager.parseSceneMeshes(t,n,r),r.length>0&&(r.sort(function(e,t){return e.order<t.order?-1:e.order>t.order?1:0}),r.forEach(function(e){e.instance.register()}))}else e.Tools.Warn("No scene manager detected for current scene.");window.parsing=!1},t.parseSceneCameras=function(t,n,a){null!=t&&t.length>0&&t.forEach(function(t){if(null!=t.metadata&&t.metadata.api){t.metadata.clone=function(){return e.SceneManager.CloneMetadata(t.metadata)},e.SceneManager.setupCameraRigOptions(t,n);var r=t.metadata;null!=r.components&&r.components.length>0&&r.components.forEach(function(r){if(null!=r.klass&&""!==r.klass&&"BABYLON.SceneComponent"!==r.klass&&"BABYLON.OrthoController"!==r.klass){var i=e.Tools.Instantiate(r.klass);null!=i&&(r.instance=new i(t,n,r.update,r.properties),null!=r.instance&&null!=a&&a.push(r))}})}})},t.parseSceneLights=function(t,n,a){null!=t&&t.length>0&&t.forEach(function(t){if(null!=t.metadata&&t.metadata.api){t.metadata.clone=function(){return e.SceneManager.CloneMetadata(t.metadata)};var r=t.metadata;null!=r.components&&r.components.length>0&&r.components.forEach(function(r){if(null!=r.klass&&""!==r.klass&&"BABYLON.SceneComponent"!==r.klass&&"BABYLON.OrthoController"!==r.klass){var i=e.Tools.Instantiate(r.klass);null!=i&&(r.instance=new i(t,n,r.update,r.properties),null!=r.instance&&null!=a&&a.push(r))}})}})},t.parseSceneMeshes=function(t,n,a){null!=t&&t.length>0&&(t.forEach(function(t){if(null!=t.metadata&&t.metadata.api)if(t.metadata.clone=function(){return e.SceneManager.CloneMetadata(t.metadata)},e.SceneManager.setupSharedSkeleton(t,n),t.metadata.prefab===!0)t.setEnabled(!1),e.SceneManager.prefabs[t.name]=t,e.SceneManager.setupLodGroups(t,n,!0);else{e.SceneManager.setupLodGroups(t,n,!1),"sceneNavigationMesh"===t.name&&null!=n.metadata.properties.hasNavigationMesh&&n.metadata.properties.hasNavigationMesh===!0&&(e.SceneManager.GetInstance().hasNavigationMesh()===!1?e.SceneManager.GetInstance().buildNavigationMesh(t):e.Tools.Warn("Scene navigation mesh already exists. Ignoring navigation zone building for mesh: "+t.name));var r=t.metadata;if(null!=r.components&&r.components.length>0&&r.components.forEach(function(r){if(null!=r.klass&&""!==r.klass&&"BABYLON.SceneComponent"!==r.klass&&"BABYLON.OrthoController"!==r.klass){var i=e.Tools.Instantiate(r.klass);null!=i&&(r.instance=new i(t,n,r.update,r.properties),null!=r.instance&&null!=a&&a.push(r))}}),e.SceneManager.setupSocketMeshes(t,n),null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties){if(t.metadata.properties.defaultEllipsoid&&null!=t.metadata.properties.defaultEllipsoid&&t.metadata.properties.defaultEllipsoid.length>=3){
var i=t.metadata.properties.defaultEllipsoid;t.ellipsoid=new e.Vector3(i[0],i[1],i[2])}if(t.metadata.properties.ellipsoidOffset&&null!=t.metadata.properties.ellipsoidOffset&&t.metadata.properties.ellipsoidOffset.length>=3){var o=t.metadata.properties.ellipsoidOffset;t.ellipsoidOffset=new e.Vector3(o[0],o[1],o[2])}t.metadata.properties.hasOwnProperty("freezeWorldMatrix")&&t.metadata.properties.freezeWorldMatrix===!0&&t.freezeWorldMatrix(),t.metadata.properties.hasOwnProperty("convertToUnIndexed")&&t.metadata.properties.convertToUnIndexed===!0&&t.convertToUnIndexedMesh(),t.metadata.properties.hasOwnProperty("convertToFlatShaded")&&t.metadata.properties.convertToFlatShaded===!0&&t.convertToFlatShadedMesh()}var s=e.SceneManager.setupTerrainMeshes(t,n);if(s===!1&&null!=t.metadata.properties&&null!=t.metadata.properties.physicsTag){var l=(t.metadata.properties.physicsTag,t.metadata.properties.physicsMass),u=t.metadata.properties.physicsFriction,c=t.metadata.properties.physicsRestitution,p=t.metadata.properties.physicsImpostor,d=t.metadata.properties.physicsRotation,m=t.metadata.properties.physicsCollisions,h=t.metadata.properties.physicsCollisionGroup,g=t.metadata.properties.physicsCollisionMask,f=t.metadata.properties.physicsEnginePlugin;t.physicsImpostor=new e.PhysicsImpostor(t,p,{mass:l,friction:u,restitution:c},n),e.SceneManager.setupPhysicsImpostor(t,f,u,m,d,h,g)}}}),e.SceneManager.postParseSceneMeshes(t,n))},t.postParseSceneMeshes=function(t,n){if(null!=t&&t.length>0){var a={};if(t.forEach(function(t){if(null!=t.metadata&&t.metadata.api&&e.SceneManager.staticVertexLimit===!1&&t.metadata.layerIndex===e.SceneManager.StaticIndex&&t.name.indexOf("_StaticMesh_")>=0){t.metadata.layerIndex=-99;var n=t.material.id,r=null;a.hasOwnProperty(n)?r=a[n]:(r=[],a[n]=r),r.push(t)}}),e.SceneManager.staticVertexLimit===!1)for(var r in a)if(a.hasOwnProperty(r)){var i=a[r];if(null!=i&&i.length>1){var o=i[0].parent,s=e.Mesh.MergeMeshes(i,!0,!0);null!=s&&(s.parent=o)}}}},t.setupLodGroups=function(t,n,a){if(null!=t&&null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties&&t.metadata.properties.lodGroupInfo&&null!=t.metadata.properties.lodGroupInfo){var r=t.metadata.properties.lodGroupInfo,i=r.lodDetails,o=r.startCulling,s=t.getChildMeshes(!1);if(null!=i&&i.length>0&&null!=s&&s.length>0){var l=null;i.forEach(function(t){var r=t.lodRenderers,i=t.startRange;if(null!=r&&r.length>0){var o=r[0],u=o.name,c=e.SceneManager.FindMesh(u,s,e.SearchType.IndexOf),p=null;null!=c&&(null!=c.metadata&&c.metadata.tagName&&null!=c.metadata.tagName&&"[INSTANCE]"===c.metadata.tagName&&c.metadata.properties&&null!=c.metadata.properties&&c.metadata.properties.prefabSource&&null!=c.metadata.properties.prefabSource&&""!==c.metadata.properties.prefabSource&&(p=c,c=n.getMeshByID(c.metadata.properties.prefabSource)),null!=c&&(null==l&&(l=c,l.setEnabled(!1)),c!=l&&(a===!0?(null==e.SceneManager.orphans&&(e.SceneManager.orphans=new e.Mesh("Prefab.Orphans",n),e.SceneManager.orphans.setEnabled(!0),e.SceneManager.orphans.isVisible=!0),c.parent=e.SceneManager.orphans):c.parent=l,l.addLODLevel(i,c),null!=p&&(p.parent=null,p.metadata.tagName=null,p.metadata.prefabSource=null,e.SceneManager.GetInstance().safeDestroy(p)))))}}),null!=l&&(o>0&&l.addLODLevel(o,null),l.setEnabled(!0))}t.metadata.properties.lodGroupInfo=null}},t.setupTerrainMeshes=function(t,n){var a=!1;if(null!=t&&null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties&&t.metadata.properties.terrain===!0){a=!0;var r=0,i=(t.metadata.properties.segments?t.metadata.properties.segments:1,t.metadata.properties.colliders?t.metadata.properties.colliders:1),o=null!=t.metadata.properties.physicsTag,s=(t.metadata.properties.physicsTag?t.metadata.properties.physicsTag:"",t.metadata.properties.physicsMass?t.metadata.properties.physicsMass:0),l=t.metadata.properties.physicsFriction?t.metadata.properties.physicsFriction:0,u=t.metadata.properties.physicsRestitution?t.metadata.properties.physicsRestitution:0,c=t.metadata.properties.physicsImpostor?t.metadata.properties.physicsImpostor:0,p=t.metadata.properties.physicsRotation?t.metadata.properties.physicsRotation:0,d=!!t.metadata.properties.physicsCollisions&&t.metadata.properties.physicsCollisions,m=t.metadata.properties.physicsCollisionGroup?t.metadata.properties.physicsCollisionGroup:0,h=t.metadata.properties.physicsCollisionMask?t.metadata.properties.physicsCollisionMask:0,g=t.metadata.properties.physicsEnginePlugin?t.metadata.properties.physicsEnginePlugin:0,f=t.metadata.properties.terrainLodGroupInfo?t.metadata.properties.terrainLodGroupInfo:null,y=!!t.metadata.properties.terrainCollision&&t.metadata.properties.terrainCollision,S=null!=f?f.lodDetails:null,_=null;if(null!=S&&S.length>0)for(r=0,r=0;r<S.length;r++){var v=S[r],M=v.startingPercent;if(M<1){var b=v.startRange;null==_&&(_=[]),_.push(new e.SimplificationSettings(M,b,(!0)))}}var T=t.getChildMeshes(!0);if(null!=T&&T.length>0&&T.forEach(function(t){var a=t,r=a.name.indexOf(".Collider.")>=0;r===!1&&null!=_&&a.simplify(_,!0,e.SimplificationType.QUADRATIC),i>1?r===!0&&(o===!0?(a.parent=null,a.checkCollisions=!1,a.physicsImpostor=new e.PhysicsImpostor(a,c,{mass:s,friction:l,restitution:u},n),e.SceneManager.setupPhysicsImpostor(a,g,l,d,p,m,h)):a.checkCollisions=y):o===!0?(a.parent=null,a.checkCollisions=!1,a.physicsImpostor=new e.PhysicsImpostor(a,c,{mass:s,friction:l,restitution:u},n),e.SceneManager.setupPhysicsImpostor(a,g,l,d,p,m,h)):a.checkCollisions=y}),r=0,t.metadata.properties.treeInstances&&null!=t.metadata.properties.treeInstances&&t.metadata.properties.treeInstances.length>0){var x=t.metadata.properties.treeInstances;x.forEach(function(n){r++;var a=n.prefab,i=(n.color,n.heightScale),o=(n.lightmapColor,n.position),s=n.rotation,l=n.widthScale,u=a+"_"+r.toString(),c=t,p=new e.Vector3(o[0],o[1],o[2]),d=new e.Vector3(0,s,0),m=new e.Vector3(l,i,l);e.SceneManager.GetInstance().onready(function(){e.SceneManager.GetInstance().instantiatePrefab(a,u,p,d,m,c)})})}if(r=0,t.metadata.properties.detailPrototypes&&null!=t.metadata.properties.detailPrototypes&&t.metadata.properties.detailPrototypes.length>0){var w=t.metadata.properties.detailPrototypes;w.forEach(function(e){})}}return a},t.setupSocketMeshes=function(t,n){if(null!=t&&null!=t.metadata.socketList&&t.metadata.socketList.length>0&&null!=t.skeleton&&null!=t.skeleton.bones&&t.skeleton.bones.length>0){var a=t.metadata.socketList;a.forEach(function(a){if(t.skeleton.bones.length>=a.boneIndex+1){var r=t.skeleton.bones[a.boneIndex],i=a.boneName+".Socket.";null!=t.parent&&(i+=t.parent.name+"."),i+=t.name+"."+e.Tools.RandomId(),e.SceneManager.showDebugSockets===!0?(a.socketMesh=e.Mesh.CreateBox(i,e.SceneManager.socketColliderSize,n),a.socketMesh.visibility=e.SceneManager.colliderVisibility):a.socketMesh=new e.Mesh(i,n),a.socketMesh.position=new e.Vector3(a.positionX,a.positionY,a.positionZ),a.socketMesh.rotation=new e.Vector3(a.rotationX,a.rotationY,a.rotationZ),a.socketMesh.checkCollisions=!1,a.socketMesh.attachToBone(r,t)}})}},t.setupSharedSkeleton=function(t,n){if(null!=t&&null!=t.metadata&&t.metadata.properties&&null!=t.metadata.properties&&t.metadata.properties.sharedSkeletonId&&""!==t.metadata.properties.sharedSkeletonId){var a=t.metadata.properties.sharedSkeletonId,r=n.getMeshByID(a);null!=r&&null!=r.skeleton?(t.metadata.animationClips=null,t.skeleton=r.skeleton):e.Tools.Warn("Failed to locate source skeleton: "+a)}},t.setupPhysicsImpostor=function(t,n,a,r,i,o,s){void 0===o&&(o=1),void 0===s&&(s=1),null!=t&&null!=t.physicsImpostor&&t.physicsImpostor.executeNativeFunction(function(l,u){u?0===n&&(u.linearDamping=a,u.angularDamping=a,u.collisionResponse=r,u.collisionFilterGroup=o,u.collisionFilterMask=s,u.angularVelocity.x=0,u.angularVelocity.y=0,u.angularVelocity.z=0,u.velocity.x=0,u.velocity.y=0,u.velocity.z=0,1===i&&(u.fixedRotation=!0,u.updateMassProperties())):e.Tools.Warn("[Physics Native Function]: Null imposter body encountered for physcis mesh "+t.name+". Check physics mesh has no parent transform.")})},t.setupCameraRigOptions=function(t,n){if(null!=t&&null!=t.metadata&&null!=t.metadata.properties){if(t.metadata.properties.mainCamera&&null==e.SceneManager.GetInstance()._playerOneCamera&&(t.viewport=new e.Viewport(0,0,1,1),e.SceneManager.GetInstance()._playerOneCamera=t,t.metadata.properties.hasOwnProperty("stereoscopicSideBySide")&&(e.SceneManager.stereoCameras=t.metadata.properties.stereoscopicSideBySide)),t.metadata.properties.cameraType){var a=t.metadata.properties.cameraType;if("UniversalCamera"===a){if(t.metadata.properties.mainCamera&&t.metadata.properties.localMultiPlayerViewCamera){var r=t,i=r.name,o=(t.metadata.properties.localMultiPlayerElements,i+".2"),s=r.clone(o);s.name=o,s.viewport=new e.Viewport(0,0,0,0),s.setEnabled(!1),e.SceneManager.GetInstance()._playerTwoCamera=s;var l=i+".3",u=r.clone(l);u.name=l,u.viewport=new e.Viewport(0,0,0,0),u.setEnabled(!1),e.SceneManager.GetInstance()._playerThreeCamera=u;var c=i+".4",p=r.clone(c);p.name=c,p.viewport=new e.Viewport(0,0,0,0),p.setEnabled(!1),e.SceneManager.GetInstance()._playerFourCamera=p,r.name=i+".1",e.SceneManager.multiPlayerView=!0}}else if("ArcRotateCamera"===a){var d=t,m=t.metadata.properties.arcRotateAlpha,h=t.metadata.properties.arcRotateBeta,g=t.metadata.properties.arcRotateRadius,f=t.metadata.properties.arcRotateTarget,y=t.metadata.properties.arcRotateLowerRadiusLimit,S=t.metadata.properties.arcRotateUpperRadiusLimit,_=t.metadata.properties.arcRotateWheelDeltaPercentage;d.alpha=m,d.beta=h,d.radius=g,d.target=e.Vector3.FromArray(f),d.lowerRadiusLimit=y,d.upperRadiusLimit=S,d.wheelDeltaPercentage=_}else if("WebVRFreeCamera"===a||"WebVRGamepadCamera"===a){t.metadata.properties.wvrTrackPosition,t.metadata.properties.wvrPositionScale,t.metadata.properties.wvrDisplayName}else if("VRDeviceOrientationFreeCamera"===a||"VRDeviceOrientationGamepadCamera"===a){var v=t.metadata.properties.vrCameraBridge,M=t.metadata.properties.vrEyeToScreen,b=t.metadata.properties.vrInterpupillary,T=t.metadata.properties.vrScreenCenter,x=t.metadata.properties.vrVerticalRes,w=t.metadata.properties.vrHorizontalRes,k=t.metadata.properties.vrVerticalScreen,P=t.metadata.properties.vrHorizontalScreen,I=t.metadata.properties.vrLensCenterOffset,C=t.metadata.properties.vrLensSeparation,A=t.metadata.properties.vrPostProcessScale,B=t.metadata.properties.vrCompensateDistortion,O=t,L=.5-v,D=.5+v,E=e.VRCameraMetrics.GetDefault();E.eyeToScreenDistance=M,E.interpupillaryDistance=b,E.lensSeparationDistance=C,E.lensCenterOffset=I,E.hResolution=w,E.vResolution=x,E.vScreenCenter=T,E.vScreenSize=k,E.hScreenSize=P,E.postProcessScaleFactor=A,E.compensateDistortion=B,O.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:E,interaxialDistance:t.interaxialDistance}),O._rigCameras[0].viewport=new e.Viewport(0,0,L,1),O._rigCameras[1].viewport=new e.Viewport(D,0,L,1),n.clearColor=new e.Color4(0,0,0,1)}}if(t.mode===e.Camera.ORTHOGRAPHIC_CAMERA){var R=t.metadata.properties.orthographicSize||5,U="BABYLON.OrthoController",N=null==n.metadata||null==n.metadata.properties||!n.metadata.properties.hasOwnProperty("resizeCameras")||n.metadata.properties.resizeCameras,F=t.metadata;null==F.components&&(F.components=[]);var V=e.Tools.Instantiate(U);if(null!=V){var G={orthoSize:R,resizeCameras:N},X=new V(t,n,(!1),G);if(null!=X){var z={order:1e3,name:"EditorScriptComponent",klass:U,update:!1,properties:G,instance:X,tag:{}};F.components.push(z),X.register()}}}}},t.LocateOwnerSocketMesh=function(t,n,a){void 0===a&&(a=e.SearchType.StartsWith);var r=null;if(null!=n&&n.metadata&&null!=n.metadata&&n.metadata.socketList&&null!=n.metadata.socketList&&n.metadata.socketList.length>0){var i=n.metadata.socketList,o=null!=a?a:e.SearchType.StartsWith,s=0;for(s=0;s<i.length;s++){var l=i[s];if(o===e.SearchType.StartsWith){if(e.Utilities.StartsWith(l.boneName,t)){r=l.socketMesh;break}}else if(o===e.SearchType.EndsWith){if(e.Utilities.EndsWith(l.boneName,t)){r=l.socketMesh;break}}else if(o===e.SearchType.IndexOf){if(l.boneName.indexOf(t)>=0){r=l.socketMesh;break}}else if(l.boneName===t){r=l.socketMesh;break}}}return r},t.LocateOwnerSocketMeshes=function(e){var t=null;if(null!=e&&e.metadata&&null!=e.metadata&&e.metadata.socketList&&null!=e.metadata.socketList&&e.metadata.socketList.length>0){t=[];var n=e.metadata.socketList;n.forEach(function(e){t.push(e.socketMesh)})}return t},t.LocateOwnerAnimationTrack=function(t,n,a,r){void 0===a&&(a=!0),void 0===r&&(r=null);var i=null;if(null!=n&&n instanceof e.AbstractMesh){var o=n;if(null!=o.skeleton&&null!=o.skeleton.bones&&o.skeleton.bones.length>0&&o.skeleton.bones[0]){var s=o.skeleton.bones[0];null!=s.animations&&s.animations.length>t&&null!=s.animations[t]&&(i=s.animations[t])}}if(null==i&&null!=n.animations&&n.animations.length>t&&null!=n.animations[t]&&(i=n.animations[t]),null==i&&n instanceof e.AbstractMesh){var l=n.getChildMeshes(a,r);if(null!=l&&l.length>0)for(var u=0;u<l.length;u++){var c=l[u];if(null!=c.skeleton&&null!=c.skeleton.bones&&c.skeleton.bones.length>0&&c.skeleton.bones[0]){var p=c.skeleton.bones[0];if(null!=p.animations&&p.animations.length>t&&null!=p.animations[t]){i=p.animations[t];break}}if(null==i&&null!=c.animations&&c.animations.length>0&&c.animations.length>t&&null!=c.animations[t]){i=c.animations[t];break}}}return i},t.DestroyComponents=function(t,n){if(void 0===n&&(n=!0),null!=t&&null!=t.metadata&&t.metadata.api){var a=t.metadata;null!=a.components&&a.components.length>0&&a.components.forEach(function(t){null!=t.instance&&(e.SceneComponent.DestroyInstance(t.instance),t.instance=null)}),null!=a.socketList&&a.socketList.length>0&&a.socketList.forEach(function(e){null!=e.socketMesh&&(e.socketMesh.dispose(),e.socketMesh=null)}),n&&(null!=t.metadata.components&&(t.metadata.components=null),null!=t.metadata.properties&&(t.metadata.properties=null),null!=t.metadata.socketList&&(t.metadata.socketList=null),null!=t.metadata.animationClips&&(t.metadata.animationClips=null),null!=t.metadata.animationEvents&&(t.metadata.animationEvents=null),null!=t.metadata.collisionEvent&&(t.metadata.collisionEvent=null),t.metadata=null)}},t.DisposeOwner=function(t){t.name;if(t instanceof e.AbstractMesh){var n=t;null!=n.physicsImpostor&&(n.physicsImpostor.dispose(),n.physicsImpostor=null)}t.dispose()},t.PrintToScreen=function(t,n){if(void 0===n&&(n="white"),e.SceneManager.print=document.getElementById("print"),null==e.SceneManager.print){var a=document.createElement("div");a.id="print",a.style.position="absolute",a.style.left="6px",a.style.bottom="3px",a.style.fontSize="12px",a.style.zIndex="10000",a.style.color="#0c0",document.body.appendChild(a),e.SceneManager.print=a}null!=e.SceneManager.print&&e.SceneManager.print.innerHTML!==t&&(e.SceneManager.print.style.color!==n&&(e.SceneManager.print.style.color=n),e.SceneManager.print.innerHTML=t)},t.SetAnimationLooping=function(e,t){if(null!=e&&null!=e.animations&&e.animations.length>0)for(var n=e.animations,a=0;a<n.length;a++)n[a].loopMode=t},t.SetSkeletonLooping=function(t,n){null!=t&&(null==t.animationPropertiesOverride&&(t.animationPropertiesOverride=new e.AnimationPropertiesOverride),t.animationPropertiesOverride.loopMode=n)},t.SetSkeletonBlending=function(t,n){null!=t&&(null==t.animationPropertiesOverride&&(t.animationPropertiesOverride=new e.AnimationPropertiesOverride),t.animationPropertiesOverride.enableBlending=n>0,t.animationPropertiesOverride.blendingSpeed=n)},t.SetSkeletonProperties=function(t,n,a){null!=t&&(null==t.animationPropertiesOverride&&(t.animationPropertiesOverride=new e.AnimationPropertiesOverride),t.animationPropertiesOverride.loopMode=n,t.animationPropertiesOverride.enableBlending=a>0,t.animationPropertiesOverride.blendingSpeed=a)},t.FindMesh=function(t,n,a){void 0===a&&(a=e.SearchType.StartsWith);var r=null,i=null!=a?a:e.SearchType.StartsWith;if(null!=n&&n.length>0)for(var o=0;o<n.length;o++){var s=n[o];if(i===e.SearchType.StartsWith){if(e.Utilities.StartsWith(s.name,t)){r=s;break}}else if(i===e.SearchType.EndsWith){if(e.Utilities.EndsWith(s.name,t)){r=s;break}}else if(i===e.SearchType.IndexOf){if(s.name.indexOf(t)>=0){r=s;break}}else if(s.name===t){r=s;break}}return r},t.CloneValue=function(t,n){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(n):t.clone?t.clone():t:null},t.CloneMetadata=function(t){var n=null;if(null!=t){var a={};e.SceneManager.DeepCopyProperties(t.properties,a);var r={};e.SceneManager.DeepCopyProperties(t.navAgent,r);var i={};e.SceneManager.DeepCopyProperties(t.meshLink,i);var o={};e.SceneManager.DeepCopyProperties(t.meshObstacle,o);var s=[];null!=t.socketList&&t.socketList.length>0&&t.socketList.forEach(function(t){var n={};e.SceneManager.DeepCopyProperties(t,n),s.push(n)});var l=[];null!=t.animationClips&&t.animationClips.length>0&&t.animationClips.forEach(function(t){var n={};e.SceneManager.DeepCopyProperties(t,n),l.push(n)});var u=[];null!=t.animationEvents&&t.animationEvents.length>0&&t.animationEvents.forEach(function(t){var n={};e.SceneManager.DeepCopyProperties(t,n),u.push(n)});var c=[];null!=t.components&&t.components.length>0&&t.components.forEach(function(t){var n={};e.SceneManager.DeepCopyProperties(t.properties,n),c.push({name:t.name,klass:t.klass,order:t.order,tag:t.tag,update:t.update,properties:n,instance:null})}),n={api:!0,type:t.type,prefab:!1,state:{},objectName:t.objectName,objectId:e.Tools.RandomId(),tagName:t.tagName,layerIndex:t.prefab===!1?t.layerIndex:0,layerName:t.prefab===!1?t.layerName:"Default",areaIndex:t.areaIndex,navAgent:r,meshLink:i,meshObstacle:o,socketList:s,animationClips:l,animationEvents:l,collisionEvent:null,components:c,properties:a}}return n},t.DeepCopyProperties=function(t,n,a,r){for(var i in t)if(("_"!==i[0]||r&&r.indexOf(i)!==-1)&&(!a||a.indexOf(i)===-1)){var o=t[i],s=typeof o;if("function"!==s)if("object"===s)if(o instanceof Array){if(n[i]=[],o.length>0)if("object"==typeof o[0])for(var l=0;l<o.length;l++){var u=e.SceneManager.CloneValue(o[l],n);n[i].indexOf(u)===-1&&n[i].push(u)}else n[i]=o.slice(0)}else n[i]=e.SceneManager.CloneValue(o,n);else n[i]=o}},t.GenerateTerrainFromHeightMap=function(t,n,a,r,i){var o=r.width||10,s=r.height||10,l=r.minHeight||0,u=r.maxHeight||1,c=r.resolution||1,p=r.updatable,d=null!=a?a.lodDetails:null;null!=a?a.startCulling:0;(null==d||d.length<=0)&&(d=[{startingPercent:1}]);var m=r.onReady,h=function(n){var a=null,r=document.createElement("canvas"),h=r.getContext("2d");if(!h)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!i.isDisposed){if(null!=d&&d.length>0){var g=n.width,f=n.height;r.width=g,r.height=f,h.drawImage(n,0,0);for(var y=h.getImageData(0,0,g,f).data,S=0;S<d.length;S++){var _=d[S],v=_.startingPercent,M=c*v,b=new e.GroundMesh(t+".LOD"+S.toString(),i);b.setEnabled(!1),b._subdivisionsX=M,b._subdivisionsY=M,b._width=o,b._height=s,b._maxX=b._width/2,b._maxZ=b._height/2,b._minX=-b._maxX,b._minZ=-b._maxZ;var T=e.SceneManager.GenerateTerrainVertexData({width:o,height:s,subdivisions:M,minHeight:l,maxHeight:u,buffer:y,bufferWidth:g,bufferHeight:f});T.applyToMesh(b,p),b._setReady(!0),null==a&&(a=[]),a.push(b)}}m&&m(a)}};e.Tools.LoadImage(n,h,function(){},i.database)},t.GenerateTerrainVertexData=function(t){var n,a,r=[],i=[],o=[],s=[],l=new Float32Array(t.buffer.buffer);for(n=0;n<=t.subdivisions;n++)for(a=0;a<=t.subdivisions;a++){var u=new e.Vector3(a*t.width/t.subdivisions-t.width/2,0,(t.subdivisions-n)*t.height/t.subdivisions-t.height/2),c=(u.x+t.width/2)/t.width*(t.bufferWidth-1)|0,p=(1-(u.z+t.height/2)/t.height)*(t.bufferHeight-1)|0,d=c+p*t.bufferWidth,m=l[d];u.y=t.minHeight+(t.maxHeight-t.minHeight)*m,i.push(u.x,u.y,u.z),o.push(0,0,0),s.push(a/t.subdivisions,1-n/t.subdivisions)}for(n=0;n<t.subdivisions;n++)for(a=0;a<t.subdivisions;a++)r.push(a+1+(n+1)*(t.subdivisions+1)),r.push(a+1+n*(t.subdivisions+1)),r.push(a+n*(t.subdivisions+1)),r.push(a+(n+1)*(t.subdivisions+1)),r.push(a+1+(n+1)*(t.subdivisions+1)),r.push(a+n*(t.subdivisions+1));e.VertexData.ComputeNormals(i,r,o);var h=new e.VertexData;return h.indices=r,h.positions=i,h.normals=o,h.uvs=s,h},t.CreateMeshFromSubmesh=function(t,n,a,r,i,o){void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===o&&(o=null);var s=t.subMeshes[n],l=new e.VertexData;l.positions=[],l.normals=[],l.indices=[];for(var u,c=s.getMesh().getVerticesData(e.VertexBuffer.PositionKind),p=s.getMesh().getVerticesData(e.VertexBuffer.NormalKind),d=s.getMesh().getIndices(),m=0,h=0,g=0,f=0,n=s.indexStart;n<s.indexStart+s.indexCount;n+=3)for(var y=0;y<3;y++)l.indices.push(m++),u=d[n+y],l.positions.push(c[3*u],c[3*u+1],c[3*u+2]),l.normals.push(p[3*u],p[3*u+1],p[3*u+2]),r&&(h+=c[3*u],g+=c[3*u+1],f+=c[3*u+2]);if(r){var S=l.indices.length;h/=S,g/=S,f/=S;for(var n=0;n<S;n++)l.positions[3*n]-=h,l.positions[3*n+1]-=g,l.positions[3*n+2]-=f}if(null==o){var _=t.name+"."+n.toString();o=new e.Mesh(_,a)}return l.applyToMesh(o,i),r&&(o.position=new e.Vector3(h,g,f)),o},t.SetWindowsLaunchMode=function(t){e.SceneManager.IsWindows()&&"undefined"!=typeof Windows.UI.ViewManagement&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationView&&(Windows.UI.ViewManagement.ApplicationView.preferredLaunchWindowingMode=Windows.UI.ViewManagement.ApplicationViewWindowingMode.fullScreen)},t.QuitWindowsApplication=function(){e.SceneManager.IsWindows()&&window.close()},t.IsWebAssemblyPluginEnabled=function(){return!!window.isWebAssemblyPluginEnabled&&window.isWebAssemblyPluginEnabled()},t.LoadWebAssemblyModule=function(e,t){return fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return WebAssembly.instantiate(e,t)}).then(function(e){return e.instance})},t.IsXboxLivePluginEnabled=function(){return!!window.isXboxLivePluginEnabled&&window.isXboxLivePluginEnabled()},t.IsXboxLiveUserSignedIn=function(t,n){if(void 0===t&&(t=null),void 0===n&&(n=e.PlayerNumber.One),e.SceneManager.IsXboxLivePluginEnabled()){var a=null!=t?e.SceneManager.GetXboxLiveSystemUser(t,n):e.SceneManager.GetXboxLiveUser(n);return null!=a&&1==a.isSignedIn}return!1},t.XboxLiveUserSignIn=function(t,n,a,r){void 0===t&&(t=e.PlayerNumber.One),e.SceneManager.IsXboxLivePluginEnabled()&&e.SceneManager.XboxLiveUserSilentSignIn(t,function(i){i.status===Microsoft.Xbox.Services.System.SignInStatus.userInteractionRequired?e.SceneManager.XboxLiveUserDialogSignIn(t,function(e){n&&n(e)},a,r):n&&n(i)},a,r)},t.XboxLiveUserSilentSignIn=function(t,n,a,r){return void 0===t&&(t=e.PlayerNumber.One),e.SceneManager.IsXboxLivePluginEnabled()?e.SceneManager.GetXboxLiveUser(t).signInSilentlyAsync(null).then(n,a,r):null},t.XboxLiveUserDialogSignIn=function(t,n,a,r){return void 0===t&&(t=e.PlayerNumber.One),e.SceneManager.IsXboxLivePluginEnabled()?e.SceneManager.GetXboxLiveUser(t).signInAsync(null).then(n,a,r):null},t.LoadXboxLiveUserProfile=function(t,n,a,r){return void 0===t&&(t=e.PlayerNumber.One),e.SceneManager.IsXboxLivePluginEnabled()?e.SceneManager.GetXboxLiveUserContext(t).profileService.getUserProfileAsync(e.SceneManager.GetXboxLiveUser(t).xboxUserId).then(n,a,r):null},t.GetXboxLiveUser=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=null;if(e.SceneManager.IsXboxLivePluginEnabled())switch(t){case e.PlayerNumber.One:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveUserOne();break;case e.PlayerNumber.Two:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveUserTwo();break;case e.PlayerNumber.Three:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveUserThree();break;case e.PlayerNumber.Four:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveUserFour()}return n},t.GetXboxLiveSystemUser=function(t,n){void 0===n&&(n=e.PlayerNumber.One);var a=null;if(e.SceneManager.IsXboxLivePluginEnabled())switch(n){case e.PlayerNumber.One:a=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveSystemUserOne(t);break;case e.PlayerNumber.Two:a=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveSystemUserTwo(t);break;case e.PlayerNumber.Three:a=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveSystemUserThree(t);break;case e.PlayerNumber.Four:a=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveSystemUserFour(t)}return a},t.GetXboxLiveUserContext=function(t){void 0===t&&(t=e.PlayerNumber.One);var n=null;if(e.SceneManager.IsXboxLivePluginEnabled())switch(t){case e.PlayerNumber.One:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveContextOne();break;case e.PlayerNumber.Two:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveContextTwo();break;case e.PlayerNumber.Three:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveContextThree();break;case e.PlayerNumber.Four:n=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveContextFour()}return n},t.ResetXboxLiveUserContext=function(t){if(void 0===t&&(t=e.PlayerNumber.One),e.SceneManager.IsXboxLivePluginEnabled()&&e.SceneManager.IsXboxLivePluginEnabled())switch(t){case e.PlayerNumber.One:window.BabylonToolkit.XboxLive.Plugin.resetXboxLiveUserContextOne();break;case e.PlayerNumber.Two:window.BabylonToolkit.XboxLive.Plugin.resetXboxLiveUserContextTwo();break;case e.PlayerNumber.Three:window.BabylonToolkit.XboxLive.Plugin.resetXboxLiveUserContextThree();break;case e.PlayerNumber.Four:window.BabylonToolkit.XboxLive.Plugin.resetXboxLiveUserContextFour()}},t.GetXboxLiveContextProperty=function(t){return e.SceneManager.IsXboxLivePluginEnabled()?window.BabylonToolkit.XboxLive.Plugin.getXboxLiveContextProperty(t):null},t.SetXboxLiveContextProperty=function(t,n){e.SceneManager.IsXboxLivePluginEnabled()&&window.BabylonToolkit.XboxLive.Plugin.setXboxLiveContextProperty(t,n)},t.ResetXboxLivePropertyContexts=function(){e.SceneManager.IsXboxLivePluginEnabled()&&window.BabylonToolkit.XboxLive.Plugin.resetXboxLivePropertyContexts()},t.SetXboxLiveSignOutHandler=function(t){void 0===t&&(t=null),e.SceneManager.IsXboxLivePluginEnabled()&&(window.BabylonToolkit.XboxLive.Plugin.onusersignout=t)},t.MarkupStore={},t.GamepadManager=null,t.GamepadConnected=null,t.GamepadDisconnected=null,t.me=null,t.min=Number.MIN_VALUE,t.max=Number.MAX_VALUE-100,t.print=null,t.keymap={},t.prefabs=null,t.wheel=0,t.clientx=0,t.clienty=0,t.mousex=0,t.mousey=0,t.vertical=0,t.horizontal=0,t.mousex2=0,t.mousey2=0,t.vertical2=0,t.horizontal2=0,t.mousex3=0,t.mousey3=0,t.vertical3=0,t.horizontal3=0,t.mousex4=0,t.mousey4=0,t.vertical4=0,t.horizontal4=0,t.x_wheel=0,t.x_mousex=0,t.x_mousey=0,t.x_vertical=0,t.x_horizontal=0,t.k_mousex=0,t.k_mousey=0,t.k_vertical=0,t.k_horizontal=0,t.j_mousex=0,t.j_mousey=0,t.j_vertical=0,t.j_horizontal=0,t.g_mousex1=0,t.g_mousey1=0,t.g_vertical1=0,t.g_horizontal1=0,t.g_mousex2=0,t.g_mousey2=0,t.g_vertical2=0,t.g_horizontal2=0,t.g_mousex3=0,t.g_mousey3=0,t.g_vertical3=0,t.g_horizontal3=0,t.g_mousex4=0,t.g_mousey4=0,t.g_vertical4=0,t.g_horizontal4=0,t.engine=null,t.orphans=null,t.multiPlayerView=!1,t.multiPlayerCount=1,t.mouseButtonPress=[],t.mouseButtonDown=[],t.mouseButtonUp=[],t.keyButtonPress=[],t.keyButtonDown=[],t.keyButtonUp=[],t.leftJoystick=null,t.rightJoystick=null,t.virtualJoystick=!1,t.showRenderStats=!1,t.sceneRenderStats=0,t.renderStatsInstance=null,t.showDebugSockets=!1,t.colliderVisibility=.25,t.socketColliderSize=.125,t.staticVertexLimit=!1,t.debugLayerVisible=!1,t.previousPosition=null,t.preventDefault=!1,t.stereoCameras=!0,t.rightHanded=!0,t.gamepad1=null,t.gamepad1Type=e.GamepadType.None,t.gamepad1ButtonPress=[],t.gamepad1ButtonDown=[],t.gamepad1ButtonUp=[],t.gamepad1DpadPress=[],t.gamepad1DpadDown=[],t.gamepad1DpadUp=[],t.gamepad1LeftTrigger=[],t.gamepad1RightTrigger=[],t.gamepad2=null,t.gamepad2Type=e.GamepadType.None,t.gamepad2ButtonPress=[],t.gamepad2ButtonDown=[],t.gamepad2ButtonUp=[],t.gamepad2DpadPress=[],t.gamepad2DpadDown=[],t.gamepad2DpadUp=[],t.gamepad2LeftTrigger=[],t.gamepad2RightTrigger=[],t.gamepad3=null,t.gamepad3Type=e.GamepadType.None,t.gamepad3ButtonPress=[],t.gamepad3ButtonDown=[],t.gamepad3ButtonUp=[],t.gamepad3DpadPress=[],t.gamepad3DpadDown=[],t.gamepad3DpadUp=[],t.gamepad3LeftTrigger=[],t.gamepad3RightTrigger=[],t.gamepad4=null,t.gamepad4Type=e.GamepadType.None,t.gamepad4ButtonPress=[],t.gamepad4ButtonDown=[],t.gamepad4ButtonUp=[],t.gamepad4DpadPress=[],t.gamepad4DpadDown=[],t.gamepad4DpadUp=[],t.gamepad4LeftTrigger=[],t.gamepad4RightTrigger=[],t.loader=null,t.readies=[],t}();e.SceneManager=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){if(null==e)throw new Error("Null owner agent mesh specified.");this._mesh=e,this._info=null!=this._mesh.metadata&&null!=this._mesh.metadata.navAgent?this._mesh.metadata.navAgent:null}return Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"info",{get:function(){return this._info},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasAgentInfo",{get:function(){return null!=this.info},enumerable:!0,configurable:!0}),t.prototype.setDestination=function(t){this.hasAgentInfo||e.Tools.Warn("Null navigation agent metadata. Set agent destination ignored.")},t}();e.NavigationAgent=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(t){function n(e,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={});var i=t.call(this,e,n,a,r)||this;return i._time=0,i._auto=!1,i._shader=null,i._effect=null,i._shuriken=null,i.updateTime=!1,i.maximumTime=0,i._uniforms=[],i._samplers=[],i._textures={},i._textureArrays={},i._floats={},i._floatsArrays={},i._colors3={},i._colors4={},i._vectors2={},i._vectors3={},i._vectors4={},i._matrices={},i._matrices3x3={},i._matrices2x2={},i._vectors3Arrays={},i._time=0,i._auto=!1,i._effect=null,i._shuriken=null,i._shader=null,i.updateTime=!1,i.maximumTime=0,i.initializeParticleSystem(),i}return __extends(n,t),Object.defineProperty(n.prototype,"shuriken",{get:function(){return this._shuriken},enumerable:!0,configurable:!0}),n.prototype.start=function(){this.updateTime===!0&&this.setEffectTime(0),this._auto===!0&&null!=this._shuriken&&this._shuriken.start()},n.prototype.update=function(){this.updateTime===!0&&this.setEffectTime(this._time+this.manager.deltaTime)},n.prototype.destroy=function(){if(null!=this._effect&&(this._effect.onBind=null,this._effect=null),null!=this._shuriken){var t=this._shuriken;t._customEffect&&(t._customEffect=null),t=null,this._shuriken.dispose(),this._shuriken=null}if(null!=this._shader&&""!==this._shader){var n=this._shader+"FragmentShader";e.Effect.ShadersStore[n]&&delete e.Effect.ShadersStore[n]}},Object.defineProperty(n.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"textureArray",{get:function(){return this._textureArrays},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"floats",{get:function(){return this._floats},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"floatsArrays",{get:function(){return this._floatsArrays},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colors3",{get:function(){return this._colors3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colors4",{get:function(){return this._colors4},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors2",{get:function(){return this._vectors2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors3",{get:function(){return this._vectors3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors4",{get:function(){return this._vectors4},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"matrices",{get:function(){return this._matrices},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"matrices3x3",{get:function(){return this._matrices3x3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"matrices2x2",{get:function(){return this._matrices2x2},enumerable:!0,
configurable:!0}),Object.defineProperty(n.prototype,"vectors3Arrays",{get:function(){return this._vectors3Arrays},enumerable:!0,configurable:!0}),n.prototype.setTexture=function(e,t){return this._textures[e]=t,this},n.prototype.setTextureArray=function(e,t){return this._samplers.indexOf(e)===-1&&this._samplers.push(e),this._textureArrays[e]=t,this},n.prototype.setFloat=function(e,t){return this._floats[e]=t,this},n.prototype.setFloats=function(e,t){return this._floatsArrays[e]=t,this},n.prototype.setColor3=function(e,t){return this._colors3[e]=t,this},n.prototype.setColor4=function(e,t){return this._colors4[e]=t,this},n.prototype.setVector2=function(e,t){return this._vectors2[e]=t,this},n.prototype.setVector3=function(e,t){return this._vectors3[e]=t,this},n.prototype.setVector4=function(e,t){return this._vectors4[e]=t,this},n.prototype.setMatrix=function(e,t){return this._matrices[e]=t,this},n.prototype.setMatrix3x3=function(e,t){return this._matrices3x3[e]=t,this},n.prototype.setMatrix2x2=function(e,t){return this._matrices2x2[e]=t,this},n.prototype.setArray3=function(e,t){return this._vectors3Arrays[e]=t,this},n.prototype.getEffectTime=function(){return this._time},n.prototype.setEffectTime=function(e){this._time=e,this.maximumTime>0&&this._time>=this.maximumTime&&(this._time=0),this.setFloat("time",this._time)},n.prototype.bindParticleSystemEffect=function(e,t){var n;if(e.scene.texturesEnabled)for(n in e._textures){var a=e._textures[n];a&&(t.setTexture(n,a),t.setFloat2(n+"Infos",a.coordinatesIndex,a.level),t.setFloat2(n+"Scale",a.uScale,a.vScale),t.setMatrix(n+"Matrix",a.getTextureMatrix()))}if(e.scene.texturesEnabled)for(n in e._textureArrays)t.setTextureArray(n,e._textureArrays[n]);for(n in e._floats)t.setFloat(n,e._floats[n]);for(n in e._floatsArrays)t.setArray(n,e._floatsArrays[n]);for(n in e._colors3)t.setColor3(n,e._colors3[n]);for(n in e._colors4){var r=e._colors4[n];t.setFloat4(n,r.r,r.g,r.b,r.a)}for(n in e._vectors2)t.setVector2(n,e._vectors2[n]);for(n in e._vectors3)t.setVector3(n,e._vectors3[n]);for(n in e._vectors4)t.setVector4(n,e._vectors4[n]);for(n in e._matrices)t.setMatrix(n,e._matrices[n]);for(n in e._matrices3x3)t.setMatrix3x3(n,e._matrices3x3[n]);for(n in e._matrices2x2)t.setMatrix2x2(n,e._matrices2x2[n]);for(n in e._vectors3Arrays)t.setArray3(n,e._vectors3Arrays[n])},n.prototype.initializeParticleSystem=function(){this._auto=this.getProperty("autoStart",!1);var t=this.getProperty("capacity",100),n=this.getProperty("particleName",null),a=this.getProperty("startSpeed",.01),r=this.getProperty("emitType",0),i=this.getProperty("duration",10);null!=n&&""!==n||(n="PX_Unknown_"+e.Tools.RandomId());var o=this.getProperty("emitBurst",null),s=this.getProperty("ShurikenUpdateModules",null);null!=s&&(this.updateTime=s.updateEffectTime,this.maximumTime=s.maximumEffectTime);var l=this.getProperty("customShaderEffect",null);if(null!=l&&""!==l){var u=this,c=this.getProperty("customShaderDefines",null),p=this.getProperty("customShaderUniforms",null),d=this.getProperty("customShaderSamplers",null),m=null!=c&&c.length>0?c.join("\n"):null;this._shader="PX_"+this.mesh.name+"_"+n.replace("PX_","")+"_"+e.Tools.RandomId().replace(".","")+"_Effect";var h=l+"FragmentShader",g=this._shader+"FragmentShader";e.Effect.ShadersStore[g]=e.Effect.ShadersStore[h],this._effect=this.engine.createEffectForParticles(this._shader,p,d,m),this._effect.onBind=function(e){u.bindParticleSystemEffect(u,e)}}this._shuriken=new e.ShurikenParticleSystem(n,t,this.scene,i,r,a,o,s,this._effect),this._shuriken.emitter=this.mesh,this._shuriken.blendMode=this.getProperty("blendMode",0),this._shuriken.emitRate=this.getProperty("emitRate",100),this._shuriken.loopPlay=this.getProperty("loopPlay",!1),this._shuriken.delayTime=this.getProperty("delayTime",0);var f=this.getProperty("lifeTime"),y=e.Utilities.ParseVector2(f,new e.Vector2(1,1));this._shuriken.minLifeTime=y.x,this._shuriken.maxLifeTime=y.y;var S=this.getProperty("emitPower"),_=e.Utilities.ParseVector2(S,new e.Vector2(1,1));this._shuriken.minEmitPower=_.x,this._shuriken.maxEmitPower=_.y;var v=this.getProperty("angularSpeed"),M=e.Utilities.ParseVector2(v,new e.Vector2(0,0));this._shuriken.minAngularSpeed=M.x,this._shuriken.maxAngularSpeed=M.y;var b=this.getProperty("particleSize"),T=e.Utilities.ParseVector2(b,new e.Vector2(1,1));this._shuriken.minSize=T.x,this._shuriken.maxSize=T.y;var x=this.getProperty("color1");this._shuriken.color1=e.Utilities.ParseColor4(x,new e.Color4(1,1,1,1));var w=this.getProperty("color2");this._shuriken.color2=e.Utilities.ParseColor4(w,new e.Color4(1,1,1,1));var k=this.getProperty("colorDead");this._shuriken.colorDead=e.Utilities.ParseColor4(k,new e.Color4(0,0,0,1));var P=this.getProperty("textureMask");this._shuriken.textureMask=e.Utilities.ParseColor4(P,new e.Color4(1,1,1,1));var I=this.getProperty("direction1");this._shuriken.direction1=e.Utilities.ParseVector3(I,new e.Vector3(0,1,0));var C=this.getProperty("direction2");this._shuriken.direction2=e.Utilities.ParseVector3(C,new e.Vector3(0,1,0));var A=this.getProperty("minEmitBox");this._shuriken.minEmitBox=e.Utilities.ParseVector3(A,new e.Vector3(0,0,0));var B=this.getProperty("maxEmitBox");this._shuriken.maxEmitBox=e.Utilities.ParseVector3(B,new e.Vector3(0,0,0));var O=this.getProperty("gravityVector"),L=this.getProperty("gravityMode",0),D=this.getProperty("gravityMultiplier",1);1===L?this._shuriken.gravity=this.scene.gravity.multiplyByFloats(D,D,D):this._shuriken.gravity=e.Utilities.ParseVector3(O,new e.Vector3(0,0,0));var E=this.getProperty("textureImage",null);if(null!=E&&E.name&&""!==E.name){var R=E.name,U=this.manager.getScenePath();this._shuriken.particleTexture=new e.Texture(U+R,this.scene)}},n}(e.MeshComponent);e.UniversalParticleSystem=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(t){function n(n,a,r,i){void 0===r&&(r=!0),void 0===i&&(i={});var o=t.call(this,n,a,r,i)||this;return o.movementType=e.MovementType.DirectVelocity,o.avatarControl=0,o.avatarHeight=2,o.avatarRadius=.25,o.fallingVelocity=.1,o.slidingVelocity=.25,o.onPhysicsContact=null,o._jumping=!1,o._falling=!1,o._sliding=!1,o._grounded=!0,o._threashold=.5,o._velocity=e.Vector3.Zero(),o._angularVelocity=e.Vector3.Zero(),o._jumpingVelocity=e.Vector3.Zero(),o.movementType=o.getProperty("movementType",e.MovementType.DirectVelocity),o.avatarControl=o.getProperty("avatarControl",0),o.avatarHeight=o.getProperty("avatarHeight",2),o.avatarRadius=o.getProperty("avatarRadius",.25),o.fallingVelocity=o.getProperty("fallingVelocity",.1),o.slidingVelocity=o.getProperty("slidingVelocity",.25),o}return __extends(n,t),n.prototype.isJumping=function(){return this._jumping},n.prototype.isFalling=function(){return this._falling},n.prototype.isSliding=function(){return this._sliding},n.prototype.isGrounded=function(){return this._grounded},n.prototype.getVelocity=function(){return this._velocity},n.prototype.getFriction=function(){return this.manager.getFrictionLevel(this.mesh)},n.prototype.setFriction=function(e){this.manager.applyFriction(this.mesh,e)},n.prototype.start=function(){var t=this;this._jumping=!1,this._falling=!1,this._sliding=!1,this._grounded=!0,this.updateGroundingState(),this.onCollisionEvent(function(n,a){t.manager.checkCollisionContact(t.mesh,n,e.CollisionContact.Bottom,t._threashold)===!0&&(t._jumping=!1,t.updateGroundingState()),null!=t.onPhysicsContact&&t.onPhysicsContact(n,a)})},n.prototype.update=function(){this.updateGroundingState()},n.prototype.after=function(){this.updateGroundingState()},n.prototype.updateGroundingState=function(){this._grounded=this._jumping===!1,this._velocity=this.manager.getLinearVelocity(this.mesh),this._falling=null!=this._velocity&&this._velocity.y<-this.fallingVelocity,this._sliding=this._grounded===!0&&null!=this._velocity&&this._velocity.y<-this.slidingVelocity},n.prototype.move=function(t,n,a){void 0===n&&(n=-1),void 0===a&&(a=-1),n>=0&&this.manager.applyFriction(this.mesh,n),this.movementType===e.MovementType.AppliedForces?this.manager.applyForce(this.mesh,t,this.mesh.getAbsolutePosition()):this.manager.setLinearVelocity(this.mesh,t),a>0&&(this._jumping=!0,this._jumpingVelocity.copyFromFloats(0,a,0),this.manager.applyImpulse(this.mesh,this._jumpingVelocity,this.mesh.getAbsolutePosition()),this.updateGroundingState())},n.prototype.rotate=function(e,t){void 0===t&&(t=-1),t>=0&&this.manager.applyFriction(this.mesh,t),this._angularVelocity.copyFromFloats(0,e,0),this.manager.setAngularVelocity(this.mesh,this._angularVelocity)},n}(e.MeshComponent);e.CharacterController=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return t.Warning=function(t){e.Tools.Warn(t)},t.Loader=null,t}();e.ToolkitPlugin=t;var n=function(){function t(){this.name="toolkit.json",this.extensions={".babylon":{isBinary:!1}}}return t.prototype.load=function(t,n,a){var r=!1;return null!=e.ToolkitPlugin.Loader?(r=e.ToolkitPlugin.Loader.load(t,n,a,e.ToolkitPlugin.Warning),r===!0?e.SceneManager.parseSceneMetadata(a,t):e.Tools.Warn("Babylon.js failed to load json scene data")):e.Tools.Warn("Babylon.js null registered babylon file loader plugin"),r},t.prototype.importMesh=function(t,n,a,r,i,o,s){var l=!1;return null!=e.ToolkitPlugin.Loader?(l=e.ToolkitPlugin.Loader.importMesh(t,n,a,r,i,o,s,e.ToolkitPlugin.Warning),l===!0?e.SceneManager.parseMeshMetadata(i,n):e.Tools.Warn("Babylon.js failed to load json scene data")):e.Tools.Warn("Babylon.js null registered babylon file loader plugin"),l},t.prototype.loadAssetContainer=function(t,n,a,r){return e.ToolkitPlugin.Loader.loadAssetContainer(t,n,a,r)},t}();e.JsonSceneLoader=n}(BABYLON||(BABYLON={}));var TimerPlugin=window;TimerPlugin.requestAnimFrame=function(){return TimerPlugin.requestAnimationFrame||TimerPlugin.webkitRequestAnimationFrame||TimerPlugin.mozRequestAnimationFrame||TimerPlugin.oRequestAnimationFrame||TimerPlugin.msRequestAnimationFrame||function(e,t){TimerPlugin.setTimeout(e,1e3/60)}}(),TimerPlugin.requestInterval=function(e,t){function n(){var i=TimerPlugin.getTimeMilliseconds(),o=i-a;o>=t&&(e.call(),a=TimerPlugin.getTimeMilliseconds()),r.value=TimerPlugin.requestAnimFrame(n)}if(!(TimerPlugin.requestAnimationFrame||TimerPlugin.webkitRequestAnimationFrame||TimerPlugin.mozRequestAnimationFrame&&TimerPlugin.mozCancelRequestAnimationFrame||TimerPlugin.oRequestAnimationFrame||TimerPlugin.msRequestAnimationFrame))return TimerPlugin.setInterval(e,t);var a=TimerPlugin.getTimeMilliseconds(),r=new Object;return r.value=TimerPlugin.requestAnimFrame(n),r},TimerPlugin.clearRequestInterval=function(e){TimerPlugin.cancelAnimationFrame?TimerPlugin.cancelAnimationFrame(e.value):TimerPlugin.webkitCancelAnimationFrame?TimerPlugin.webkitCancelAnimationFrame(e.value):TimerPlugin.webkitCancelRequestAnimationFrame?TimerPlugin.webkitCancelRequestAnimationFrame(e.value):TimerPlugin.mozCancelRequestAnimationFrame?TimerPlugin.mozCancelRequestAnimationFrame(e.value):TimerPlugin.oCancelRequestAnimationFrame?TimerPlugin.oCancelRequestAnimationFrame(e.value):TimerPlugin.msCancelRequestAnimationFrame?TimerPlugin.msCancelRequestAnimationFrame(e.value):clearInterval(e),e=null},TimerPlugin.requestTimeout=function(e,t){function n(){var i=TimerPlugin.getTimeMilliseconds(),o=i-a;o>=t?e.call():r.value=TimerPlugin.requestAnimFrame(n)}if(!(TimerPlugin.requestAnimationFrame||TimerPlugin.webkitRequestAnimationFrame||TimerPlugin.mozRequestAnimationFrame&&TimerPlugin.mozCancelRequestAnimationFrame||TimerPlugin.oRequestAnimationFrame||TimerPlugin.msRequestAnimationFrame))return TimerPlugin.setTimeout(e,t);var a=TimerPlugin.getTimeMilliseconds(),r=new Object;return r.value=TimerPlugin.requestAnimFrame(n),r},TimerPlugin.clearRequestTimeout=function(e){TimerPlugin.cancelAnimationFrame?TimerPlugin.cancelAnimationFrame(e.value):TimerPlugin.webkitCancelAnimationFrame?TimerPlugin.webkitCancelAnimationFrame(e.value):TimerPlugin.webkitCancelRequestAnimationFrame?TimerPlugin.webkitCancelRequestAnimationFrame(e.value):TimerPlugin.mozCancelRequestAnimationFrame?TimerPlugin.mozCancelRequestAnimationFrame(e.value):TimerPlugin.oCancelRequestAnimationFrame?TimerPlugin.oCancelRequestAnimationFrame(e.value):TimerPlugin.msCancelRequestAnimationFrame?TimerPlugin.msCancelRequestAnimationFrame(e.value):clearTimeout(e),e=null},TimerPlugin.getTimeMilliseconds=function(){return BABYLON.Tools.Now},BABYLON.SceneManager.IsWindows()&&"undefined"!=typeof Windows.UI.ViewManagement&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationViewBoundsMode&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow&&Windows.UI.ViewManagement.ApplicationView.getForCurrentView().setDesiredBoundsMode(Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow),"undefined"!=typeof TVJS&&"undefined"!=typeof TVJS.DirectionalNavigation&&(TVJS.DirectionalNavigation.enabled=!1),BABYLON.ToolkitPlugin.Loader=BABYLON.SceneLoader.GetPluginForExtension(".babylon"),BABYLON.SceneLoader.RegisterPlugin(new BABYLON.JsonSceneLoader),BABYLON.Tools.Log("Babylon.js toolkit plugins registered");var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(){function e(){this._defines={},this._defines={}}return e.prototype.getDefines=function(){return this._defines},e.prototype.resetDefines=function(){return this._defines={}},e.prototype.defineBoolean=function(e){this._defines[e]=!0},e.prototype.defineNumeric=function(e,t){this._defines[e]=t},e}();e.UniversalShaderDefines=t;var n=function(t){function n(e,n,a){void 0===a&&(a=!1);var r=t.call(this,e,n)||this;return r.ticking=!1,r._manager=null,r._started=!1,r._register=null,r._before=null,r._after=null,r._destroy=null,r.ticking=a,r.ticking&&r.initializeInstance(),r}return __extends(n,t),n.prototype.start=function(){},n.prototype.update=function(){},n.prototype.after=function(){},n.prototype.destroy=function(){},n.prototype.getManager=function(){return null==this._manager&&(this._manager=e.SceneManager.GetInstance()),this._manager},n.prototype.initializeInstance=function(){this._started=!1;var e=this;e._register=function(){e.registerInstance(e)},e._before=function(){e.updateInstance(e)},e._after=function(){e.afterInstance(e)},e._destroy=function(){e.destoryInstance(e)},e._register()},n.prototype.registerInstance=function(e){e.getScene().registerBeforeRender(e._before),e.getScene().registerAfterRender(e._after)},n.prototype.updateInstance=function(e){e._started?e.update():(e.start(),e._started=!0)},n.prototype.afterInstance=function(e){e._started&&e.after()},n.prototype.destoryInstance=function(e){e.getScene().unregisterBeforeRender(e._before),e.getScene().unregisterAfterRender(e._after),e.destroy(),e._started=!1,e._register=null,e._before=null,e._after=null,e._destroy=null},n.prototype.dispose=function(e,n){this._destroy(),t.prototype.dispose.call(this,e,n)},n}(e.PushMaterial);e.UniversalPushMaterial=n;var a=function(t){function n(n,a,r){void 0===r&&(r=!1);var i=t.call(this,n,a)||this;return i.tick=!0,i.ticking=!1,i.program="default",i._locals=null,i._uniforms=[],i._samplers=[],i._textures={},i._textureArrays={},i._floats={},i._floatsArrays={},i._colors3={},i._colors4={},i._vectors2={},i._vectors3={},i._vectors4={},i._matrices={},i._matrices3x3={},i._matrices2x2={},i._vectors3Arrays={},i._manager=null,i._started=!1,i._register=null,i._before=null,i._after=null,i._destroy=null,i._locals=new e.UniversalShaderDefines,i.customShaderNameResolve=i._buildCustomShader,i.ticking=r,i.ticking&&i.initializeInstance(),i}return __extends(n,t),n.prototype.start=function(){},n.prototype.update=function(){},n.prototype.define=function(e){},n.prototype.after=function(){},n.prototype.destroy=function(){},Object.defineProperty(n.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"textureArray",{get:function(){return this._textureArrays},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"floats",{get:function(){return this._floats},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"floatsArrays",{get:function(){return this._floatsArrays},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colors3",{get:function(){return this._colors3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colors4",{get:function(){return this._colors4},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors2",{get:function(){return this._vectors2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors3",{get:function(){return this._vectors3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors4",{get:function(){return this._vectors4},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"matrices",{get:function(){return this._matrices},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"matrices3x3",{get:function(){return this._matrices3x3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"matrices2x2",{get:function(){return this._matrices2x2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vectors3Arrays",{get:function(){return this._vectors3Arrays},enumerable:!0,configurable:!0}),n.prototype.setTexture=function(e,t){return this._checkSampler(e),this._textures[e]=t,this},n.prototype.setTextureArray=function(e,t){return this._samplers.indexOf(e)===-1&&this._samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this},n.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},n.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},n.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},n.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},n.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},n.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},n.prototype.setVector4=function(e,t){return this._checkUniform(e),this._vectors4[e]=t,this},n.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},n.prototype.setMatrix3x3=function(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this},n.prototype.setMatrix2x2=function(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this},n.prototype.setArray3=function(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this},n.prototype.isReadyForSubMesh=function(e,n,a){this._locals.resetDefines(),this.define(this._locals);var r=!1,i=this.getScene();if(i.texturesEnabled){var o,s=!0;for(o in this._textures){var l=this._textures[o];l&&l.isReadyOrNotBlocking()?(r=!0,this._locals.defineBoolean(o+"Def"),this._checkUniform(o+"Infos"),this._checkUniform(o+"Scale"),this._checkUniform(o+"Matrix")):s=!1}if(!s)return!1;s=!0;for(o in this._textureArrays){this._locals.defineBoolean(o+"Def");for(var u=this._textureArrays[o],c=0;c<u.length;c++){var p=u[c];p&&p.isReadyOrNotBlocking()?r=!0:s=!1}}if(!s)return!1}return t.prototype.isReadyForSubMesh.call(this,e,n,a)},n.prototype.getAnimatables=function(){var e,n=t.prototype.getAnimatables.call(this);for(e in this._textures){var a=this._textures[e];a&&n.push(a)}for(e in this._textureArrays)for(var r=this._textureArrays[e],i=0;i<r.length;i++){var a=r[i];a&&n.push(a)}return n},n.prototype.getActiveTextures=function(){var e,n=t.prototype.getActiveTextures.call(this);for(e in this._textures){var a=this._textures[e];a&&n.push(a)}for(e in this._textureArrays)for(var r=this._textureArrays[e],i=0;i<r.length;i++){var a=r[i];a&&n.push(a)}return n},n.prototype.hasTexture=function(e){if(t.prototype.hasTexture.call(this,e))return!0;var n,a=!1;for(n in this._textures){var r=this._textures[n];if(r&&r===e){a=!0;break}}if(a===!1)for(n in this._textureArrays){for(var i=this._textureArrays[n],o=0;o<i.length;o++){var s=i[o];if(s&&s===e){a=!0;break}}if(a===!0)break}return a},n.prototype.clone=function(t){var n=this,a=e.SerializationHelper.Clone(function(){return new e.UniversalShaderMaterial(t,n.getScene())},this);return e.UniversalShaderMaterial.CloneCustomProperties(this,a),a},n.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.UniversalShaderMaterial",e.UniversalShaderMaterial.SerializeCustomProperties(this,t),t},n.Parse=function(t,n,a){var r=e.SerializationHelper.Parse(function(){return new e.UniversalShaderMaterial(t.name,n)},t,n,a);return e.UniversalShaderMaterial.ParseCustomProperties(r,t,n,a),r},n.CloneCustomProperties=function(e,t){if(null!=e&&null!=t){var n;t._textures={};for(n in e._textures){var a=e._textures[n];a&&t.setTexture(n,a.clone())}t._textureArrays={};for(n in e._textureArrays){t._textureArrays[n]=[];for(var r=e._textureArrays[n],i=new Array,o=0;o<r.length;o++)i.push(r[o].clone());t.setTextureArray(n,i)}t._floats={};for(n in e._floats)t.setFloat(n,e._floats[n]);t._floatsArrays={};for(n in e._floatsArrays)t.setFloats(n,e._floatsArrays[n]);t._colors3={};for(n in e._colors3)t.setColor3(n,e._colors3[n].clone());t._colors4={};for(n in e._colors4)t.setColor4(n,e._colors4[n].clone());t._vectors2={};for(n in e._vectors2)t.setVector2(n,e._vectors2[n].clone());t._vectors3={};for(n in e._vectors3)t.setVector3(n,e._vectors3[n].clone());t._vectors4={};for(n in e._vectors4)t.setVector4(n,e._vectors4[n].clone());t._matrices={};for(n in e._matrices)t.setMatrix(n,e._matrices[n].clone());t._matrices3x3={};for(n in e._matrices3x3)t.setMatrix3x3(n,e._matrices3x3[n]);t._matrices2x2={};for(n in e._matrices2x2)t.setMatrix2x2(n,e._matrices2x2[n]);t._vectors3Arrays={};for(n in e._vectors3Arrays)t.setArray3(n,e._vectors3Arrays[n])}},n.SerializeCustomProperties=function(e,t){if(null!=t&&null!=e){var n;t.textures={};for(n in e._textures){var a=e._textures[n];a&&(t.textures[n]=a.serialize())}t.textureArrays={};for(n in e._textureArrays){t.textureArrays[n]=[];for(var r=e._textureArrays[n],i=0;i<r.length;i++)t.textureArrays[n].push(r[i].serialize())}t.floats={};for(n in e._floats)t.floats[n]=e._floats[n];t.floatsArrays={};for(n in e._floatsArrays)t.floatsArrays[n]=e._floatsArrays[n];t.colors3={};for(n in e._colors3)t.colors3[n]=e._colors3[n].asArray();t.colors4={};for(n in e._colors4)t.colors4[n]=e._colors4[n].asArray();t.vectors2={};for(n in e._vectors2)t.vectors2[n]=e._vectors2[n].asArray();t.vectors3={};for(n in e._vectors3)t.vectors3[n]=e._vectors3[n].asArray();t.vectors4={};for(n in e._vectors4)t.vectors4[n]=e._vectors4[n].asArray();t.matrices={};for(n in e._matrices)t.matrices[n]=e._matrices[n].asArray();t.matrices3x3={};for(n in e._matrices3x3)t.matrices3x3[n]=e._matrices3x3[n];t.matrices2x2={};for(n in e._matrices2x2)t.matrices2x2[n]=e._matrices2x2[n];t.vectors3Arrays={};for(n in e._vectors3Arrays)t.vectors3Arrays[n]=e._vectors3Arrays[n]}},n.ParseCustomProperties=function(t,n,a,r){if(null!=n&&null!=t){var i;for(i in n.textures){var o=n.textures[i];o&&t.setTexture(i,e.Texture.Parse(o,a,r))}for(i in n.textureArrays){for(var s=n.textureArrays[i],l=new Array,u=0;u<s.length;u++)l.push(e.Texture.Parse(s[u],a,r));t.setTextureArray(i,l)}for(i in n.floats)t.setFloat(i,n.floats[i]);for(i in n.floatsArrays)t.setFloats(i,n.floatsArrays[i]);for(i in n.colors3)t.setColor3(i,e.Color3.FromArray(n.colors3[i]));for(i in n.colors4)t.setColor4(i,e.Color4.FromArray(n.colors4[i]));for(i in n.vectors2)t.setVector2(i,e.Vector2.FromArray(n.vectors2[i]));for(i in n.vectors3)t.setVector3(i,e.Vector3.FromArray(n.vectors3[i]));for(i in n.vectors4)t.setVector4(i,e.Vector4.FromArray(n.vectors4[i]));for(i in n.matrices)t.setMatrix(i,e.Matrix.FromArray(n.matrices[i]));for(i in n.matrices3x3)t.setMatrix3x3(i,n.matrices3x3[i]);for(i in n.matrices2x2)t.setMatrix2x2(i,n.matrices2x2[i]);for(i in n.vectors3Arrays)t.setArray3(i,n.vectors3Arrays[i])}},n.prototype.getManager=function(){return null==this._manager&&(this._manager=e.SceneManager.GetInstance()),this._manager},n.prototype._checkUniform=function(e){this._uniforms.indexOf(e)===-1&&this._uniforms.push(e)},n.prototype._checkSampler=function(e){this._samplers.indexOf(e)===-1&&this._samplers.push(e)},n.prototype._buildCustomShader=function(e,t,n,a,r){var i=this;null!=this.program&&""!==this.program||(this.program="default");var o=this._locals.getDefines();if(null!=o){var s=Object.keys(o);if(null!=s&&s.length>0){for(var l=r,u=0,c=s;u<c.length;u++){var p=c[u];l[p]=o[p]}r.rebuild()}}var d=0;if(null!=this._uniforms&&this._uniforms.length>0)for(d=0;d<this._uniforms.length;d++)t.push(this._uniforms[d]);if(d=0,null!=this._samplers&&this._samplers.length>0)for(d=0;d<this._samplers.length;d++)a.push(this._samplers[d]);var m=this._afterBind;return this._afterBind=function(e,t){if(i._attachAfterBind(e,t),m)try{m(e,t)}catch(n){}},this.program},n.prototype._attachAfterBind=function(e,t){var n,a=this.getScene();if(a.texturesEnabled)for(n in this._textures){var r=this._textures[n];r&&(t.setTexture(n,r),t.setFloat2(n+"Infos",r.coordinatesIndex,r.level),t.setFloat2(n+"Scale",r.uScale,r.vScale),t.setMatrix(n+"Matrix",r.getTextureMatrix()))}if(a.texturesEnabled)for(n in this._textureArrays)t.setTextureArray(n,this._textureArrays[n]);for(n in this._floats)t.setFloat(n,this._floats[n]);for(n in this._floatsArrays)t.setArray(n,this._floatsArrays[n]);for(n in this._colors3)t.setColor3(n,this._colors3[n]);for(n in this._colors4){var i=this._colors4[n];t.setFloat4(n,i.r,i.g,i.b,i.a)}for(n in this._vectors2)t.setVector2(n,this._vectors2[n]);for(n in this._vectors3)t.setVector3(n,this._vectors3[n]);for(n in this._vectors4)t.setVector4(n,this._vectors4[n]);for(n in this._matrices)t.setMatrix(n,this._matrices[n]);for(n in this._matrices3x3)t.setMatrix3x3(n,this._matrices3x3[n]);for(n in this._matrices2x2)t.setMatrix2x2(n,this._matrices2x2[n]);for(n in this._vectors3Arrays)t.setArray3(n,this._vectors3Arrays[n])},n.prototype.initializeInstance=function(){this._started=!1;var e=this;e._register=function(){e.registerInstance(e)},e._before=function(){e.updateInstance(e)},e._after=function(){e.afterInstance(e)},e._destroy=function(){e.destoryInstance(e)},e._register()},n.prototype.registerInstance=function(e){e.getScene().registerBeforeRender(e._before),e.getScene().registerAfterRender(e._after)},n.prototype.updateInstance=function(e){e._started?e.update():(e.start(),e._started=!0)},n.prototype.afterInstance=function(e){e._started&&e.after()},n.prototype.destoryInstance=function(e){e.getScene().unregisterBeforeRender(e._before),e.getScene().unregisterAfterRender(e._after),e.destroy(),e._started=!1,e._register=null,e._before=null,e._after=null,e._destroy=null},n.prototype.dispose=function(e,n){if(n){var a;for(a in this._textures){var r=this._textures[a];r&&r.dispose(),this._textures[a]=null}for(a in this._textureArrays)for(var i=this._textureArrays[a],o=0;o<i.length;o++)i[o].dispose()}this._textures={},this._destroy(),t.prototype.dispose.call(this,e,n)},n}(e.StandardMaterial);e.UniversalShaderMaterial=a;var r=function(t){function n(e,n,a){void 0===a&&(a=!0);var r=t.call(this,e,n,a)||this;r._totalTexturesLoaded=0,r._maxTexturesImageUnits=0,r.program="splatmap";var i=n.getEngine(),o=i.getCaps();return r._totalTexturesLoaded=0,r._maxTexturesImageUnits=o.maxTexturesImageUnits,r}return __extends(n,t),Object.defineProperty(n.prototype,"totalTexturesLoaded",{get:function(){return this._totalTexturesLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxTexturesImageUnits",{get:function(){return this._maxTexturesImageUnits},enumerable:!0,configurable:!0}),n.prototype.start=function(){var t=this;this._totalTexturesLoaded=0,this.diffuseTexture&&this._totalTexturesLoaded++,this.bumpTexture&&this._totalTexturesLoaded++,this.lightmapTexture&&this._totalTexturesLoaded++,this.reflectionTexture&&this._totalTexturesLoaded++,this.emissiveTexture&&this._totalTexturesLoaded++,this.specularTexture&&this._totalTexturesLoaded++,this.ambientTexture&&this._totalTexturesLoaded++,this.opacityTexture&&this._totalTexturesLoaded++,this.refractionTexture&&this._totalTexturesLoaded++,this.cameraColorGradingTexture&&this._totalTexturesLoaded++;var n;for(n in this.textures){var a=this.textures[n];a&&this._totalTexturesLoaded++}for(n in this.textureArray){var r=this.textureArray[n];r&&r.forEach(function(e){e&&t._totalTexturesLoaded++})}this.totalTexturesLoaded>this.maxTexturesImageUnits&&e.Tools.Warn("Babylon.js max terrain texture units exceeded ("+this.totalTexturesLoaded.toString()+" of "+this.maxTexturesImageUnits.toString()+")")},n.prototype.define=function(e){e.defineNumeric("TOTAL_TEXTURES_LOADED",this.totalTexturesLoaded),e.defineNumeric("MAX_TEXTURE_IMAGE_UNITS",this.maxTexturesImageUnits),this.totalTexturesLoaded<=this.maxTexturesImageUnits&&e.defineBoolean("SPLATMAPS_ENABLED")},n.prototype.clone=function(t){var n=this,a=e.SerializationHelper.Clone(function(){return new e.UniversalTerrainMaterial(t,n.getScene())},this);return e.UniversalShaderMaterial.CloneCustomProperties(this,a),a},n.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.UniversalTerrainMaterial",e.UniversalShaderMaterial.SerializeCustomProperties(this,t),t},n.Parse=function(t,n,a){var r=e.SerializationHelper.Parse(function(){return new e.UniversalTerrainMaterial(t.name,n)},t,n,a);return e.UniversalShaderMaterial.ParseCustomProperties(r,t,n,a),r},n}(e.UniversalShaderMaterial);e.UniversalTerrainMaterial=r}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(t){function n(a,r,i,o,s,l,u,c,p){void 0===o&&(o=0),void 0===s&&(s=n.EMISSION_RATE),void 0===l&&(l=.01),void 0===u&&(u=null),void 0===c&&(c=null),void 0===p&&(p=null);var d=t.call(this,a,r,i,p)||this;return d.emitType=n.EMISSION_RATE,d.loopPlay=!1,d.delayTime=0,d._duration=0,d._startSpeed=-1,d._enableTime=!1,d._cycleHandler=null,d._emissionBurst=null,d._updateModules=null,d._duration=o,d._startSpeed=l,d._emissionBurst=u,d._updateModules=null!=c?c:new e.ShurikenUpdateModules,d.delayTime=0,d.loopPlay=!1,d.emitType=s,d.updateSpeed=l,d.disposeOnStop=!1,d.preventAutoStart=!0,d.targetStopDuration=0,d.updateFunction=d.defaultUpdateOverTimeFunctionHandler,d.startPositionFunction=d.defaultStartPositionFunctionHandler,d.startDirectionFunction=d.defaultStartDirectionFunctionHandler,d.manualEmitCount=d.emitType===n.EMISSION_BURST?0:-1,d}return __extends(n,t),Object.defineProperty(n,"EMISSION_RATE",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(n,"EMISSION_BURST",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"modules",{get:function(){return this._updateModules},enumerable:!0,configurable:!0}),n.prototype.start=function(){var e=this;if(this.internalStop(!1),this.updateSpeed=this._startSpeed,this.disposeOnStop=!1,this.preventAutoStart=!0,this.targetStopDuration=0,this.emitType===n.EMISSION_BURST?null!=this._emissionBurst&&this._emissionBurst.length>0&&this._emissionBurst.forEach(function(t){e.internalPlay(e.delayTime+t.time,t.minCount,t.maxCount)}):this.internalPlay(this.delayTime),
this._duration>0){var t=this.delayTime+this._duration;if(null!=this._updateModules&&this._updateModules.updateOverTime===!0&&null!=this.animations&&this.animations.length>0){var a=t*this._updateModules.framesPerSecond;this._cycleHandler=this.internalScene.beginAnimation(this,0,a,!1,1)}window.setTimeout(function(){e.internalCycle()},1e3*t)}},n.prototype.stop=function(){this.internalStop(!0)},n.prototype.dispose=function(){this.internalStop(!0),this._emissionBurst=null,this._updateModules=null,this.updateFunction=null,this.startPositionFunction=null,this.startDirectionFunction=null,t.prototype.dispose.call(this)},Object.defineProperty(n.prototype,"internalScene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),n.prototype.internalPlay=function(e,t,n){var a=this;void 0===e&&(e=0),void 0===t&&(t=-1),void 0===n&&(n=-1),e>0?window.setTimeout(function(){a.internalStart(t,n)},1e3*e):this.internalStart(t,n)},n.prototype.internalCycle=function(){this.stop(),this.loopPlay===!0&&this.start()},n.prototype.internalStart=function(a,r){var i=this.emitType===n.EMISSION_BURST?0:-1;this.emitType===n.EMISSION_BURST&&a>=1&&r>=1&&(i=e.Scalar.RandomRange(a,r)),this.manualEmitCount=i,t.prototype.start.call(this)},n.prototype.internalStop=function(e){if(void 0===e&&(e=!1),null!=this._cycleHandler&&(this._cycleHandler.stop(),this._cycleHandler=null),e===!1){var n=this;null!=n&&n._started&&!n._stopped&&t.prototype.stop.call(this)}else t.prototype.stop.call(this)},n.prototype.getParticles=function(){return this.particles},Object.defineProperty(n.prototype,"stockParticles",{get:function(){return this._stockParticles},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaledUpdateSpeed",{get:function(){return this._scaledUpdateSpeed},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaledDirection",{get:function(){return this._scaledDirection},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaledColorStep",{get:function(){return this._scaledColorStep},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaledGravity",{get:function(){return this._scaledGravity},enumerable:!0,configurable:!0}),n.prototype.defaultStartDirectionFunctionHandler=function(t,n,a,r){null!=this._updateModules;var i=e.Scalar.RandomRange(this.direction1.x,this.direction2.x),o=e.Scalar.RandomRange(this.direction1.y,this.direction2.y),s=e.Scalar.RandomRange(this.direction1.z,this.direction2.z);e.Vector3.TransformNormalFromFloatsToRef(i*t,o*t,s*t,n,a)},n.prototype.defaultStartPositionFunctionHandler=function(t,n,a){null!=this._updateModules;var r=e.Scalar.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),i=e.Scalar.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),o=e.Scalar.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);e.Vector3.TransformCoordinatesFromFloatsToRef(r,i,o,t,n)},n.prototype.defaultUpdateOverTimeFunctionHandler=function(e){null!=this._updateModules;for(var t=0;t<e.length;t++){var n=e[t];n.age+=this.scaledUpdateSpeed,n.age>=n.lifeTime?(this.recycleParticle(n),t--):(n.colorStep.scaleToRef(this.scaledUpdateSpeed,this.scaledColorStep),n.color.addInPlace(this.scaledColorStep),n.color.a<0&&(n.color.a=0),n.angle+=n.angularSpeed*this.scaledUpdateSpeed,n.direction.scaleToRef(this.scaledUpdateSpeed,this.scaledDirection),n.position.addInPlace(this.scaledDirection),this.gravity.scaleToRef(this.scaledUpdateSpeed,this.scaledGravity),n.direction.addInPlace(this.scaledGravity))}},n}(e.ParticleSystem);e.ShurikenParticleSystem=t;var n=function(){function e(){this.updateOverTime=!1,this.framesPerSecond=30,this.speedModule=null,this.emissionModule=null,this.velocityModule=null,this.colorModule=null,this.sizingModule=null,this.rotationModule=null,this.updateEffectTime=!1,this.maximumEffectTime=0}return e}();e.ShurikenUpdateModules=n}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(t){function n(n,a,r,i){void 0===r&&(r=!0),void 0===i&&(i={});var o=t.call(this,n,a,r,i)||this;if(o._fps=30,o._targets=null,o._machine=null,o._enabled=!1,o._skeletal=!1,o._autoplay=!1,o._executed=!1,o._checkers=new e.TransitionCheck,o._boneAnim=null,o._boneWeight=0,o._boneMatrix=e.Matrix.Zero(),o._sampleMatrix=e.Matrix.Zero(),o._onAnimationFrameHandler=null,o._onAnimationEventHandlers=null,o._onAnimationBehaveHandlers=null,o.speedRatio=1,o.autoTicking=!0,o.directBlendSpeed=1,o._targets=null,o._machine=null,o._executed=!1,o._onAnimationFrameHandler=null,o._onAnimationEventHandlers={},o._onAnimationBehaveHandlers={},o._fps=o.getProperty("timelineStep",30),o._enabled=o.getProperty("enableStateMachine",!1),o._autoplay=o.getProperty("automaticPlay",!1),o._skeletal=2===o.getProperty("controlType",0),o.directBlendSpeed=1,o.speedRatio=1,null!=o.owned.metadata&&(o.owned.metadata.state={},o.owned.metadata.state.data={},o.owned.metadata.state.clips={},o.owned.metadata.state.floats={},o.owned.metadata.state.booleans={},o.owned.metadata.state.triggers={},o.owned.metadata.state.parameters={},null!=o.owned.metadata.properties&&null!=o.owned.metadata.properties.stateMachineInfo&&(o._machine=o.owned.metadata.properties.stateMachineInfo,null!=o._machine&&(null!=o._machine.speed&&(o.speedRatio=o._machine.speed),null!=o._machine.parameters&&o._machine.parameters.length>0)))){var s=o._machine.parameters;s.forEach(function(t){var n=t.name,a=t.type,r=(t.curve,t.defaultFloat),i=t.defaultBool,s=t.defaultInt;o.owned.metadata.state.parameters[n]=a,a===e.AnimatorParameterType.Bool?o.setBool(n,i):a===e.AnimatorParameterType.Float?o.setFloat(n,r):a===e.AnimatorParameterType.Int?o.setInteger(n,s):a===e.AnimatorParameterType.Trigger&&o.resetTrigger(n)})}null!=o._machine.layers&&o._machine.layers.length>0&&(o._machine.layers.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),o._machine.layers.forEach(function(t){t.animationNormalize=e.AnimationState.TIMER,t.animationReference=e.AnimationState.TIMER*o._fps,t.animationBlendMatrix=e.Matrix.Zero()}));if(o._targets=o.manager.getAnimationTargets(o.owned),o._skeletal===!0){var l=o.getTargetSkeletons();null!=l&&l.length>0&&l.forEach(function(e){var t=e;if(null==t.metadata&&(t.metadata={}),t.metadata.resetBlending=!1,null!=e.bones&&e.bones.length>0){var n=0;e.bones.forEach(function(e){null==e.metadata&&(e.metadata={}),e.metadata.index=n,e.metadata.blendingFactor=0,e.metadata.originalBlendValue=null,null!=e.metadata.transformPath&&""!==e.metadata.transformPath&&null!=o._machine.layers&&o._machine.layers.length>0&&o._machine.layers.forEach(function(t){null!=t.avatarMask&&null!=t.avatarMask.transformPaths&&t.avatarMask.transformPaths.length>0&&o.checkBoneTransformPath(t,e.metadata.transformPath)&&(null==t.avatarMask.transformIndexs&&(t.avatarMask.transformIndexs=[]),t.avatarMask.transformIndexs.push(n))}),n++})}})}return o}return __extends(n,t),Object.defineProperty(n.prototype,"fps",{get:function(){return this._fps},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"skeletal",{get:function(){return this._skeletal},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"executing",{get:function(){return this._executed},enumerable:!0,configurable:!0}),n.prototype.ready=function(){this.setupStateMachine()},n.prototype.start=function(){this.startStateMachine()},n.prototype.update=function(){this.autoTicking===!0&&this.updateStateMachine()},n.prototype.destroy=function(){this._targets=null,this._machine=null,this._checkers=null,this._boneAnim=null,this._boneWeight=0,this._boneMatrix=null,this._onAnimationFrameHandler=null,this._onAnimationEventHandlers=null,this._onAnimationBehaveHandlers=null,null!=this.owned.metadata&&null!=this.owned.metadata.state&&(this.owned.metadata.state=null)},n.prototype.play=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),null!=this._machine.layers&&this._machine.layers.length>n&&this.setCurrentAnimationState(this._machine.layers[n],e,t)},n.prototype.getBool=function(e){var t=!1;return null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.booleans&&null!=this.owned.metadata.state.booleans[e]&&(t=this.owned.metadata.state.booleans[e]),t},n.prototype.setBool=function(e,t){null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.booleans&&(this.owned.metadata.state.booleans[e]=t)},n.prototype.getFloat=function(e){var t=0;return null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.floats&&null!=this.owned.metadata.state.floats[e]&&(t=this.owned.metadata.state.floats[e]),t},n.prototype.setFloat=function(e,t){null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.floats&&(this.owned.metadata.state.floats[e]=t)},n.prototype.getInteger=function(e){var t=0;return null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.floats&&null!=this.owned.metadata.state.floats[e]&&(t=this.owned.metadata.state.floats[e]),t},n.prototype.setInteger=function(e,t){null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.floats&&(this.owned.metadata.state.floats[e]=t)},n.prototype.getTrigger=function(e){var t=!1;return null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.triggers&&null!=this.owned.metadata.state.triggers[e]&&(t=this.owned.metadata.state.triggers[e]),t},n.prototype.setTrigger=function(e){null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.triggers&&(this.owned.metadata.state.triggers[e]=!0)},n.prototype.resetTrigger=function(e){null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.triggers&&(this.owned.metadata.state.triggers[e]=!1)},n.prototype.tickStateMachine=function(){this.autoTicking===!1?this.updateStateMachine():e.Tools.Warn("Manual tick request ignored. Auto ticking is enabled for animator: "+this.owned.name)},n.prototype.getCurrentState=function(e){return null!=this._machine.layers&&this._machine.layers.length>e?this._machine.layers[e].animationStateMachine:null},n.prototype.getTargetSkeletons=function(){var t=null;return this._skeletal===!0&&null!=this._targets&&this._targets.length>0&&this._targets.forEach(function(n){if(n instanceof e.AbstractMesh){var a=n;null!=a.skeleton&&(null==t&&(t=[]),t.push(a.skeleton))}}),t},n.prototype.onAnimationFrame=function(e){this._onAnimationFrameHandler=e},n.prototype.onAnimationEvent=function(e,t){null!=e&&""!==e&&(this._onAnimationEventHandlers[e.toLowerCase()]=t)},n.prototype.onAnimationBehaviour=function(e,t){null!=e&&""!==e&&(this._onAnimationBehaveHandlers[e.toLowerCase()]=t)},n.prototype.getMachineState=function(e){var t=null;return null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.data&&null!=this.owned.metadata.state.data[e]&&(t=this.owned.metadata.state.data[e]),t},n.prototype.setMachineState=function(e,t){null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.data&&(this.owned.metadata.state.data[e]=t)},n.prototype.getAnimationClip=function(e){var t=null;return null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.clips&&null!=this.owned.metadata.state.clips[e]&&(t=this.owned.metadata.state.clips[e]),t},n.prototype.setAnimationClip=function(e,t){null!=this.owned.metadata&&null!=this.owned.metadata.state&&null!=this.owned.metadata.state.clips&&(this.owned.metadata.state.clips[e]=t)},n.prototype.getDenormalizedFrame=function(e,t){return null==e?0:e.start+(e.stop-e.start)*t},n.prototype.getAnimationFrames=function(e){return null==e?0:e.stop-e.start+1},n.prototype.setTreeBranches=function(t){var n=this;null!=t&&null!=t.children&&t.children.length>0&&t.children.forEach(function(t){t.type===e.MotionType.Tree?n.setTreeBranches(t.subtree):t.type===e.MotionType.Clip&&null!=t.motion&&""!==t.motion&&(t.track=n.getAnimationClip(t.motion))})},n.prototype.blendBoneMatrix=function(t,n){if(void 0===n&&(n=1),null!=t&&n>0&&null!=this._boneMatrix){var a=e.Scalar.Clamp(n,0,1);0===this._boneWeight?this._boneMatrix.copyFrom(t):e.Utilities.FastMatrixSlerp(this._boneMatrix,t,a,this._boneMatrix),this._boneWeight+=a}},n.prototype.updateBoneMatrix=function(t,n,a){void 0===n&&(n=!1),void 0===a&&(a=0),null!=this._boneMatrix&&null!=t&&(n===!0&&a>0&&null!=t.metadata&&(t.metadata.blendingFactor<=1&&null==t.metadata.originalBlendValue&&(t.metadata.originalBlendValue=t._matrix.clone()),t.metadata.blendingFactor<=1&&null!=t.metadata.originalBlendValue&&(e.Utilities.FastMatrixSlerp(t.metadata.originalBlendValue,this._boneMatrix,t.metadata.blendingFactor,this._boneMatrix),t.metadata.blendingFactor+=a)),t._matrix.copyFrom(this._boneMatrix),t.markAsDirty())},n.prototype.setupStateMachine=function(){var e=this,t=this.manager.getAnimationClips(this.owned);null!=t&&t.length>0&&t.forEach(function(t){null!=t&&null!=t.name&&e.setAnimationClip(t.name,t)}),null!=this._machine&&null!=this._machine.states&&this._machine.states.length>0&&this._machine.states.forEach(function(t){null!=t&&null!=t.name&&(e.setTreeBranches(t.blendtree),e.setMachineState(t.name,t))})},n.prototype.startStateMachine=function(){var e=this;this._executed===!1&&(this._executed=!0,this._enabled===!0?this._autoplay===!0&&null!=this._machine.layers&&this._machine.layers.length>0&&(1==this._skeletal?this._machine.layers.forEach(function(t){e.setCurrentAnimationState(t,t.entry,0)}):this.setCurrentAnimationState(this._machine.layers[0],this._machine.layers[0].entry,0)):this._autoplay===!0&&this.manager.playAnimationClip(null,this.owned))},n.prototype.updateStateMachine=function(){var e=this;this.updateAnimationCurves(),null!=this._machine.layers&&this._machine.layers.length>0&&(1==this._skeletal?this._machine.layers.forEach(function(t){null!=t&&e.processStateMachine(t)}):null!=this._machine.layers[0]&&this.processStateMachine(this._machine.layers[0])),this.updateAnimationSkeletons(),null!=this._onAnimationFrameHandler&&this._onAnimationFrameHandler()},n.prototype.updateAnimationCurves=function(){},n.prototype.updateAnimationSkeletons=function(){var t=this;this._skeletal===!0&&null!=this._targets&&this._targets.length>0&&this._targets.forEach(function(n){if(null!=n&&n instanceof e.AbstractMesh){var a=n;if(null!=a&&null!=a.skeleton&&null!=a.skeleton.bones&&a.skeleton.bones.length>0){var r=a.skeleton,i=null!=r.metadata&&r.metadata.resetBlending;a.skeleton.bones.forEach(function(n){if(t._boneAnim=null,t._boneWeight=0,t._boneMatrix.reset(),i===!0&&(null==n.metadata&&(n.metadata={}),n.metadata.blendingFactor=0,n.metadata.originalBlendValue=null),null!=n.animations&&n.animations.length>0){for(var r=0;r<n.animations.length;r++){var o=n.animations[r];if("skeleton:"===o.name.substr(0,9)&&o.dataType===e.Animation.ANIMATIONTYPE_MATRIX){t._boneAnim=o;break}}if(null!=t._boneAnim){var s=a.skeleton.animationPropertiesOverride?a.skeleton.animationPropertiesOverride.blendingSpeed:t._boneAnim.blendingSpeed;null!=t._machine.layers&&t._machine.layers.length>0&&t._machine.layers.forEach(function(a){a.animationBlendWeight=0,a.animationBlendMatrix.reset(),(0===a.index||a.defaultWeight>0)&&(0===a.index||null==a.avatarMask||null==a.avatarMask.transformIndexs||t.filterBoneTransformIndex(a,n))&&(a.animationStateMachine.type===e.MotionType.Tree||a.animationStateMachine.type===e.MotionType.Clip&&a.animationBlendFrame>=0&&(a.animationBlendFirst||a.animationBlendLoop<2))&&null!=a.animationBlendBuffer&&a.animationBlendBuffer.length>0&&a.animationBlendBuffer.forEach(function(n){null!=n.track&&(t._sampleMatrix.reset(),e.Utilities.SampleAnimationMatrix(t._boneAnim,n.frame,e.Scalar.Clamp(n.track.behavior,0,1),t._sampleMatrix),n.mirror===!0,t.blendAnimationMatrix(a,t._sampleMatrix,n.weight))}),a.animationBlendWeight>0&&(a.animationBlendSpeed>s&&(s=a.animationBlendSpeed),t.blendBoneMatrix(a.animationBlendMatrix,0===a.index?1:a.defaultWeight))}),t._boneWeight>0&&t.updateBoneMatrix(n,s>0,s)}}}),null==r.metadata&&(r.metadata={}),r.metadata.resetBlending=!1}}})},n.prototype.processStateMachine=function(t){var n=this;t.animationTime+=this.manager.deltaTime*(t.animationRatio*this.speedRatio),t.animationTime>t.animationNormalize&&(t.animationTime=0),t.animationFrame=e.Scalar.Normalize(t.animationTime,0,t.animationNormalize),t.animationBlendLoop=-1,t.animationBlendFrame=-1,t.animationBlendFirst=!1,t.animationBlendBuffer=null,this._checkers.result=null,this._checkers.offest=0,this._checkers.blending=0,this._checkers.triggered=[],null!=t.animationStateMachine&&(this.checkStateTransitions(t,t.animationStateMachine.transitions,t.animationStateMachine.time,t.animationStateMachine.length,t.animationStateMachine.rate),null==this._checkers.result&&null!=this._machine.transitions&&this.checkStateTransitions(t,this._machine.transitions,t.animationStateMachine.time,t.animationStateMachine.length,t.animationStateMachine.rate)),null!=this._checkers.triggered&&this._checkers.triggered.length>0&&(this._checkers.triggered.forEach(function(e){n.resetTrigger(e)}),this._checkers.triggered=null),null!=this._checkers.result&&(this._checkers.offest>0?this.manager.delay(function(){n.setCurrentAnimationState(t,n._checkers.result,n._checkers.blending)},1e3*this._checkers.offest):this.setCurrentAnimationState(t,this._checkers.result,this._checkers.blending)),this.parseSkeletalAnimationTrackLayer(t)},n.prototype.setCurrentAnimationState=function(t,n,a){if(null!=n&&""!==n&&n!==e.AnimationState.EXIT&&(null==t.animationStateMachine||t.animationStateMachine.name!==n)){var r=this.getMachineState(n);null!=r&&r.layerIndex===t.index&&(r.time=0,r.played=0,r.interrupted=!1,t.animationTime=0,t.animationFrame=0,t.animationRatio=1,t.animationAnimatables=null,t.animationBlendLoop=-1,t.animationBlendFrame=-1,t.animationBlendFirst=!1,t.animationBlendSpeed=a,t.animationBlendWeight=0,t.animationBlendBuffer=null,t.animationStateMachine=r,t.animationStateMachine.time=this.manager.time,t.animationAnimatables=this.setupBaseAnimationState(t,a,t.animationStateMachine.speed))}},n.prototype.setupBaseAnimationState=function(e,t,n){var a=this;void 0===t&&(t=0),void 0===n&&(n=1);var r=null;return 0===e.index&&null!=this._targets&&this._targets.length>0&&this._targets.forEach(function(i){if(null!=i)if(a._skeletal===!0)null!=i.skeleton&&(null==i.skeleton.metadata&&(i.skeleton.metadata={}),i.skeleton.metadata.resetBlending=!0),a.scene.stopAnimation(i),a.manager.setAnimationProperties(i,1,t);else{a.scene.stopAnimation(i);var o=e.animationStateMachine&&null!=e.animationStateMachine.blendtree&&null!=e.animationStateMachine.blendtree.children&&e.animationStateMachine.blendtree.children.length>0?e.animationStateMachine.blendtree.children[0].track:null;if(null!=o){a.manager.setAnimationProperties(i,o.behavior,t);var s=a.scene.beginAnimation(i,o.start,o.stop,o.behavior<2,n);null!=s&&(null==r&&(r=[]),r.push(s))}}}),r},n.prototype.checkStateTransitions=function(t,n,a,r,i){var o=this;if(null!=n&&n.length>0){var s=0,l=-1;for(s=0;s<n.length;s++)if(n[s].solo===!0&&n[s].mute===!1){l=s;break}for(s=0;s<n.length;s++){var u=n[s];if(u.layerIndex===t.index&&u.mute!==!0&&!(l>=0&&l!==s)){var c=!1,p=e.Scalar.Denormalize(u.exitTime,0,r),d=this.manager.time-a>=p;if(u.hasExitTime!==!0||u.intSource!=e.InterruptionSource.None||d!==!1){if(null!=u.conditions&&u.conditions.length>0){var m=0,h=u.conditions.length;u.conditions.forEach(function(t){if(null!=o.owned.metadata.state.parameters[t.parameter]){var n=o.owned.metadata.state.parameters[t.parameter];if(n==e.AnimatorParameterType.Float||n==e.AnimatorParameterType.Int){var a=parseFloat(o.getFloat(t.parameter).toFixed(2));t.mode===e.ConditionMode.Greater&&a>t.threshold?m++:t.mode===e.ConditionMode.Less&&a<t.threshold?m++:t.mode===e.ConditionMode.Equals&&a===t.threshold?m++:t.mode===e.ConditionMode.NotEqual&&a!==t.threshold&&m++}else if(n==e.AnimatorParameterType.Bool){var r=o.getBool(t.parameter);t.mode===e.ConditionMode.If&&r===!0?m++:t.mode===e.ConditionMode.IfNot&&r===!1&&m++}else if(n==e.AnimatorParameterType.Trigger){var i=o.getTrigger(t.parameter);i===!0&&(m++,o._checkers.triggered.indexOf(t.parameter)<0&&o._checkers.triggered.push(t.parameter))}}}),c=u.hasExitTime===!0?d===!0&&m===h:m===h}else c=u.hasExitTime===!0&&d===!0;if(c===!0){var g=u.isExit===!1?u.destination:e.AnimationState.EXIT,f=e.Scalar.Denormalize(u.offset,0,r),y=e.Scalar.Denormalize(u.duration,0,r),S=e.Utilities.ComputeBlendingSpeed(i,y);this._checkers.result=g,this._checkers.offest=f,this._checkers.blending=S;break}}}}}},n.prototype.computeSpeedRatio=function(t,n,a,r,i){void 0===a&&(a=null),void 0===r&&(r=1),void 0===i&&(i=1);var o=1;if(null!=n&&null!=a){var s=t.animationReference/this.getAnimationFrames(n),l=t.animationReference/this.getAnimationFrames(a);o=e.Scalar.Lerp(s,l,r)}else null!=n&&null==a?o=t.animationReference/this.getAnimationFrames(n):null!=a&&null==n&&(o=t.animationReference/this.getAnimationFrames(a));return o*i},n.prototype.blendAnimationMatrix=function(t,n,a){if(void 0===a&&(a=1),null!=n&&a>0&&null!=t.animationBlendMatrix){var r=e.Scalar.Clamp(a,0,1);0===t.animationBlendWeight?t.animationBlendMatrix.copyFrom(n):e.Utilities.FastMatrixSlerp(t.animationBlendMatrix,n,r,t.animationBlendMatrix),t.animationBlendWeight+=r}},n.prototype.checkBoneTransformPath=function(e,t){var n=!1;return null!=e.avatarMask&&null!=e.avatarMask.transformPaths&&e.avatarMask.transformPaths.length>0&&e.avatarMask.transformPaths.indexOf(t)>=0&&(n=!0),n},n.prototype.filterBoneTransformIndex=function(e,t){var n=!1;return null!=e.avatarMask&&null!=e.avatarMask.transformIndexs&&e.avatarMask.transformIndexs.length>0&&null!=t.metadata&&null!=t.metadata.index&&e.avatarMask.transformIndexs.indexOf(t.metadata.index)>=0&&(n=!0),n},n.prototype.setTreeThresholds=function(t,n){var a=this;n.directBlendMaster=null,n.simpleThresholdEqual=null,n.simpleThresholdLower=null,n.simpleThresholdUpper=null,n.simpleThresholdDelta=1,n.valueParameterX=parseFloat(this.getFloat(n.blendParameterX).toFixed(2)),n.valueParameterY=parseFloat(this.getFloat(n.blendParameterY).toFixed(2)),null!=n.children&&n.children.length>0&&(n.children.forEach(function(r){r.indexs=null!=t.avatarMask&&null!=t.avatarMask.transformIndexs&&t.avatarMask.transformIndexs.length>0?t.avatarMask.transformIndexs:null,r.weight=-1,r.frame=-1,n.blendType===e.BlendTreeType.Simple1D&&null==n.simpleThresholdEqual&&(n.valueParameterX===r.threshold?(n.simpleThresholdEqual=r,n.simpleThresholdLower=null,n.simpleThresholdUpper=null):n.valueParameterX>r.threshold?null==n.simpleThresholdLower?n.simpleThresholdLower=r:r.threshold>n.simpleThresholdLower.threshold&&(n.simpleThresholdLower=r):n.valueParameterX<r.threshold&&(null==n.simpleThresholdUpper?n.simpleThresholdUpper=r:r.threshold<n.simpleThresholdUpper.threshold&&(n.simpleThresholdUpper=r))),r.type===e.MotionType.Tree&&a.setTreeThresholds(t,r.subtree)}),n.blendType===e.BlendTreeType.Simple1D&&(null==n.simpleThresholdEqual&&(null!=n.simpleThresholdLower&&null==n.simpleThresholdUpper?(n.simpleThresholdEqual=n.simpleThresholdLower,n.simpleThresholdLower=null,n.simpleThresholdUpper=null):null!=n.simpleThresholdUpper&&null==n.simpleThresholdLower&&(n.simpleThresholdEqual=n.simpleThresholdUpper,n.simpleThresholdLower=null,n.simpleThresholdUpper=null)),null!=n.simpleThresholdLower&&null!=n.simpleThresholdUpper?n.simpleThresholdDelta=parseFloat(e.Scalar.Normalize(n.valueParameterX,n.simpleThresholdLower.threshold,n.simpleThresholdUpper.threshold).toFixed(2)):n.simpleThresholdDelta=1))},n.prototype.sortBlendBuffer=function(e){null!=e.animationBlendBuffer&&e.animationBlendBuffer.length>0&&e.animationBlendBuffer.sort(function(e,t){return e.weight<t.weight?1:e.weight>t.weight?-1:0})},n.prototype.parseTreeBranches=function(t,n,a){var r=this;null!=n&&null!=n.children&&n.children.length>0&&n.children.forEach(function(i){switch(n.blendType){case e.BlendTreeType.Clip:r.parseClipTreeItem(t,n,i,a);break;case e.BlendTreeType.Direct:r.parseDirectTreeItem(t,n,i,a);break;case e.BlendTreeType.Simple1D:r.parseSimpleTreeItem(t,n,i,a);break;case e.BlendTreeType.SimpleDirectional2D:r.parseSimpleDirectionalTreeItem(t,n,i,a);break;case e.BlendTreeType.FreeformDirectional2D:r.parseFreeformDirectionalTreeItem(t,n,i,a);break;case e.BlendTreeType.FreeformCartesian2D:r.parseFreeformCartesianTreeItem(t,n,i,a)}i.weight>0&&(null==t.animationBlendBuffer&&(t.animationBlendBuffer=[]),n.blendType===e.BlendTreeType.Simple1D?t.animationBlendBuffer.length<2?t.animationBlendBuffer.push(i):e.Tools.Warn("Babylon.js orphan simple blend tree hash encountered: "+i.hash.toString()):t.animationBlendBuffer.push(i))})},n.prototype.parseClipTreeItem=function(e,t,n,a){null!=n&&null!=t&&null!=n.track&&null!=e.animationStateMachine&&(e.animationBlendLoop=n.track.behavior,e.animationBlendFirst=e.animationStateMachine.played!==-1&&e.animationStateMachine.played<=n.track.frames,e.animationBlendFirst===!1&&e.animationStateMachine.played!==-1&&(e.animationStateMachine.played=-1),e.animationBlendFrame=this.getDenormalizedFrame(n.track,e.animationFrame),n.frame=e.animationBlendFrame,n.weight=1)},n.prototype.parseDirectTreeItem=function(t,n,a,r){null!=a&&null!=n&&(a.type===e.MotionType.Tree?this.parseTreeBranches(t,a.subtree,r):a.type===e.MotionType.Clip&&null!=a.track&&null!=t.animationStateMachine&&(a.frame=this.getDenormalizedFrame(a.track,r),a.weight=this.getFloat(a.directBlendParameter),(null==n.directBlendMaster||a.weight>n.directBlendMaster.weight)&&(n.directBlendMaster=a)))},n.prototype.parseSimpleTreeItem=function(t,n,a,r){null!=a&&null!=n&&(null!=n.simpleThresholdEqual&&a.threshold===n.simpleThresholdEqual.threshold?a.type===e.MotionType.Tree?this.parseTreeBranches(t,a.subtree,r):a.type===e.MotionType.Clip&&null!=a.track&&null!=t.animationStateMachine&&(a.frame=this.getDenormalizedFrame(a.track,r),a.weight=1):null!=n.simpleThresholdLower&&null!=n.simpleThresholdUpper&&a.threshold>=n.simpleThresholdLower.threshold&&a.threshold<=n.simpleThresholdUpper.threshold&&(a.type===e.MotionType.Tree?this.parseTreeBranches(t,a.subtree,r):a.type===e.MotionType.Clip&&null!=a.track&&null!=t.animationStateMachine&&(a.frame=this.getDenormalizedFrame(a.track,r),a.weight=1)))},n.prototype.parseSimpleDirectionalTreeItem=function(e,t,n,a){},n.prototype.parseFreeformDirectionalTreeItem=function(e,t,n,a){},n.prototype.parseFreeformCartesianTreeItem=function(e,t,n,a){},n.prototype.parseSkeletalAnimationTrackLayer=function(t){if(this._skeletal===!0&&null!=t.animationStateMachine&&null!=t.animationStateMachine.blendtree&&(t.animationStateMachine.type===e.MotionType.Clip&&t.animationStateMachine.played!==-1&&(t.animationStateMachine.played+=this.manager.deltaTime*this._fps),this.setTreeThresholds(t,t.animationStateMachine.blendtree),this.parseTreeBranches(t,t.animationStateMachine.blendtree,t.animationFrame),null!=t.animationBlendBuffer&&t.animationBlendBuffer.length>0))if(t.animationStateMachine.type===e.MotionType.Clip)t.animationRatio=this.computeSpeedRatio(t,t.animationBlendBuffer[0].track,null,1,t.animationStateMachine.speed);else if(t.animationStateMachine.type===e.MotionType.Tree)switch(t.animationStateMachine.blendtree.blendType){case e.BlendTreeType.Direct:this.sortBlendBuffer(t),null!=t.animationStateMachine.blendtree.directBlendMaster&&(t.animationRatio=this.computeSpeedRatio(t,t.animationStateMachine.blendtree.directBlendMaster.track,null,1,t.animationStateMachine.blendtree.directBlendMaster.timescale)*this.directBlendSpeed);break;case e.BlendTreeType.Simple1D:1===t.animationBlendBuffer.length?t.animationRatio=this.computeSpeedRatio(t,t.animationBlendBuffer[0].track,null,1,t.animationBlendBuffer[0].timescale):(t.animationBlendBuffer[0].weight=1,t.animationBlendBuffer[1].weight=t.animationStateMachine.blendtree.simpleThresholdDelta,t.animationRatio=this.computeSpeedRatio(t,t.animationBlendBuffer[0].track,t.animationBlendBuffer[1].track,t.animationStateMachine.blendtree.simpleThresholdDelta,t.animationBlendBuffer[1].timescale));break;case e.BlendTreeType.SimpleDirectional2D:this.sortBlendBuffer(t);break;case e.BlendTreeType.FreeformDirectional2D:this.sortBlendBuffer(t);break;case e.BlendTreeType.FreeformCartesian2D:this.sortBlendBuffer(t)}},n.EXIT="[EXIT]",n.TIMER=3,n}(e.SceneComponent);e.AnimationState=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return t.Angle=function(t,n){return 57.29578*Math.acos(e.Scalar.Clamp(e.Vector3.Dot(t.normalize(),n.normalize()),-1,1))},t.ClampAngle=function(t,n,a){var r=t;do r<-360&&(r+=360),r>360&&(r-=360);while(r<-360||r>360);return e.Scalar.Clamp(r,n,a)},t.Deg2Rad=function(t){return t*e.Constants.Deg2Rad},t.Rad2Deg=function(t){return t*e.Constants.Rad2Deg},t.Euler=function(t,n,a){return e.Quaternion.RotationYawPitchRoll(n,t,a)},t.EulerToRef=function(t,n,a,r){e.Quaternion.RotationYawPitchRollToRef(n,t,a,r)},t.Matrix=function(t,n,a){return e.Matrix.RotationYawPitchRoll(n,t,a)},t.MatrixToRef=function(t,n,a,r){e.Matrix.RotationYawPitchRollToRef(n,t,a,r)},t.RotateVector=function(t,n){var a=2*(n.y*t.z-n.z*t.y),r=2*(n.z*t.x-n.x*t.z),i=2*(n.x*t.y-n.y*t.x);return new e.Vector3(t.x+n.w*a+(n.y*i-n.z*r),t.y+n.w*r+(n.z*a-n.x*i),t.z+n.w*i+(n.x*r-n.y*a))},t.RotateVectorToRef=function(e,t,n){var a=2*(t.y*e.z-t.z*e.y),r=2*(t.z*e.x-t.x*e.z),i=2*(t.x*e.y-t.y*e.x);n.x=e.x+t.w*a+(t.y*i-t.z*r),n.y=e.y+t.w*r+(t.z*a-t.x*i),n.z=e.z+t.w*i+(t.x*r-t.y*a)},t.LookRotation=function(t){var n=e.Quaternion.Zero();return e.Utilities.LookRotationToRef(t,n),n},t.LookRotationToRef=function(t,n){e.Utilities.TempMatrix.reset(),e.Matrix.LookAtLHToRef(e.Utilities.ZeroVector,t,e.Utilities.UpVector,e.Utilities.TempMatrix),e.Utilities.TempMatrix.invert(),e.Quaternion.FromRotationMatrixToRef(e.Utilities.TempMatrix,n)},t.TransformPosition=function(t,n){return e.Vector3.TransformCoordinates(n,t.getWorldMatrix())},t.TransformPositionToRef=function(t,n,a){return e.Vector3.TransformCoordinatesToRef(n,t.getWorldMatrix(),a)},t.TransformDirection=function(t,n){return e.Vector3.TransformNormal(n,t.getWorldMatrix())},t.TransformDirectionToRef=function(t,n,a){return e.Vector3.TransformNormalToRef(n,t.getWorldMatrix(),a)},t.GetDirectionVector=function(e,t){return e.getDirection(t)},t.GetDirectionVectorToRef=function(e,t,n){e.getDirectionToRef(t,n)},t.GetForwardVector=function(t){return t.getDirection(e.Vector3.Forward())},t.GetForwardVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Forward(),n)},t.GetRightVector=function(t){return t.getDirection(e.Vector3.Right())},t.GetRightVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Right(),n)},t.GetUpVector=function(t){return t.getDirection(e.Vector3.Up())},t.GetUpVectorToRef=function(t,n){t.getDirectionToRef(e.Vector3.Up(),n)},t.ParseColor3=function(t,n){void 0===n&&(n=null);var a=null;return a=null!=t&&null!=t.r&&null!=t.g&&null!=t.b?new e.Color3(t.r,t.g,t.b):n},t.ParseColor4=function(t,n){void 0===n&&(n=null);var a=null;return a=null!=t&&null!=t.r&&null!=t.g&&null!=t.b&&null!=t.a?new e.Color4(t.r,t.g,t.b,t.a):n},t.ParseVector2=function(t,n){void 0===n&&(n=null);var a=null;return a=null!=t&&null!=t.x&&null!=t.y?new e.Vector2(t.x,t.y):n},t.ParseVector3=function(t,n){void 0===n&&(n=null);var a=null;return a=null!=t&&null!=t.x&&null!=t.y&&null!=t.z?new e.Vector3(t.x,t.y,t.z):n},t.ParseVector4=function(t,n){void 0===n&&(n=null);var a=null;return a=null!=t&&null!=t.x&&null!=t.y&&null!=t.z&&null!=t.w?new e.Vector4(t.x,t.y,t.z,t.w):n},t.ParseTransform=function(e,t){return void 0===t&&(t=null),null},t.StartsWith=function(e,t){return 0===e.lastIndexOf(t,0)},t.EndsWith=function(e,t){return e.indexOf(t,e.length-t.length)!==-1},t.ReplaceAll=function(e,t,n){return e.replace(new RegExp(t,"g"),n)},t.EncodeBinay=function(t){
var n=null,a=window;return a.msgpack?n=a.msgpack.encode(t):e.Tools.Warn("Failed to load msgpack library."),n},t.DecodeBinary=function(t){var n=null,a=window;return a.msgpack?n=a.msgpack.decode(t):e.Tools.Warn("Failed to load msgpack library."),null!=n?n:null},t.CompressToString=function(t){var n=null,a=window;return a.pako?n=a.pako.deflate(t,{to:"string"}):e.Tools.Warn("Failed to load pako library."),n},t.CompressToArray=function(t){var n=null,a=window;return a.pako?n=a.pako.deflate(t):e.Tools.Warn("Failed to load pako library."),n},t.DecompressToString=function(t){var n=null,a=window;return a.pako?n=a.pako.inflate(t,{to:"string"}):e.Tools.Warn("Failed to load pako library."),n},t.DecompressToArray=function(t){var n=null,a=window;return a.pako?n=a.pako.inflate(t):e.Tools.Warn("Failed to load pako library."),n},t.SampleAnimationMatrix=function(t,n,a,r){if(null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_MATRIX){var i=t.getKeys();n<i[0].frame?n=i[0].frame:n>i[i.length-1].frame&&(n=i[i.length-1].frame),e.Utilities.FastMatrixInterpolate(t,n,a,r)}},t.SampleAnimationFloat=function(t,n,a,r,i,o){void 0===i&&(i=null),void 0===o&&(o=null);var s=0;if(null!=t&&t.dataType===e.Animation.ANIMATIONTYPE_FLOAT){var l=t.getKeys();n<l[0].frame?n=l[0].frame:n>l[l.length-1].frame&&(n=l[l.length-1].frame),s=e.Utilities.FastFloatInterpolate(t,n,a,r,i,o)}return s},t.FastMatrixLerp=function(t,n,a,r){e.Matrix.LerpToRef(t,n,a,r)},t.FastMatrixSlerp=function(t,n,a,r){e.Matrix.DecomposeLerpToRef(t,n,a,r)},t.FastMatrixInterpolate=function(t,n,a,r){var i=t.getKeys(),o=Math.max(0,Math.min(i.length-1,Math.floor(i.length*(n-i[0].frame)/(i[i.length-1].frame-i[0].frame))-1));if(i[o].frame>=n)for(;o-1>=0&&i[o].frame>=n;)o--;for(var s=o;s<i.length;s++){var l=i[s+1];if(l.frame>=n){var u=i[s],c=u.value;if(u.interpolation===e.AnimationKeyInterpolation.STEP)return void r.copyFrom(c);var p=l.value,d=(void 0!==u.outTangent&&void 0!==l.inTangent,l.frame-u.frame),m=(n-u.frame)/d,h=t.getEasingFunction();switch(null!=h&&(m=h.ease(m)),a){case e.Animation.ANIMATIONLOOPMODE_CYCLE:case e.Animation.ANIMATIONLOOPMODE_CONSTANT:return void e.Utilities.FastMatrixSlerp(c,p,m,r);case e.Animation.ANIMATIONLOOPMODE_RELATIVE:return void r.copyFrom(c)}break}}r.copyFrom(i[i.length-1].value)},t.FastFloatInterpolate=function(t,n,a,r,i,o){if(void 0===i&&(i=null),void 0===o&&(o=null),r===e.Animation.ANIMATIONLOOPMODE_CONSTANT&&a>0)return o.clone?o.clone():o;var s=t.getKeys(),l=Math.max(0,Math.min(s.length-1,Math.floor(s.length*(n-s[0].frame)/(s[s.length-1].frame-s[0].frame))-1));if(s[l].frame>=n)for(;l-1>=0&&s[l].frame>=n;)l--;for(var u=l;u<s.length;u++){var c=s[u+1];if(c.frame>=n){var p=s[u],d=p.value;if(p.interpolation===e.AnimationKeyInterpolation.STEP)return d;var m=c.value,h=void 0!==p.outTangent&&void 0!==c.inTangent,g=c.frame-p.frame,f=(n-p.frame)/g,y=t.getEasingFunction();null!=y&&(f=y.ease(f));var S=h?t.floatInterpolateFunctionWithTangents(d,p.outTangent*g,m,c.inTangent*g,f):t.floatInterpolateFunction(d,m,f);switch(r){case e.Animation.ANIMATIONLOOPMODE_CYCLE:case e.Animation.ANIMATIONLOOPMODE_CONSTANT:return S;case e.Animation.ANIMATIONLOOPMODE_RELATIVE:return i*a+S}break}}return s[s.length-1].value},t.ComputeBlendingSpeed=function(e,t){return 1/(e*t)},t.UpVector=e.Vector3.Up(),t.ZeroVector=e.Vector3.Zero(),t.TempMatrix=e.Matrix.Zero(),t}();e.Utilities=t}(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),BABYLON;!function(e){var t=function(t){function n(e,n,a,r){void 0===a&&(a=!0),void 0===r&&(r={});var i=t.call(this,e,n,a,r)||this;return i.cameraInput=0,i.cameraSpeed=1,i.cameraMoveSpeed=1,i.cameraRotateSpeed=.005,i.multiPlayerView=!1,i.multiPlayerStart=1,i.preventDefaultEvents=!0,i.playerOneCamera=null,i.playerTwoCamera=null,i.playerThreeCamera=null,i.playerFourCamera=null,i}return __extends(n,t),n.prototype.ready=function(){if(this.cameraInput=this.getProperty("cameraInput",0),this.cameraSpeed=this.getProperty("cameraSpeed",1),this.cameraMoveSpeed=this.getProperty("inputMoveSpeed",1),this.cameraRotateSpeed=this.getProperty("inputRotateSpeed",.005),this.preventDefaultEvents=this.getProperty("preventDefaultEvents",!0),this.multiPlayerStart=this.getProperty("multiPlayerStartup",1),this.multiPlayerView=e.SceneManager.IsMultiPlayerView(),this.cameraInput===e.UniversalCameraRig.AUTO_INPUT)this.playerOneCamera=this.manager.getMainCamera(e.PlayerNumber.One),this.multiPlayerView===!0&&(this.playerTwoCamera=this.manager.getMainCamera(e.PlayerNumber.Two),this.playerThreeCamera=this.manager.getMainCamera(e.PlayerNumber.Three),this.playerFourCamera=this.manager.getMainCamera(e.PlayerNumber.Four),this.multiPlayerStart>1&&this.manager.setMultiPlayerViewLayout(this.multiPlayerStart));else if(this.cameraInput===e.UniversalCameraRig.RENDER_CANVAS){var t=this.manager.getMainCamera(e.PlayerNumber.One);t.attachControl(this.engine.getRenderingCanvas(),this.preventDefaultEvents)}},n.prototype.update=function(){if(this.cameraInput===e.UniversalCameraRig.AUTO_INPUT&&(null!=this.playerOneCamera&&this.manager.updateCameraUserInput(this.playerOneCamera,this.cameraMoveSpeed,this.cameraRotateSpeed,e.PlayerNumber.One),this.multiPlayerView===!0)){var t=e.SceneManager.GetMultiPlayerCount();t>=2&&null!=this.playerTwoCamera&&this.manager.updateCameraUserInput(this.playerTwoCamera,this.cameraMoveSpeed,this.cameraRotateSpeed,e.PlayerNumber.Two),t>=3&&null!=this.playerThreeCamera&&this.manager.updateCameraUserInput(this.playerThreeCamera,this.cameraMoveSpeed,this.cameraRotateSpeed,e.PlayerNumber.Three),t>=4&&null!=this.playerFourCamera&&this.manager.updateCameraUserInput(this.playerFourCamera,this.cameraMoveSpeed,this.cameraRotateSpeed,e.PlayerNumber.Four)}},n.prototype.destroy=function(){this.playerOneCamera=null,this.playerTwoCamera=null,this.playerThreeCamera=null,this.playerFourCamera=null},n.AUTO_INPUT=1,n.RENDER_CANVAS=2,n}(e.CameraComponent);e.UniversalCameraRig=t}(BABYLON||(BABYLON={}));